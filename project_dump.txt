
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\.env =====
BOT_TOKEN=7355805223:AAGVTupmwIlEMCXj779qxGqcDH43rDn_IdE
DB_URL=sqlite+aiosqlite:///database.db
ADMIN_IDS=1929084151:admin_cn,1929084152:admin_tj
LOG_LEVEL=INFO
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\bot.py =====
"""
–ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
"""
import asyncio
import logging
from aiogram import Bot, Dispatcher
from aiogram.fsm.storage.memory import MemoryStorage
from config import settings
from database.session import create_tables
import os
from handlers.admin.main_menu import admin_main_router
from handlers.admin.update_status import update_status_router
from handlers.admin.reports import reports_router
from handlers.admin.profile import admin_profile_router  # –ò–°–ü–†–ê–í–õ–ï–ù–û

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

async def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"""
    logger.info("–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞...")
    
    # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    try:
        await create_tables()
        logger.info("‚úÖ –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ")
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü: {e}")
        return
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
    bot = Bot(token=settings.BOT_TOKEN)
    dp = Dispatcher(storage=MemoryStorage())
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∞–¥–º–∏–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
    admin_files = []
    handlers_dir = "handlers"
    
    if os.path.exists(handlers_dir):
        for file in os.listdir(handlers_dir):
            if file.startswith("admin") and file.endswith(".py"):
                admin_files.append(file[:-3])  # –£–±–∏—Ä–∞–µ–º .py
    
    logger.info(f"–ù–∞–π–¥–µ–Ω—ã –∞–¥–º–∏–Ω—Å–∫–∏–µ —Ñ–∞–π–ª—ã: {admin_files}")
    
    # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä—ã
    # 1. –û–±—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    from handlers.common import common_router
    dp.include_router(common_router)
    
    # –í —Ñ—É–Ω–∫—Ü–∏—é main() –¥–æ–±–∞–≤–ª—è–µ–º:
    from handlers.admin_export import router as admin_export_router
    dp.include_router(admin_export_router)
    
    # 2. –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    from handlers.client.main_menu import main_menu_router
    dp.include_router(main_menu_router)
    
    from handlers.client.track_codes import track_codes_router
    dp.include_router(track_codes_router)
    
    from handlers.client.profile import profile_router
    dp.include_router(profile_router)
    
    from handlers.client.address import address_router
    dp.include_router(address_router)
    
    from handlers.client.other_menus import other_menus_router
    dp.include_router(other_menus_router)
    
    # 3. –ù–æ–≤—ã–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ —Ä–æ—É—Ç–µ—Ä—ã
    dp.include_router(admin_main_router)
    dp.include_router(update_status_router)
    dp.include_router(reports_router)
    dp.include_router(admin_profile_router)  # –ò–°–ü–†–ê–í–õ–ï–ù–û
    
    # 4. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ —Ñ–∞–π–ª—ã - –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ
    for admin_file in admin_files:
        try:
            module_name = f"handlers.{admin_file}"
            module = __import__(module_name, fromlist=['router'])
            if hasattr(module, 'router'):
                dp.include_router(module.router)
                logger.info(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: {admin_file}")
        except Exception as e:
            logger.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ {admin_file}: {e}")
    
    # –ï—Å–ª–∏ –Ω–µ—Ç –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤, —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
    if not admin_files:
        logger.info("‚ö†Ô∏è –ê–¥–º–∏–Ω—Å–∫–∏–µ –º–æ–¥—É–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —Å–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª")
        from aiogram import Router
        from aiogram.filters import Command
        from aiogram.types import Message
        
        admin_router = Router()
        
        @admin_router.message(Command("admin"))
        async def admin_command(message: Message):
            await message.answer("üë®‚Äçüíº –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (–±–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)\n\n"
                              "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n"
                              "/add_track - –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫-–∫–æ–¥\n"
                              "/stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
        
        dp.include_router(admin_router)
    
    logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω. –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π...")
    
    try:
        await dp.start_polling(bot)
    except KeyboardInterrupt:
        logger.info("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: {e}", exc_info=True)

if __name__ == "__main__":
    asyncio.run(main())
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\config.py =====
import os
from typing import Dict, Set
from dotenv import load_dotenv

load_dotenv()

class Settings:
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ .env
    BOT_TOKEN = os.getenv("BOT_TOKEN", "")
    DB_URL = os.getenv("DB_URL", "sqlite+aiosqlite:///database.db")
    LOG_LEVEL = os.getenv("LOG_LEVEL", "INFO")
    _ADMIN_IDS_STR = os.getenv("ADMIN_IDS", "")
    
    @classmethod
    def get_admin_ids(cls) -> Dict[int, str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å ID –∞–¥–º–∏–Ω–æ–≤ –∏ –∏—Ö —Ä–æ–ª—è–º–∏"""
        admin_dict = {}
        if not cls._ADMIN_IDS_STR:
            return admin_dict
        
        try:
            # –§–æ—Ä–º–∞—Ç: "1929084151:admin_cn,1929084152:admin_tj"
            parts = cls._ADMIN_IDS_STR.strip().split(',')
            for part in parts:
                if ':' in part:
                    user_id, role = part.split(':', 1)
                    admin_dict[int(user_id.strip())] = role.strip()
                elif part.strip():
                    # –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ ID –±–µ–∑ —Ä–æ–ª–∏, –Ω–∞–∑–Ω–∞—á–∞–µ–º admin_cn –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    admin_dict[int(part.strip())] = 'admin_cn'
        except (ValueError, AttributeError) as e:
            print(f"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ ADMIN_IDS: {e}")
            
        return admin_dict
    
    @classmethod
    def get_admin_ids_set(cls) -> Set[int]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ ID –∞–¥–º–∏–Ω–æ–≤"""
        return set(cls.get_admin_ids().keys())
    
    @classmethod
    def is_admin(cls, user_id: int) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–æ–º"""
        return user_id in cls.get_admin_ids()
    
    @classmethod
    def get_admin_role(cls, user_id: int) -> str:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–æ–ª—å –∞–¥–º–∏–Ω–∞"""
        return cls.get_admin_ids().get(user_id, "client")

# –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫
settings = Settings()

# –î–æ–±–∞–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç ADMIN_IDS –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
settings.ADMIN_IDS = settings.get_admin_ids_set()
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\create_tables.py =====
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
"""
import asyncio
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from database.session import engine
from database.models import Base

async def create_tables():
    """–°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"""
    try:
        async with engine.begin() as conn:
            await conn.run_sync(Base.metadata.create_all)
        print("‚úÖ –¢–∞–±–ª–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã!")
        print("–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:")
        for table in Base.metadata.tables:
            print(f"  - {table}")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    asyncio.run(create_tables())
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\database.db =====
SQLite format 3   @     
                                                               
 .O}
   
ÔøΩ ÔøΩÔøΩTl
ÔøΩ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    n9ÔøΩindexix_products_track_codeproductsCREATE UNIQUE INDEX ix_products_track_code ON products (track_code)N)eindexix_products_idproductsCREATE INDEX ix_products_id ON products (id)ÔøΩeÔøΩtableproductsproductsCREATE TABLE products (
	id INTEGER NOT NULL, 
	track_code VARCHAR(50) NOT NULL, 
	user_id INTEGER, 
	product_name VARCHAR(200), 
	product_category VARCHAR(15), 
	product_description VARCHAR(500), 
	quantity INTEGER, 
	unit_price_usd FLOAT, 
	total_value_usd FLOAT, 
	weight_kg FLOAT, 
	length_cm FLOAT, 
	width_cm FLOAT, 
	height_cm FLOAT, 
	fragile BOOLEAN, 
	has_battery BOOLEAN, 
	is_liquid BOOLEAN, 
	status VARCHAR(20), 
	country_from VARCHAR(50), 
	delivery_type VARCHAR(50), 
	send_date DATETIME, 
	expected_delivery_date DATETIME, 
	door_delivery_status VARCHAR(9), 
	arrival_date DATETIME, 
	created_at DATETIME, 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)e5ÔøΩindexix_users_telegram_idusersCREATE UNIQUE INDEX ix_users_telegram_id ON users (telegram_id)B#Yindexix_users_idusersCREATE INDEX ix_users_id ON users (id)ÔøΩ~ÔøΩ[tableusersusersCREATE TABLE users (
	id INTEGER NOT NULL, 
	telegram_id INTEGER NOT NULL, 
	phone VARCHAR(20), 
	full_name VARCHAR(100), 
	region VARCHAR(100), 
	language VARCHAR(10), 
	role VARCHAR(8), 
	created_at DATETIME, 
	PRIMARY KEY (id)
)
   ÔøΩ ÔøΩ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               E	 %! ArÔøΩ|ÔøΩ992927543115–ë–∏–ª–æ–ªruCLIENT2026-02-03 15:06:39.149552
   ÔøΩ ÔøΩ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  		
   ÔøΩ ÔøΩ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              	rÔøΩ|ÔøΩ
   e e                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           ÔøΩ 1	!5	   	    AAGE2602034150GNCDYH—Ü—É–∫–∞–∞TOYS–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—åCREATEDChinaPENDING2026-02-03 15:07:24.6282922026-02-03 15:07:43.102511
   ÔøΩ ÔøΩ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  		
   ÔøΩ ÔøΩ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                1	GE2602034150GNCDYH
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\docker-compose.yml =====
version: '3.8'

services:
  bot:
    build: .
    container_name: telegram-cargo-bot
    restart: unless-stopped
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
      - DB_URL=sqlite:///database.db
      - ADMIN_IDS=${ADMIN_IDS}
      - LOG_LEVEL=INFO
    volumes:
      - ./database.db:/app/database.db
      - ./logs:/app/logs
      - ./reports:/app/reports
    depends_on:
      - mysql
    command: python bot.py

  mysql:
    image: mysql:8.0
    container_name: cargo-bot-mysql
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpassword}
      MYSQL_DATABASE: ${MYSQL_DATABASE:-cargo_bot}
      MYSQL_USER: ${MYSQL_USER:-cargo_user}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD:-cargo_password}
    volumes:
      - mysql_data:/var/lib/mysql
      - ./mysql-init:/docker-entrypoint-initdb.d
    ports:
      - "3306:3306"

  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: cargo-bot-phpmyadmin
    restart: unless-stopped
    environment:
      PMA_HOST: mysql
      PMA_PORT: 3306
    ports:
      - "8080:80"
    depends_on:
      - mysql

volumes:
  mysql_data:
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\project_dump.txt =====

===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\.env =====
BOT_TOKEN=7355805223:AAGVTupmwIlEMCXj779qxGqcDH43rDn_IdE
DB_URL=sqlite+aiosqlite:///database.db
ADMIN_IDS=1929084151:admin_cn,1929084152:admin_tj
LOG_LEVEL=INFO
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\bot.py =====
"""
–ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
"""
import asyncio
import logging
from aiogram import Bot, Dispatcher
from aiogram.fsm.storage.memory import MemoryStorage
from config import settings
from database.session import create_tables
import os
from handlers.admin.main_menu import admin_main_router
from handlers.admin.update_status import update_status_router
from handlers.admin.reports import reports_router
from handlers.admin.profile import admin_profile_router  # –ò–°–ü–†–ê–í–õ–ï–ù–û

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

async def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"""
    logger.info("–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞...")
    
    # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    try:
        await create_tables()
        logger.info("‚úÖ –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ")
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü: {e}")
        return
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
    bot = Bot(token=settings.BOT_TOKEN)
    dp = Dispatcher(storage=MemoryStorage())
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∞–¥–º–∏–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
    admin_files = []
    handlers_dir = "handlers"
    
    if os.path.exists(handlers_dir):
        for file in os.listdir(handlers_dir):
            if file.startswith("admin") and file.endswith(".py"):
                admin_files.append(file[:-3])  # –£–±–∏—Ä–∞–µ–º .py
    
    logger.info(f"–ù–∞–π–¥–µ–Ω—ã –∞–¥–º–∏–Ω—Å–∫–∏–µ —Ñ–∞–π–ª—ã: {admin_files}")
    
    # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä—ã
    # 1. –û–±—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    from handlers.common import common_router
    dp.include_router(common_router)
    
    # –í —Ñ—É–Ω–∫—Ü–∏—é main() –¥–æ–±–∞–≤–ª—è–µ–º:
    from handlers.admin_export import router as admin_export_router
    dp.include_router(admin_export_router)
    
    # 2. –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    from handlers.client.main_menu import main_menu_router
    dp.include_router(main_menu_router)
    
    from handlers.client.track_codes import track_codes_router
    dp.include_router(track_codes_router)
    
    from handlers.client.profile import profile_router
    dp.include_router(profile_router)
    
    from handlers.client.address import address_router
    dp.include_router(address_router)
    
    from handlers.client.other_menus import other_menus_router
    dp.include_router(other_menus_router)
    
    # 3. –ù–æ–≤—ã–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ —Ä–æ—É—Ç–µ—Ä—ã
    dp.include_router(admin_main_router)
    dp.include_router(update_status_router)
    dp.include_router(reports_router)
    dp.include_router(admin_profile_router)  # –ò–°–ü–†–ê–í–õ–ï–ù–û
    
    # 4. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ —Ñ–∞–π–ª—ã - –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ
    for admin_file in admin_files:
        try:
            module_name = f"handlers.{admin_file}"
            module = __import__(module_name, fromlist=['router'])
            if hasattr(module, 'router'):
                dp.include_router(module.router)
                logger.info(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: {admin_file}")
        except Exception as e:
            logger.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ {admin_file}: {e}")
    
    # –ï—Å–ª–∏ –Ω–µ—Ç –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤, —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
    if not admin_files:
        logger.info("‚ö†Ô∏è –ê–¥–º–∏–Ω—Å–∫–∏–µ –º–æ–¥—É–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —Å–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª")
        from aiogram import Router
        from aiogram.filters import Command
        from aiogram.types import Message
        
        admin_router = Router()
        
        @admin_router.message(Command("admin"))
        async def admin_command(message: Message):
            await message.answer("üë®‚Äçüíº –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (–±–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)\n\n"
                              "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n"
                              "/add_track - –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫-–∫–æ–¥\n"
                              "/stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
        
        dp.include_router(admin_router)
    
    logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω. –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π...")
    
    try:
        await dp.start_polling(bot)
    except KeyboardInterrupt:
        logger.info("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: {e}", exc_info=True)

if __name__ == "__main__":
    asyncio.run(main())
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\config.py =====
import os
from typing import Dict, Set
from dotenv import load_dotenv

load_dotenv()

class Settings:
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ .env
    BOT_TOKEN = os.getenv("BOT_TOKEN", "")
    DB_URL = os.getenv("DB_URL", "sqlite+aiosqlite:///database.db")
    LOG_LEVEL = os.getenv("LOG_LEVEL", "INFO")
    _ADMIN_IDS_STR = os.getenv("ADMIN_IDS", "")
    
    @classmethod
    def get_admin_ids(cls) -> Dict[int, str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å ID –∞–¥–º–∏–Ω–æ–≤ –∏ –∏—Ö —Ä–æ–ª—è–º–∏"""
        admin_dict = {}
        if not cls._ADMIN_IDS_STR:
            return admin_dict
        
        try:
            # –§–æ—Ä–º–∞—Ç: "1929084151:admin_cn,1929084152:admin_tj"
            parts = cls._ADMIN_IDS_STR.strip().split(',')
            for part in parts:
                if ':' in part:
                    user_id, role = part.split(':', 1)
                    admin_dict[int(user_id.strip())] = role.strip()
                elif part.strip():
                    # –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ ID –±–µ–∑ —Ä–æ–ª–∏, –Ω–∞–∑–Ω–∞—á–∞–µ–º admin_cn –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    admin_dict[int(part.strip())] = 'admin_cn'
        except (ValueError, AttributeError) as e:
            print(f"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ ADMIN_IDS: {e}")
            
        return admin_dict
    
    @classmethod
    def get_admin_ids_set(cls) -> Set[int]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ ID –∞–¥–º–∏–Ω–æ–≤"""
        return set(cls.get_admin_ids().keys())
    
    @classmethod
    def is_admin(cls, user_id: int) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–æ–º"""
        return user_id in cls.get_admin_ids()
    
    @classmethod
    def get_admin_role(cls, user_id: int) -> str:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–æ–ª—å –∞–¥–º–∏–Ω–∞"""
        return cls.get_admin_ids().get(user_id, "client")

# –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫
settings = Settings()

# –î–æ–±–∞–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç ADMIN_IDS –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
settings.ADMIN_IDS = settings.get_admin_ids_set()
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\create_tables.py =====
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
"""
import asyncio
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from database.session import engine
from database.models import Base

async def create_tables():
    """–°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"""
    try:
        async with engine.begin() as conn:
            await conn.run_sync(Base.metadata.create_all)
        print("‚úÖ –¢–∞–±–ª–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã!")
        print("–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:")
        for table in Base.metadata.tables:
            print(f"  - {table}")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    asyncio.run(create_tables())
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\database.db =====
SQLite format 3   @     
                                                               
 .O}
   
ÔøΩ ÔøΩÔøΩTl
ÔøΩ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    n9ÔøΩindexix_products_track_codeproductsCREATE UNIQUE INDEX ix_products_track_code ON products (track_code)N)eindexix_products_idproductsCREATE INDEX ix_products_id ON products (id)ÔøΩeÔøΩtableproductsproductsCREATE TABLE products (
	id INTEGER NOT NULL, 
	track_code VARCHAR(50) NOT NULL, 
	user_id INTEGER, 
	product_name VARCHAR(200), 
	product_category VARCHAR(15), 
	product_description VARCHAR(500), 
	quantity INTEGER, 
	unit_price_usd FLOAT, 
	total_value_usd FLOAT, 
	weight_kg FLOAT, 
	length_cm FLOAT, 
	width_cm FLOAT, 
	height_cm FLOAT, 
	fragile BOOLEAN, 
	has_battery BOOLEAN, 
	is_liquid BOOLEAN, 
	status VARCHAR(20), 
	country_from VARCHAR(50), 
	delivery_type VARCHAR(50), 
	send_date DATETIME, 
	expected_delivery_date DATETIME, 
	door_delivery_status VARCHAR(9), 
	arrival_date DATETIME, 
	created_at DATETIME, 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)e5ÔøΩindexix_users_telegram_idusersCREATE UNIQUE INDEX ix_users_telegram_id ON users (telegram_id)B#Yindexix_users_idusersCREATE INDEX ix_users_id ON users (id)ÔøΩ~ÔøΩ[tableusersusersCREATE TABLE users (
	id INTEGER NOT NULL, 
	telegram_id INTEGER NOT NULL, 
	phone VARCHAR(20), 
	full_name VARCHAR(100), 
	region VARCHAR(100), 
	language VARCHAR(10), 
	role VARCHAR(8), 
	created_at DATETIME, 
	PRIMARY KEY (id)
)
   ÔøΩ ÔøΩ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               E	 %! ArÔøΩ|ÔøΩ992927543115–ë–∏–ª–æ–ªruCLIENT2026-02-03 15:06:39.149552
   ÔøΩ ÔøΩ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  		
   ÔøΩ ÔøΩ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              	rÔøΩ|ÔøΩ
   e e                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           ÔøΩ 1	!5	   	    AAGE2602034150GNCDYH—Ü—É–∫–∞–∞TOYS–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—åCREATEDChinaPENDING2026-02-03 15:07:24.6282922026-02-03 15:07:43.102511
   ÔøΩ ÔøΩ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  		
   ÔøΩ ÔøΩ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                1	GE2602034150GNCDYH
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\README.md =====
# Telegram Bot for Cargo Management

Telegram –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–∑–∞–º–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —è–∑—ã–∫–æ–≤ –∏ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤:
- üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫-–∫–æ–¥–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤
- üë§ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üìç –ê–¥—Ä–µ—Å–∞ —Å–∫–ª–∞–¥–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∞—Ö
- üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- üöö –î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–µ–π
- üö´ –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- üéì –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã –ø–æ –ø–æ–∫—É–ø–∫–∞–º
- üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
- –ö–∏—Ç–∞–π—Å–∫–∏–π —Å–∫–ª–∞–¥: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤, –º–∞—Å—Å–æ–≤—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –¢–∞–¥–∂–∏–∫—Å–∫–∏–π —Å–∫–ª–∞–¥: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏–±—ã—Ç–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–æ–π
- üìä –û—Ç—á–µ—Ç—ã –≤ Excel

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Python 3.11+**
- **Aiogram 3.x** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram –±–æ—Ç–æ–≤
- **SQLAlchemy 2.0** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **SQLite/MySQL** - —Å–∏—Å—Ç–µ–º—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- **Openpyxl** - —Ä–∞–±–æ—Ç–∞ —Å Excel —Ñ–∞–π–ª–∞–º–∏
- **Alembic** - –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
git clone <repository-url>
cd telegram-cargo-bot
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\requirements.txt =====
aiogram==3.10.0
SQLAlchemy==2.0.28
aiosqlite
python-dotenv==1.0.0
pandas
openpyxl==3.1.2
psutil==5.9.6
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\tre.py =====
import os

# ===== –ù–ê–°–¢–†–û–ô–ö–ò =====
OUTPUT_FILE = "project_dump.txt"

EXCLUDE_DIRS = {
    ".git",
    ".idea",
    ".vscode",
    "__pycache__",
    "venv",
    "env",
    "node_modules",
    "dist",
    "build"
}

EXCLUDE_EXTENSIONS = {
    ".pyc",
    ".exe",
    ".dll",
    ".so",
    ".png",
    ".jpg",
    ".jpeg",
    ".gif",
    ".ico",
    ".pdf",
    ".zip",
    ".tar",
    ".gz",
    ".mp4",
    ".mp3"
}

MAX_FILE_SIZE = 2 * 1024 * 1024  # 2 MB


def is_text_file(file_path: str) -> bool:
    _, ext = os.path.splitext(file_path)
    if ext.lower() in EXCLUDE_EXTENSIONS:
        return False
    return True


def export_project(root_dir: str):
    with open(OUTPUT_FILE, "w", encoding="utf-8") as output:
        for root, dirs, files in os.walk(root_dir):
            dirs[:] = [d for d in dirs if d not in EXCLUDE_DIRS]

            for file in files:
                file_path = os.path.join(root, file)

                if not is_text_file(file_path):
                    continue

                if os.path.getsize(file_path) > MAX_FILE_SIZE:
                    output.write(
                        f"\n===== FILE: {file_path} =====\n"
                        f"[SKIPPED: file is larger than {MAX_FILE_SIZE // 1024} KB]\n"
                    )
                    continue

                output.write(f"\n===== FILE: {file_path} =====\n")

                try:
                    with open(file_path, "r", encoding="utf-8", errors="replace") as f:
                        output.write(f.read())
                except Exception as e:
                    output.write(f"[ERROR READING FILE: {e}]\n")


if __name__ == "__main__":
    project_root = os.getcwd()
    export_project(project_root)
    print(f"–ì–æ—Ç–æ–≤–æ. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ '{OUTPUT_FILE}'")

===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\tree.py =====
from pathlib import Path

EXCLUDE_DIRS = {
    ".git",
    "__pycache__",
    "venv",
    ".venv",
    ".idea",
    ".vscode",
    "node_modules",
}

def print_tree(
    path: Path,
    prefix: str = "",
    is_last: bool = True,
    root: bool = False
):
    if not root:
        connector = "‚îî‚îÄ‚îÄ " if is_last else "‚îú‚îÄ‚îÄ "
        print(prefix + connector + path.name)

    if path.is_dir():
        children = sorted(
            [p for p in path.iterdir() if p.name not in EXCLUDE_DIRS],
            key=lambda x: (x.is_file(), x.name.lower())
        )

        for index, child in enumerate(children):
            last = index == len(children) - 1
            new_prefix = prefix + ("    " if is_last else "‚îÇ   ")
            print_tree(child, new_prefix, last)

if __name__ == "__main__":
    root_dir = Path(".").resolve()
    print(f"{root_dir.name}/")
    print_tree(root_dir, root=True)

===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ.txt =====
–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏:

python -m venv venv

–ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
Windows (CMD / PowerShell)
venv\Scripts\activate

Linux / macOS
source venv/bin/activate

–ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ—è–≤–∏—Ç—Å—è:

(venv)

–í—ã—Ö–æ–¥ –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è
deactivate
pip install -r requirements.txt
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\database\models.py =====
from sqlalchemy import Column, Integer, String, Boolean, DateTime, ForeignKey, Enum, Float, Text
from sqlalchemy.orm import relationship, declarative_base
from datetime import datetime
import enum
from sqlalchemy.sql import func

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º Base –∏–∑ session.py
from database.session import Base

class UserRole(enum.Enum):
    CLIENT = "client"
    ADMIN_CN = "admin_cn"
    ADMIN_TJ = "admin_tj"

class ProductStatus(enum.Enum):
    CREATED = "created"
    CHINA_WAREHOUSE = "china_warehouse"
    IN_TRANSIT = "in_transit"
    TAJIKISTAN_WAREHOUSE = "tajikistan_warehouse"
    DELIVERED = "delivered"
    COMPLETED = "completed"

class DoorDeliveryStatus(enum.Enum):
    PENDING = "pending"
    DELIVERED = "delivered"
    CANCELLED = "cancelled"

class ProductCategory(enum.Enum):
    ELECTRONICS = "electronics"
    CLOTHING = "clothing"
    SHOES = "shoes"
    HOME_APPLIANCES = "home_appliances"
    BEAUTY = "beauty"
    TOYS = "toys"
    AUTOMOTIVE = "automotive"
    SPORTS = "sports"
    OTHER = "other"

class User(Base):
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True, index=True)
    telegram_id = Column(Integer, unique=True, index=True, nullable=False)
    phone = Column(String(20))
    full_name = Column(String(100))
    region = Column(String(100))
    language = Column(String(10), default="ru")  # 'ru' –∏–ª–∏ 'tj'
    role = Column(Enum(UserRole), default=UserRole.CLIENT)
    created_at = Column(DateTime, default=datetime.utcnow)
    
    products = relationship("Product", back_populates="user")
    Base = declarative_base()
class Product(Base):
    __tablename__ = "products"
    
    id = Column(Integer, primary_key=True, index=True)
    track_code = Column(String(50), unique=True, index=True, nullable=False)
    user_id = Column(Integer, ForeignKey("users.id"))
    
    # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    product_name = Column(String(200))
    product_category = Column(Enum(ProductCategory))
    product_description = Column(String(500))
    quantity = Column(Integer, default=1)
    unit_price_usd = Column(Float, default=0.0)
    total_value_usd = Column(Float, default=0.0)
    weight_kg = Column(Float, default=0.0)
    length_cm = Column(Float)
    width_cm = Column(Float)
    height_cm = Column(Float)
    
    # –û—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
    fragile = Column(Boolean, default=False)
    has_battery = Column(Boolean, default=False)
    is_liquid = Column(Boolean, default=False)
    
    # –°—Ç–∞—Ç—É—Å –∏ –¥–æ—Å—Ç–∞–≤–∫–∞
    status = Column(Enum(ProductStatus), default=ProductStatus.CREATED)
    country_from = Column(String(50))
    delivery_type = Column(String(50))
    send_date = Column(DateTime)
    expected_delivery_date = Column(DateTime)
    door_delivery_status = Column(Enum(DoorDeliveryStatus), default=DoorDeliveryStatus.PENDING)
    
    # –ù–æ–≤–æ–µ –ø–æ–ª–µ: –î–∞—Ç–∞ –ø—Ä–∏–±—ã—Ç–∏—è –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω
    arrival_date = Column(DateTime)
    
    # –î–∞—Ç—ã
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    
    user = relationship("User", back_populates="products")
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\database\repository.py =====
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy.future import select
from sqlalchemy import update, delete, or_
from sqlalchemy.sql import func
from typing import List, Optional, Tuple, Dict
from datetime import datetime, timedelta
import pandas as pd
import os
from sqlalchemy import select
from .models import User, UserRole, Product, ProductStatus, ProductCategory

class UserRepository:
    def __init__(self, session: AsyncSession):
        self.session = session
    
    async def get_user_by_telegram_id(self, telegram_id: int) -> Optional[User]:
        result = await self.session.execute(
            select(User).where(User.telegram_id == telegram_id)
        )
        return result.scalar_one_or_none()
    
    async def create_user(self, telegram_id: int, phone: str = None, 
                        full_name: str = None, language: str = "ru",
                        role: str = "client") -> User:
        """–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        try:
            user_role = UserRole(role)
        except ValueError:
            user_role = UserRole.CLIENT
        
        user = User(
            telegram_id=telegram_id,
            phone=phone,
            full_name=full_name,
            language=language,
            role=user_role
        )
        self.session.add(user)
        await self.session.commit()
        await self.session.refresh(user)
        return user
    
    async def update_user_language(self, telegram_id: int, language: str) -> Optional[User]:
        stmt = update(User).where(User.telegram_id == telegram_id).values(language=language)
        await self.session.execute(stmt)
        await self.session.commit()
        return await self.get_user_by_telegram_id(telegram_id)
    
    async def update_user_profile(self, telegram_id: int, **kwargs) -> Optional[User]:
        update_data = {}
        for key, value in kwargs.items():
            if value is not None:
                update_data[key] = value
        
        if update_data:
            stmt = update(User).where(User.telegram_id == telegram_id).values(**update_data)
            await self.session.execute(stmt)
            await self.session.commit()
        
        return await self.get_user_by_telegram_id(telegram_id)

class ProductRepository:
    def __init__(self, session: AsyncSession):
        self.session = session
        self.model = Product  # –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–∞—Ö
    
    async def get_user_products(self, user_id: int, skip: int = 0, limit: int = 5) -> List[Product]:
        result = await self.session.execute(
            select(Product)
            .where(Product.user_id == user_id)
            .order_by(Product.created_at.desc())
            .offset(skip)
            .limit(limit)
        )
        return result.scalars().all()
    
    async def get_product_by_track_code(self, track_code: str) -> Optional[Product]:
        result = await self.session.execute(
            select(Product).where(Product.track_code == track_code)
        )
        return result.scalar_one_or_none()
    
    async def create_product(self, track_code: str, user_id: int, 
                           country_from: str = "China", **kwargs) -> Product:
        product = Product(
            track_code=track_code,
            user_id=user_id,
            country_from=country_from,
            status=ProductStatus.CREATED,
            **kwargs
        )
        self.session.add(product)
        await self.session.commit()
        await self.session.refresh(product)
        return product
    
    async def update_product(self, product_id: int, **kwargs) -> Optional[Product]:
        # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç
        result = await self.session.execute(
            select(Product).where(Product.id == product_id)
        )
        product = result.scalar_one_or_none()
        
        if not product:
            return None
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è
        for key, value in kwargs.items():
            if value is not None:
                setattr(product, key, value)
        
        product.updated_at = datetime.utcnow()
        await self.session.commit()
        await self.session.refresh(product)
        return product
    
    async def update_product_status(self, product_id: int, status: ProductStatus) -> Optional[Product]:
        return await self.update_product(product_id, status=status)
    
    async def get_products_by_status(self, status: ProductStatus, 
                                   skip: int = 0, limit: int = 50) -> List[Product]:
        result = await self.session.execute(
            select(Product)
            .where(Product.status == status)
            .offset(skip)
            .limit(limit)
        )
        return result.scalars().all()
    
    async def get_detailed_product_info(self, track_code: str) -> Optional[dict]:
        """–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        result = await self.session.execute(
            select(Product, User)
            .join(User, Product.user_id == User.id)
            .where(Product.track_code == track_code)
        )
        
        row = result.first()
        if row:
            product, user = row
            return {
                "product": product,
                "user": user,
                "product_info": {
                    "name": product.product_name,
                    "category": product.product_category.value if product.product_category else None,
                    "description": product.product_description,
                    "quantity": product.quantity,
                    "unit_price": product.unit_price_usd,
                    "total_value": product.total_value_usd,
                    "weight": product.weight_kg,
                    "dimensions": f"{product.length_cm}√ó{product.width_cm}√ó{product.height_cm} —Å–º" if product.length_cm else None,
                    "fragile": product.fragile,
                    "has_battery": product.has_battery,
                    "is_liquid": product.is_liquid
                },
                "user_info": {
                    "name": user.full_name,
                    "phone": user.phone,
                    "region": user.region,
                    "telegram_id": user.telegram_id
                }
            }
        return None
    
    # –ù–û–í–´–ï –ú–ï–¢–û–î–´ –î–õ–Ø –§–£–ù–ö–¶–ò–û–ù–ê–õ–ê
    
    async def search_products(self, search_term: str, user_id: Optional[int] = None) -> List[Product]:
        """–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —Ç—Ä–µ–∫-–∫–æ–¥—É, –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é"""
        query = select(Product)
        
        if user_id:
            query = query.where(Product.user_id == user_id)
        
        query = query.where(
            or_(
                Product.track_code.ilike(f"%{search_term}%"),
                Product.product_name.ilike(f"%{search_term}%"),
                Product.product_description.ilike(f"%{search_term}%")
            )
        ).order_by(Product.created_at.desc())
        
        result = await self.session.execute(query)
        return result.scalars().all()
    
    async def bulk_update_status(
        self, 
        track_codes: List[str], 
        new_status: ProductStatus,
        arrival_date: Optional[datetime] = None
    ) -> Tuple[int, List[str]]:
        """
        –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤
        
        Returns:
            tuple: (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö, —Å–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤)
        """
        if not track_codes:
            return 0, []
        
        # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä—ã
        result = await self.session.execute(
            select(Product).where(Product.track_code.in_(track_codes))
        )
        products = result.scalars().all()
        
        updated_count = 0
        updated_codes = []
        
        for product in products:
            product.status = new_status
            if arrival_date and new_status == ProductStatus.TAJIKISTAN_WAREHOUSE:
                product.arrival_date = arrival_date
            product.updated_at = datetime.utcnow()
            updated_count += 1
            updated_codes.append(product.track_code)
        
        await self.session.commit()
        return updated_count, updated_codes
    
    async def update_product_by_track_code(
        self, 
        track_code: str, 
        user_id: int,
        **kwargs
    ) -> Optional[Product]:
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ —Ç—Ä–µ–∫-–∫–æ–¥—É (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)"""
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–≤–∞—Ä –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        result = await self.session.execute(
            select(Product).where(
                Product.track_code == track_code,
                Product.user_id == user_id
            )
        )
        product = result.scalar_one_or_none()
        
        if not product:
            return None
        
        # –ù–µ –ø–æ–∑–≤–æ–ª—è–µ–º –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å, –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
        if product.status not in [ProductStatus.CREATED, ProductStatus.CHINA_WAREHOUSE]:
            # –†–∞–∑—Ä–µ—à–∞–µ–º –∏–∑–º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ
            allowed_fields = ['product_name', 'product_description']
            kwargs = {k: v for k, v in kwargs.items() if k in allowed_fields}
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è
        for key, value in kwargs.items():
            if value is not None:
                setattr(product, key, value)
        
        product.updated_at = datetime.utcnow()
        await self.session.commit()
        await self.session.refresh(product)
        
        return product
    
    async def get_products_by_date_range(
        self,
        start_date: datetime,
        end_date: datetime,
        status: Optional[ProductStatus] = None
    ) -> List[Product]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥"""
        query = select(Product).where(
            Product.created_at.between(start_date, end_date)
        )
        
        if status:
            query = query.where(Product.status == status)
        
        query = query.order_by(Product.created_at.desc())
        
        result = await self.session.execute(query)
        return result.scalars().all()
    
    async def get_delivery_statistics(
        self,
        month: int,
        year: int
    ) -> Dict[str, int]:
        """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –∑–∞ –º–µ—Å—è—Ü"""
        start_date = datetime(year, month, 1)
        if month == 12:
            end_date = datetime(year + 1, 1, 1)
        else:
            end_date = datetime(year, month + 1, 1)
        
        # –í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ –º–µ—Å—è—Ü
        total_query = select(func.count(Product.id)).where(
            Product.created_at.between(start_date, end_date)
        )
        total_result = await self.session.execute(total_query)
        total = total_result.scalar() or 0
        
        # –î–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
        delivered_query = select(func.count(Product.id)).where(
            Product.created_at.between(start_date, end_date),
            Product.status == ProductStatus.DELIVERED
        )
        delivered_result = await self.session.execute(delivered_query)
        delivered = delivered_result.scalar() or 0
        
        # –ü—Ä–∏–Ω—è—Ç—ã–µ —Ç–æ–≤–∞—Ä—ã (–Ω–∞ —Å–∫–ª–∞–¥–µ –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–µ)
        accepted_query = select(func.count(Product.id)).where(
            Product.created_at.between(start_date, end_date),
            Product.status == ProductStatus.TAJIKISTAN_WAREHOUSE
        )
        accepted_result = await self.session.execute(accepted_query)
        accepted = accepted_result.scalar() or 0
        
        # –í –ø—É—Ç–∏
        transit_query = select(func.count(Product.id)).where(
            Product.created_at.between(start_date, end_date),
            Product.status == ProductStatus.IN_TRANSIT
        )
        transit_result = await self.session.execute(transit_query)
        transit = transit_result.scalar() or 0
        
        return {
            "total": total,
            "delivered": delivered,
            "accepted": accepted,
            "transit": transit,
            "pending": total - delivered - accepted - transit
        }
    
    async def export_to_excel(self, products: List[Product]) -> bytes:
        """–≠–∫—Å–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ Excel"""
        try:
            # –°–æ–∑–¥–∞–µ–º DataFrame
            data = []
            for product in products:
                data.append({
                    "–¢—Ä–µ–∫-–∫–æ–¥": product.track_code,
                    "–ù–∞–∑–≤–∞–Ω–∏–µ": product.product_name or "",
                    "–ö–∞—Ç–µ–≥–æ—Ä–∏—è": product.product_category.value if product.product_category else "",
                    "–°—Ç–∞—Ç—É—Å": product.status.value,
                    "–í–µ—Å (–∫–≥)": product.weight_kg or 0,
                    "–°—Ç–æ–∏–º–æ—Å—Ç—å ($)": product.total_value_usd or 0,
                    "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ": product.quantity or 1,
                    "–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è": product.created_at.strftime("%Y-%m-%d %H:%M"),
                    "–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è": product.updated_at.strftime("%Y-%m-%d %H:%M") if product.updated_at else "",
                    "–î–∞—Ç–∞ –ø—Ä–∏–±—ã—Ç–∏—è": product.arrival_date.strftime("%Y-%m-%d") if hasattr(product, 'arrival_date') and product.arrival_date else "",
                    "–û—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞": self._get_special_properties(product)
                })
            
            df = pd.DataFrame(data)
            
            # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ Excel
            import tempfile
            with tempfile.NamedTemporaryFile(suffix='.xlsx', delete=False) as tmp:
                with pd.ExcelWriter(tmp.name, engine='openpyxl') as writer:
                    df.to_excel(writer, index=False, sheet_name='–¢–æ–≤–∞—Ä—ã')
                
                # –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª
                with open(tmp.name, 'rb') as f:
                    excel_data = f.read()
                
                # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
                os.unlink(tmp.name)
            
            return excel_data
            
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Excel: {e}")
            return b""
    
    def _get_special_properties(self, product: Product) -> str:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Å –æ—Å–æ–±—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏"""
        properties = []
        if product.fragile:
            properties.append("–•—Ä—É–ø–∫–∏–π")
        if product.has_battery:
            properties.append("–° –±–∞—Ç–∞—Ä–µ–µ–π")
        if product.is_liquid:
            properties.append("–ñ–∏–¥–∫–æ—Å—Ç—å")
        return ", ".join(properties) if properties else "–ù–µ—Ç"
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\database\session.py =====
"""
–ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
"""
import asyncio
from typing import AsyncGenerator
from sqlalchemy.ext.asyncio import AsyncSession, async_sessionmaker, create_async_engine
from sqlalchemy.orm import declarative_base
from config import settings

# –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –º–æ–¥–µ–ª–µ–π
Base = declarative_base()

# –°–æ–∑–¥–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
engine = create_async_engine(
    settings.DB_URL,
    echo=False,  # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ True –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ SQL –∑–∞–ø—Ä–æ—Å–æ–≤
    future=True
)

# –°–æ–∑–¥–∞–µ–º —Ñ–∞–±—Ä–∏–∫—É —Å–µ—Å—Å–∏–π
async_session_maker = async_sessionmaker(
    engine, 
    class_=AsyncSession,
    expire_on_commit=False
)

async def get_async_session() -> AsyncGenerator[AsyncSession, None]:
    """
    –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
    –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
        async with get_async_session() as session:
            # —Ä–∞–±–æ—Ç–∞ —Å —Å–µ—Å—Å–∏–µ–π
    """
    async with async_session_maker() as session:
        try:
            yield session
        except Exception as e:
            await session.rollback()
            raise e
        finally:
            await session.close()

async def create_tables():
    """
    –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
    –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    """
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)
    print("‚úÖ –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ")

async def drop_tables():
    """
    –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!)
    """
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.drop_all)
    print("üóëÔ∏è –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —É–¥–∞–ª–µ–Ω—ã")

async def get_db():
    """–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è get_async_session (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)"""
    async with async_session_maker() as session:
        yield session

# –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
async def get_session():
    """–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è get_async_session"""
    return get_async_session()
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\database\__init__.py =====
"""
–ü–∞–∫–µ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
"""
from .session import (
    Base,
    engine,
    async_session_maker,
    get_async_session,
    create_tables,
    drop_tables
)
from .models import User, Product
from .repository import UserRepository, ProductRepository

__all__ = [
    'Base',
    'engine',
    'async_session_maker',
    'get_async_session',
    'create_tables',
    'drop_tables',
    'User',
    'Product',
    'UserRepository',
    'ProductRepository'
]
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\admin_china.py =====
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository
from keyboards.admin import get_admin_main_menu
from keyboards.client import get_back_cancel_keyboard  # –ò–º–ø–æ—Ä—Ç –∏–∑ client.py
from utils.states import AdminChinaState

logger = logging.getLogger(__name__)
router = Router()

@router.message(AdminChinaState.main_menu, F.text.contains("‚¨ÖÔ∏è"))
async def admin_china_back(message: Message, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω–∞ –ö–∏—Ç–∞—è"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω–∞ –ö–∏—Ç–∞—è:",
            "tj": "–ú–µ–Ω—é–∏ –∞—Å–æ—Å–∏–∏ –∞–¥–º–∏–Ω–∏ –ß–∏–Ω:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_admin_main_menu("admin_cn", user.language)
        )
        await state.set_state(AdminChinaState.main_menu)

@router.message(AdminChinaState.main_menu, F.text.contains("‚ûï"))
async def add_products_start(message: Message, state: FSMContext):
    """–ù–∞—á–∞–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": "‚ûï <b>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤</b>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (1-100):",
            "tj": "‚ûï <b>–ò–ª–æ–≤–∞ –∫–∞—Ä–¥–∞–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç“≥–æ</b>\n\n"
                  "–ú–∏“õ–¥–æ—Ä–∏ –º–∞“≥—Å—É–ª–æ—Ç“≥–æ—Ä–æ –±–∞—Ä–æ–∏ –∏–ª–æ–≤–∞ –∫–∞—Ä–¥–∞–Ω –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (1-100):"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(AdminChinaState.add_product)

@router.message(AdminChinaState.add_product)
async def add_products_process(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç", "‚ùå –û—Ç–º–µ–Ω–∞", "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"]:
        await admin_china_back(message, state)
        return
    
    if not message.text.isdigit() or not (1 <= int(message.text) <= 100):
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            if not user:
                return
            
            texts = {
                "ru": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100:",
                "tj": "–õ—É—Ç—Ñ–∞–Ω, —Ä–∞“õ–∞–º–∏ –∞–∑ 1 —Ç–æ 100 –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:"
            }
            
            await message.answer(texts[user.language])
            return
    
    count = int(message.text)
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        from services.track_code import generate_track_code
        
        track_codes = []
        for i in range(count):
            track_code = generate_track_code()
            track_codes.append(track_code)
        
        texts = {
            "ru": f"‚úÖ –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ {count} —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ç—Ä–µ–∫-–∫–æ–¥–∞–º–∏:\n\n" + "\n".join(track_codes),
            "tj": f"‚úÖ {count} –º–∞“≥—Å—É–ª–æ—Ç –±–æ —Ä–∞–º–∑“≥–æ–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω —Å–æ—Ö—Ç–∞ –º–µ—à–∞–≤–∞–¥:\n\n" + "\n".join(track_codes)
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_admin_main_menu("admin_cn", user.language)
        )
        await state.set_state(AdminChinaState.main_menu)

@router.message(AdminChinaState.main_menu, F.text.contains("üîÑ"))
async def bulk_update_start(message: Message):
    """–ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": "üîÑ <b>–ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤</b>\n\n"
                  "–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...",
            "tj": "üîÑ <b>–ù–∞–≤—Å–æ–∑–∏–∏ –æ–º–º–∞–≤–∏–∏ —Å—Ç–∞—Ç—É—Å“≥–æ</b>\n\n"
                  "–§—É–Ω–∫—Å–∏—è –¥–∞—Ä —Ä—É—à–¥ –∞—Å—Ç..."
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_admin_main_menu("admin_cn", user.language),
            parse_mode="HTML"
        )

@router.message(AdminChinaState.main_menu, F.text.contains("üìä"))
async def reports_menu(message: Message, state: FSMContext):
    """–ú–µ–Ω—é –æ—Ç—á–µ—Ç–æ–≤"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": "üìä <b>–û—Ç—á–µ—Ç—ã</b>\n\n–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...",
            "tj": "üìä <b>“≤–∏—Å–æ–±–æ—Ç“≥–æ</b>\n\n–§—É–Ω–∫—Å–∏—è –¥–∞—Ä —Ä—É—à–¥ –∞—Å—Ç..."
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_admin_main_menu("admin_cn", user.language),
            parse_mode="HTML"
        )
        await state.set_state(AdminChinaState.main_menu)
@router.message(AdminChinaState.main_menu, F.text.contains("üîç"))
async def check_product_china(message: Message, state: FSMContext):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞ –ö–∏—Ç–∞—è"""
    from handlers.admin.product_info import check_product_menu
    await check_product_menu(message, state)
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\admin_export.py =====
"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
"""
import logging
from aiogram import Router, F
from aiogram.types import Message, FSInputFile
from aiogram.fsm.context import FSMContext
from datetime import datetime

from database.session import get_db
from database.repository import UserRepository, ProductRepository
from keyboards.admin import get_admin_main_keyboard as get_admin_main_menu
from utils.states import AdminState

logger = logging.getLogger(__name__)
router = Router()

@router.message(F.text.contains("üíæ –≠–∫—Å–ø–æ—Ä—Ç"))
async def admin_export_excel(message: Message, state: FSMContext):
    """–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ Excel –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        product_repo = ProductRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        # –ü–æ–ª—É—á–∞–µ–º –í–°–ï —Ç–æ–≤–∞—Ä—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        from sqlalchemy import select
        result = await session.execute(select(ProductRepository.model))
        all_products = result.scalars().all()
        
        if not all_products:
            texts = {
                "ru": "‚ùå –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞",
                "tj": "‚ùå –î–∞—Ä –ø–æ–π–≥–æ“≥–∏ –º–∞—ä–ª—É–º–æ—Ç –º–∞“≥—Å—É–ª–æ—Ç –±–∞—Ä–æ–∏ —ç–∫—Å–ø–æ—Ä—Ç –Ω–µ—Å—Ç"
            }
            await message.answer(texts[user.language])
            return
        
        try:
            # –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤ Excel
            excel_data = await product_repo.export_to_excel(all_products)
            
            if not excel_data:
                raise Exception("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å Excel —Ñ–∞–π–ª")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
            import os
            
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            filename = f"–≤—Å—è_–±–∞–∑–∞_–¥–∞–Ω–Ω—ã—Ö_{timestamp}.xlsx"
            
            with open(filename, "wb") as f:
                f.write(excel_data)
            
            texts = {
                "ru": f"üíæ <b>–≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω!</b>\n\n"
                      f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(all_products)}\n"
                      f"–î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: {datetime.now().strftime('%d.%m.%Y %H:%M')}",
                "tj": f"üíæ <b>–≠–∫—Å–ø–æ—Ä—Ç–∏ –ø–æ–π–≥–æ“≥–∏ –º–∞—ä–ª—É–º–æ—Ç –∞–Ω“∑–æ–º —ë—Ñ—Ç!</b>\n\n"
                      f"–ú–∏“õ–¥–æ—Ä–∏ –º–∞“≥—Å—É–ª–æ—Ç: {len(all_products)}\n"
                      f"–°–∞–Ω–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç: {datetime.now().strftime('%d.%m.%Y %H:%M')}"
            }
            
            await message.answer(texts[user.language], parse_mode="HTML")
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∞–π–ª
            file = FSInputFile(filename, filename=filename)
            await message.answer_document(file)
            
            # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
            os.remove(filename)
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ Excel: {e}")
            texts = {
                "ru": f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Excel —Ñ–∞–π–ª–∞: {str(e)}",
                "tj": f"‚ùå –•–∞—Ç–æ –¥–∞—Ä —Å–æ—Ö—Ç–∞–Ω–∏ —Ñ–∞–π–ª–∏ Excel: {str(e)}"
            }
            await message.answer(texts[user.language])
        
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        role = "admin_cn" if "admin_cn" in user.role.value else "admin_tj"
        await message.answer(
            "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:" if user.language == "ru" else "–ú–µ–Ω—é–∏ –∞—Å–æ—Å–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:",
            reply_markup=get_admin_main_menu(role, user.language)
        )
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\admin_tajikistan.py =====
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository
from keyboards.admin import get_admin_main_menu
from keyboards.client import get_back_cancel_keyboard  # –ò–º–ø–æ—Ä—Ç –∏–∑ client.py
from utils.states import AdminTajikistanState

logger = logging.getLogger(__name__)
router = Router()

@router.message(AdminTajikistanState.main_menu, F.text.contains("‚¨ÖÔ∏è"))
async def admin_tj_back(message: Message, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω–∞ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω–∞ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–∞:",
            "tj": "–ú–µ–Ω—é–∏ –∞—Å–æ—Å–∏–∏ –∞–¥–º–∏–Ω–∏ –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_admin_main_menu("admin_tj", user.language)
        )
        await state.set_state(AdminTajikistanState.main_menu)

@router.message(AdminTajikistanState.main_menu, F.text.contains("‚úÖ"))
async def confirm_arrival_start(message: Message):
    """–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏–±—ã—Ç–∏—è —Ç–æ–≤–∞—Ä–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": "‚úÖ <b>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏–±—ã—Ç–∏—è</b>\n\n"
                  "–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...",
            "tj": "‚úÖ <b>–¢–∞—Å–¥–∏“õ –∫–∞—Ä–¥–∞–Ω–∏ –æ–º–∞–¥–∞–Ω</b>\n\n"
                  "–§—É–Ω–∫—Å–∏—è –¥–∞—Ä —Ä—É—à–¥ –∞—Å—Ç..."
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_admin_main_menu("admin_tj", user.language),
            parse_mode="HTML"
        )

@router.message(AdminTajikistanState.main_menu, F.text.contains("‚úèÔ∏è"))
async def update_status_start(message: Message):
    """–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ–≤–∞—Ä–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": "‚úèÔ∏è <b>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞</b>\n\n"
                  "–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...",
            "tj": "‚úèÔ∏è <b>–¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ —Å—Ç–∞—Ç—É—Å</b>\n\n"
                  "–§—É–Ω–∫—Å–∏—è –¥–∞—Ä —Ä—É—à–¥ –∞—Å—Ç..."
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_admin_main_menu("admin_tj", user.language),
            parse_mode="HTML"
        )

@router.message(AdminTajikistanState.main_menu, F.text.contains("üöö"))
async def door_delivery_management(message: Message):
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–æ–π –¥–æ –¥–≤–µ—Ä–µ–π"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": "üöö <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–æ–π –¥–æ –¥–≤–µ—Ä–µ–π</b>\n\n"
                  "–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...",
            "tj": "üöö <b>–ò–¥–æ—Ä–∞–∫—É–Ω–∏–∏ —Ä–∞—Å–æ–Ω–∏–¥–∞–Ω —Ç–æ –¥–∞—Ä</b>\n\n"
                  "–§—É–Ω–∫—Å–∏—è –¥–∞—Ä —Ä—É—à–¥ –∞—Å—Ç..."
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_admin_main_menu("admin_tj", user.language),
            parse_mode="HTML"
        )

@router.message(AdminTajikistanState.main_menu, F.text.contains("üìä"))
async def reports_menu_tj(message: Message):
    """–ú–µ–Ω—é –æ—Ç—á–µ—Ç–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω–∞ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": "üìä <b>–û—Ç—á–µ—Ç—ã</b>\n\n–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...",
            "tj": "üìä <b>“≤–∏—Å–æ–±–æ—Ç“≥–æ</b>\n\n–§—É–Ω–∫—Å–∏—è –¥–∞—Ä —Ä—É—à–¥ –∞—Å—Ç..."
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_admin_main_menu("admin_tj", user.language),
            parse_mode="HTML"
        )
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\common.py =====
"""
–û–±—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
"""
import logging
from aiogram import Router, F
from aiogram.filters import CommandStart
from aiogram.types import Message, ReplyKeyboardRemove, Contact
from aiogram.fsm.context import FSMContext
from aiogram.types import KeyboardButton
from aiogram.utils.keyboard import ReplyKeyboardBuilder

from database.session import get_db
from database.repository import UserRepository
from keyboards.client import get_language_keyboard, get_main_menu_keyboard
from utils.states import LanguageState, ClientState
from config import settings

logger = logging.getLogger(__name__)

# –°–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä
common_router = Router()

@common_router.message(CommandStart())
async def cmd_start(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    logger.info(f"–ö–æ–º–∞–Ω–¥–∞ /start –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {message.from_user.id}")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if user:
            # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω")
            await message.answer(
                get_welcome_text(user.language),
                reply_markup=get_main_menu_keyboard(user.language)
            )
            await state.set_state(ClientState.main_menu)
        else:
            # –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            logger.info(f"–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id}")
            await message.answer(
                "üá∑üá∫ –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ / üáπüáØ –ó–∞–±–æ–Ω–∏ —Ö—É–¥—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥\n\n"
                "üá∑üá∫ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫:\n"
                "üáπüáØ –õ—É—Ç—Ñ–∞–Ω, –∑–∞–±–æ–Ω–∏ —Ö—É–¥—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:",
                reply_markup=get_language_keyboard()
            )
            await state.set_state(LanguageState.choosing_language)

@common_router.message(LanguageState.choosing_language)
async def process_language_choice(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞ - –¢–û–õ–¨–ö–û –≤—ã–±–æ—Ä —è–∑—ã–∫–∞, –Ω–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã"""
    logger.info(f"–í—ã–±–æ—Ä —è–∑—ã–∫–∞: {message.text}")
    
    language_map = {
        "üá∑üá∫ –†—É—Å—Å–∫–∏–π": "ru",
        "üá∑üá∫ —Ä—É—Å—Å–∫–∏–π": "ru",
        "üáπüáØ –¢–æ“∑–∏–∫”£": "tj",
        "üáπüáØ —Ç–æ“∑–∏–∫”£": "tj"
    }
    
    chosen_language = language_map.get(message.text)
    
    if not chosen_language:
        # –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –≤—ã–±–æ—Ä —è–∑—ã–∫–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–∞–∂–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º"
        # –≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤—ã–±—Ä–∞–ª —è–∑—ã–∫
        await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.")
        return
    
    async for session in get_db():
        user_repo = UserRepository(session)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–æ–º
        is_admin = settings.is_admin(message.from_user.id)
        role = "admin_cn" if is_admin else "client"
        
        user = await user_repo.create_user(
            telegram_id=message.from_user.id,
            full_name=message.from_user.full_name,
            language=chosen_language,
            role=role
        )
        
        logger.info(f"–°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ID={user.id}, —Ä–æ–ª—å={role}, —è–∑—ã–∫={chosen_language}")
        
        if role == "client":
            await message.answer(
                get_welcome_text(chosen_language),
                reply_markup=ReplyKeyboardRemove()
            )
            
            # –ó–∞–ø—Ä–æ—Å –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            texts = {
                "ru": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:",
                "tj": "–õ—É—Ç—Ñ–∞–Ω, –±–∞—Ä–æ–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ç—Å–∏—è —Ä–∞“õ–∞–º–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∏ —Ö—É–¥—Ä–æ –º—É–±–æ–¥–∏–ª–∞ –∫—É–Ω–µ–¥:"
            }
            
            keyboard = ReplyKeyboardBuilder()
            keyboard.add(KeyboardButton(
                text="üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º" if chosen_language == "ru" else "üì± –†–∞“õ–∞–º–∏ —Ö—É–¥—Ä–æ –º—É–±–æ–¥–∏–ª–∞ –∫—É–Ω–µ–¥",
                request_contact=True
            ))
            keyboard.add(KeyboardButton(
                text="‚ùå –û—Ç–º–µ–Ω–∞" if chosen_language == "ru" else "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"
            ))
            
            await message.answer(
                texts[chosen_language],
                reply_markup=keyboard.as_markup(resize_keyboard=True)
            )
            
            # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞
            await state.set_state(ClientState.waiting_for_contact)
            
        else:
            # –ê–¥–º–∏–Ω—ã - —Å—Ä–∞–∑—É –≤ –º–µ–Ω—é
            from keyboards.admin import get_admin_main_menu
            await message.answer(
                get_welcome_text(chosen_language, is_admin=True),
                reply_markup=get_admin_main_menu(role, chosen_language)
            )
            await state.clear()

# –î–æ–±–∞–≤–∏–º –æ—Ç–¥–µ–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞
@common_router.message(ClientState.waiting_for_contact, F.contact)
async def process_contact_in_waiting_state(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –ø–æ–¥–µ–ª–∏–ª—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è)")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        
        # –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        if not user:
            # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –µ–≥–æ —Å —è–∑—ã–∫–æ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            await message.answer("–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—á–Ω–∏—Ç–µ —Å /start")
            return
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        await user_repo.update_user_profile(
            telegram_id=message.from_user.id,
            phone=message.contact.phone_number
        )
        
        await message.answer(
            get_welcome_text(user.language),
            reply_markup=get_main_menu_keyboard(user.language)
        )
        await state.set_state(ClientState.main_menu)

# –¢–∞–∫–∂–µ –æ—Å—Ç–∞–≤–∏–º –æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
@common_router.message(F.contact)
async def process_contact_general(message: Message, state: FSMContext):
    """–û–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –ø–æ–¥–µ–ª–∏–ª—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫)")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç, –ø—Ä–æ—Å–∏–º –Ω–∞—á–∞—Ç—å —Å /start
            await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã /start")
            return
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        await user_repo.update_user_profile(
            telegram_id=message.from_user.id,
            phone=message.contact.phone_number
        )
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        await message.answer(
            get_welcome_text(user.language),
            reply_markup=get_main_menu_keyboard(user.language)
        )
        await state.set_state(ClientState.main_menu)

@common_router.message(F.text.contains("‚ùå"))
async def cmd_cancel(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –Ω–∞–∂–∞–ª –æ—Ç–º–µ–Ω—É")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if user:
            await message.answer(
                "–î–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ. –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:" if user.language == "ru" else "–ê–º–∞–ª –±–µ–∫–æ—Ä –∫–∞—Ä–¥–∞ —à—É–¥. –ú–µ–Ω—é–∏ –∞—Å–æ—Å”£:",
                reply_markup=get_main_menu_keyboard(user.language)
            )
            await state.set_state(ClientState.main_menu)
        else:
            # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç, –ø—Ä–æ—Å–∏–º –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
            await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—á–Ω–∏—Ç–µ —Å –∫–æ–º–∞–Ω–¥—ã /start")

def get_welcome_text(language: str = "ru", is_admin: bool = False):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"""
    if is_admin:
        return {
            "ru": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!",
            "tj": "–ë–∞ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Ö—É—à –æ–º–∞–¥–µ–¥!"
        }[language]
    else:
        return {
            "ru": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ –º–µ–Ω—é:",
            "tj": "–•—É—à –æ–º–∞–¥–µ–¥! –ê–º–∞–ª—Ä–æ –∞–∑ –º–µ–Ω—é –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"
        }[language]
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\admin\add_product.py =====
"""
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
"""
import logging
from datetime import datetime
from aiogram import Router, F
from aiogram.fsm.context import FSMContext
from aiogram.types import Message, CallbackQuery
from sqlalchemy import select
from sqlalchemy.ext.asyncio import AsyncSession

from database.models import Product
from database.session import async_session_maker
from utils.states import AdminStates
from keyboards.admin import (
    get_back_to_admin_keyboard,
    get_product_categories_keyboard,
    get_yes_no_keyboard
)
from services.track_code_generator import generate_track_code
from config import settings

logger = logging.getLogger(__name__)
add_product_router = Router()

@add_product_router.callback_query(F.data == "admin_add_product")
async def add_product_start(callback: CallbackQuery, state: FSMContext):
    """–ù–∞—á–∞–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    if not settings.is_admin(callback.from_user.id):
        await callback.answer("‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω", show_alert=True)
        return
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç—Ä–µ–∫-–∫–æ–¥
    track_code = generate_track_code()
    
    await state.update_data(
        track_code=track_code,
        user_id=callback.from_user.id
    )
    
    await callback.message.edit_text(
        f"üì¶ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞\n\n"
        f"üìã –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Ç—Ä–µ–∫-–∫–æ–¥: {track_code}\n\n"
        f"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:",
        reply_markup=get_back_to_admin_keyboard()
    )
    
    await state.set_state(AdminStates.WAITING_PRODUCT_NAME)
    await callback.answer()

@add_product_router.message(AdminStates.WAITING_PRODUCT_NAME)
async def process_product_name(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    product_name = message.text.strip()
    
    if len(product_name) < 2:
        await message.answer(
            "‚ùå –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:",
            reply_markup=get_back_to_admin_keyboard()
        )
        return
    
    await state.update_data(product_name=product_name)
    
    await message.answer(
        "üìã –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞:",
        reply_markup=get_product_categories_keyboard()
    )
    
    await state.set_state(AdminStates.WAITING_PRODUCT_CATEGORY)

@add_product_router.callback_query(F.data.startswith("category_"))
async def process_product_category(callback: CallbackQuery, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞"""
    category = callback.data.replace("category_", "")
    
    await state.update_data(product_category=category)
    
    await callback.message.edit_text(
        "üî¢ –í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ):",
        reply_markup=get_back_to_admin_keyboard()
    )
    
    await state.set_state(AdminStates.WAITING_PRODUCT_QUANTITY)
    await callback.answer()

@add_product_router.message(AdminStates.WAITING_PRODUCT_QUANTITY)
async def process_product_quantity(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞"""
    try:
        quantity = int(message.text.strip())
        if quantity <= 0:
            raise ValueError
    except ValueError:
        await message.answer(
            "‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ. –í–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–æ–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ:",
            reply_markup=get_back_to_admin_keyboard()
        )
        return
    
    await state.update_data(quantity=quantity)
    
    await message.answer(
        "üí∞ –í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –∑–∞ –µ–¥–∏–Ω–∏—Ü—É (–≤ –¥–æ–ª–ª–∞—Ä–∞—Ö –°–®–ê):\n"
        "–ü—Ä–∏–º–µ—Ä: 15.50",
        reply_markup=get_back_to_admin_keyboard()
    )
    
    await state.set_state(AdminStates.WAITING_PRODUCT_PRICE)

@add_product_router.message(AdminStates.WAITING_PRODUCT_PRICE)
async def process_product_price(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞"""
    try:
        price = float(message.text.strip())
        if price <= 0:
            raise ValueError
    except ValueError:
        await message.answer(
            "‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Ü–µ–Ω–∞. –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 15.50):",
            reply_markup=get_back_to_admin_keyboard()
        )
        return
    
    await state.update_data(unit_price_usd=price)
    
    await message.answer(
        "‚öñÔ∏è –í–≤–µ–¥–∏—Ç–µ –≤–µ—Å —Ç–æ–≤–∞—Ä–∞ –≤ –∫–∏–ª–æ–≥—Ä–∞–º–º–∞—Ö:\n"
        "–ü—Ä–∏–º–µ—Ä: 2.5",
        reply_markup=get_back_to_admin_keyboard()
    )
    
    await state.set_state(AdminStates.WAITING_PRODUCT_WEIGHT)

@add_product_router.message(AdminStates.WAITING_PRODUCT_WEIGHT)
async def process_product_weight(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ—Å–∞ —Ç–æ–≤–∞—Ä–∞"""
    try:
        weight = float(message.text.strip())
        if weight <= 0:
            raise ValueError
    except ValueError:
        await message.answer(
            "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤–µ—Å. –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 2.5):",
            reply_markup=get_back_to_admin_keyboard()
        )
        return
    
    await state.update_data(weight_kg=weight)
    
    await message.answer(
        "üì¶ –¢–æ–≤–∞—Ä —Ö—Ä—É–ø–∫–∏–π?\n"
        "(–ª–µ–≥–∫–æ –±—å–µ—Ç—Å—è, —Ç—Ä–µ–±—É–µ—Ç –æ—Å–æ–±–æ–π —É–ø–∞–∫–æ–≤–∫–∏)",
        reply_markup=get_yes_no_keyboard("fragile")
    )
    
    await state.set_state(AdminStates.WAITING_PRODUCT_SPECIAL)

@add_product_router.callback_query(F.data.startswith("fragile_"))
async def process_fragile(callback: CallbackQuery, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ö—Ä—É–ø–∫–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞"""
    fragile = callback.data.replace("fragile_", "") == "yes"
    
    await state.update_data(fragile=fragile)
    
    await callback.message.edit_text(
        "üîã –¢–æ–≤–∞—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∞—Ç–∞—Ä–µ–∏ –∏–ª–∏ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä—ã?",
        reply_markup=get_yes_no_keyboard("battery")
    )
    
    await state.set_state(AdminStates.WAITING_PRODUCT_SPECIAL)
    await callback.answer()

@add_product_router.callback_query(F.data.startswith("battery_"))
async def process_battery(callback: CallbackQuery, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–ª–∏—á–∏—è –±–∞—Ç–∞—Ä–µ–∏"""
    has_battery = callback.data.replace("battery_", "") == "yes"
    
    await state.update_data(has_battery=has_battery)
    
    await callback.message.edit_text(
        "üíß –¢–æ–≤–∞—Ä —è–≤–ª—è–µ—Ç—Å—è –∂–∏–¥–∫–æ—Å—Ç—å—é?",
        reply_markup=get_yes_no_keyboard("liquid")
    )
    
    await state.set_state(AdminStates.WAITING_PRODUCT_SPECIAL)
    await callback.answer()

@add_product_router.callback_query(F.data.startswith("liquid_"))
async def process_liquid(callback: CallbackQuery, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∂–∏–¥–∫–æ—Å—Ç–∏"""
    is_liquid = callback.data.replace("liquid_", "") == "yes"
    
    await state.update_data(is_liquid=is_liquid)
    
    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    await callback.message.edit_text(
        "üåç –í–≤–µ–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:\n"
        "–ü—Ä–∏–º–µ—Ä: –ö–∏—Ç–∞–π, –°–®–ê, –†–æ—Å—Å–∏—è",
        reply_markup=get_back_to_admin_keyboard()
    )
    
    await state.set_state(AdminStates.WAITING_PRODUCT_COUNTRY)
    await callback.answer()

@add_product_router.message(AdminStates.WAITING_PRODUCT_COUNTRY)
async def process_country(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–∞–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è"""
    country = message.text.strip()
    
    await state.update_data(country_from=country)
    
    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏
    await message.answer(
        "üöö –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏:\n"
        "1. –ê–≤–∏–∞–¥–æ—Å—Ç–∞–≤–∫–∞ (–±—ã—Å—Ç—Ä–æ, –¥–æ—Ä–æ–≥–æ)\n"
        "2. –ú–æ—Ä—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ (–º–µ–¥–ª–µ–Ω–Ω–æ, –¥–µ—à–µ–≤–æ)\n"
        "3. –ê–≤—Ç–æ–¥–æ—Å—Ç–∞–≤–∫–∞\n"
        "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ:",
        reply_markup=get_back_to_admin_keyboard()
    )
    
    await state.set_state(AdminStates.WAITING_DELIVERY_TYPE)

@add_product_router.message(AdminStates.WAITING_DELIVERY_TYPE)
async def process_delivery_type(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–∞ –¥–æ—Å—Ç–∞–≤–∫–∏"""
    delivery_type = message.text.strip()
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ –≤–≤–æ–¥—É
    if delivery_type in ["1", "–∞–≤–∏–∞", "–∞–≤–∏–∞–¥–æ—Å—Ç–∞–≤–∫–∞", "aviation"]:
        delivery_type = "–ê–≤–∏–∞–¥–æ—Å—Ç–∞–≤–∫–∞"
    elif delivery_type in ["2", "–º–æ—Ä—Å–∫–∞—è", "–º–æ—Ä–µ", "sea"]:
        delivery_type = "–ú–æ—Ä—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞"
    elif delivery_type in ["3", "–∞–≤—Ç–æ", "–∞–≤—Ç–æ–¥–æ—Å—Ç–∞–≤–∫–∞", "car"]:
        delivery_type = "–ê–≤—Ç–æ–¥–æ—Å—Ç–∞–≤–∫–∞"
    
    await state.update_data(delivery_type=delivery_type)
    
    # –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
    data = await state.get_data()
    
    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
    quantity = data.get('quantity', 1)
    unit_price = data.get('unit_price_usd', 0)
    total_value = quantity * unit_price
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–≤–æ–¥–∫—É
    summary = f"üìã –°–≤–æ–¥–∫–∞ –ø–æ —Ç–æ–≤–∞—Ä—É:\n\n"
    summary += f"üì¶ –¢—Ä–µ–∫-–∫–æ–¥: {data.get('track_code')}\n"
    summary += f"üìù –ù–∞–∑–≤–∞–Ω–∏–µ: {data.get('product_name')}\n"
    summary += f"üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {data.get('product_category')}\n"
    summary += f"üî¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {quantity} —à—Ç.\n"
    summary += f"üí∞ –¶–µ–Ω–∞ –∑–∞ –µ–¥.: ${unit_price:.2f}\n"
    summary += f"üíµ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${total_value:.2f}\n"
    summary += f"‚öñÔ∏è –í–µ—Å: {data.get('weight_kg')} –∫–≥\n"
    summary += f"üéØ –•—Ä—É–ø–∫–∏–π: {'–î–∞' if data.get('fragile') else '–ù–µ—Ç'}\n"
    summary += f"üîã –ë–∞—Ç–∞—Ä–µ—è: {'–î–∞' if data.get('has_battery') else '–ù–µ—Ç'}\n"
    summary += f"üíß –ñ–∏–¥–∫–æ—Å—Ç—å: {'–î–∞' if data.get('is_liquid') else '–ù–µ—Ç'}\n"
    summary += f"üåç –°—Ç—Ä–∞–Ω–∞: {data.get('country_from')}\n"
    summary += f"üöö –î–æ—Å—Ç–∞–≤–∫–∞: {delivery_type}\n\n"
    summary += f"‚úÖ –í—Å–µ –≤–µ—Ä–Ω–æ? (–¥–∞/–Ω–µ—Ç)"
    
    await message.answer(
        summary,
        reply_markup=get_yes_no_keyboard("confirm")
    )
    
    await state.update_data(total_value_usd=total_value)
    await state.set_state(AdminStates.WAITING_CONFIRMATION)

@add_product_router.callback_query(F.data.startswith("confirm_"))
async def process_confirmation(callback: CallbackQuery, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"""
    confirm = callback.data.replace("confirm_", "") == "yes"
    
    if not confirm:
        await callback.message.edit_text(
            "‚ùå –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ—Ç–º–µ–Ω–µ–Ω–æ.",
            reply_markup=get_back_to_admin_keyboard()
        )
        await state.clear()
        await callback.answer()
        return
    
    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    data = await state.get_data()
    
    # –°–æ–∑–¥–∞–µ–º —Ç–æ–≤–∞—Ä –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    async with async_session_maker() as session:
        product_data = {
            "track_code": data.get('track_code'),
            "user_id": data.get('user_id'),
            "product_name": data.get('product_name'),
            "product_category": data.get('product_category'),
            "quantity": data.get('quantity'),
            "unit_price_usd": data.get('unit_price_usd'),
            "total_value_usd": data.get('total_value_usd'),
            "weight_kg": data.get('weight_kg'),
            "fragile": data.get('fragile', False),
            "has_battery": data.get('has_battery', False),
            "is_liquid": data.get('is_liquid', False),
            "status": "CREATED",
            "country_from": data.get('country_from'),
            "delivery_type": data.get('delivery_type'),
            "send_date": datetime.utcnow(),
            "created_at": datetime.utcnow(),
            "updated_at": datetime.utcnow()
        }
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–æ–≤–∞—Ä–∞ —Å —Ç–∞–∫–∏–º —Ç—Ä–µ–∫-–∫–æ–¥–æ–º
        existing_query = select(Product).where(Product.track_code == data.get('track_code'))
        result = await session.execute(existing_query)
        existing_product = result.scalar_one_or_none()
        
        if existing_product:
            await callback.message.edit_text(
                f"‚ùå –¢–æ–≤–∞—Ä —Å —Ç—Ä–µ–∫-–∫–æ–¥–æ–º {data.get('track_code')} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.",
                reply_markup=get_back_to_admin_keyboard()
            )
        else:
            # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä
            new_product = Product(**product_data)
            session.add(new_product)
            await session.commit()
            
            await callback.message.edit_text(
                f"‚úÖ –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!\n\n"
                f"üì¶ –¢—Ä–µ–∫-–∫–æ–¥: {data.get('track_code')}\n"
                f"üìù –ù–∞–∑–≤–∞–Ω–∏–µ: {data.get('product_name')}\n"
                f"üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {data.get('product_category')}\n"
                f"üî¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {data.get('quantity')} —à—Ç.\n"
                f"üí∞ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${data.get('total_value_usd'):.2f}\n\n"
                f"üìä –°—Ç–∞—Ç—É—Å: CREATED\n"
                f"‚è∞ –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: {datetime.utcnow().strftime('%d.%m.%Y %H:%M')}",
                reply_markup=get_back_to_admin_keyboard()
            )
    
    await state.clear()
    await callback.answer()
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\admin\main_menu.py =====
"""
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
"""
import logging
from aiogram import Router, F
from aiogram.types import Message, CallbackQuery
from aiogram.filters import Command
from config import settings

from keyboards.admin import get_admin_main_keyboard

logger = logging.getLogger(__name__)
admin_main_router = Router()

@admin_main_router.message(Command("admin"))
async def admin_command(message: Message):
    """–ö–æ–º–∞–Ω–¥–∞ /admin –¥–ª—è –∞–¥–º–∏–Ω–æ–≤"""
    if not settings.is_admin(message.from_user.id):
        await message.answer("‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω")
        return
    
    admin_role = settings.get_admin_role(message.from_user.id)
    await message.answer(
        f"üë®‚Äçüíº –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å | –†–æ–ª—å: {admin_role}\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        reply_markup=get_admin_main_keyboard(admin_role)
    )

@admin_main_router.callback_query(F.data == "admin_menu")
async def admin_menu_callback(callback: CallbackQuery):
    """–í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω–∞"""
    if not settings.is_admin(callback.from_user.id):
        await callback.answer("‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω", show_alert=True)
        return
    
    admin_role = settings.get_admin_role(callback.from_user.id)
    await callback.message.edit_text(
        f"üë®‚Äçüíº –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å | –†–æ–ª—å: {admin_role}\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        reply_markup=get_admin_main_keyboard(admin_role)
    )
    await callback.answer()
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\admin\product_info.py =====
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import ProductRepository
from keyboards.admin import get_admin_main_menu
from utils.states import AdminChinaState, AdminTajikistanState

logger = logging.getLogger(__name__)
router = Router()

@router.message(F.text.regexp(r'^[A-Z0-9]{8,20}$'))
async def check_track_code_by_admin(message: Message, state: FSMContext):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–∫-–∫–æ–¥–∞ –∞–¥–º–∏–Ω–æ–º (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ —Ç—Ä–µ–∫-–∫–æ–¥–∞)"""
    track_code = message.text.strip()
    
    async for session in get_db():
        product_repo = ProductRepository(session)
        detailed_info = await product_repo.get_detailed_product_info(track_code)
        
        if not detailed_info:
            await message.answer(f"‚ùå –¢–æ–≤–∞—Ä —Å —Ç—Ä–µ–∫-–∫–æ–¥–æ–º {track_code} –Ω–µ –Ω–∞–π–¥–µ–Ω.")
            return
        
        product = detailed_info["product"]
        user = detailed_info["user"]
        product_info = detailed_info["product_info"]
        user_info = detailed_info["user_info"]
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ
        category_text = product_info["category"] or "–ù–µ —É–∫–∞–∑–∞–Ω–∞"
        description_text = product_info["description"] or "–ù–µ —É–∫–∞–∑–∞–Ω–æ"
        dimensions_text = product_info["dimensions"] or "–ù–µ —É–∫–∞–∑–∞–Ω—ã"
        
        special_properties = []
        if product_info["fragile"]:
            special_properties.append("‚ö†Ô∏è –•—Ä—É–ø–∫–∏–π")
        if product_info["has_battery"]:
            special_properties.append("üîã –° –±–∞—Ç–∞—Ä–µ–µ–π")
        if product_info["is_liquid"]:
            special_properties.append("üíß –ñ–∏–¥–∫–æ—Å—Ç—å")
        special_text = "\n".join(special_properties) if special_properties else "–ù–µ—Ç –æ—Å–æ–±—ã—Ö —Å–≤–æ–π—Å—Ç–≤"
        
        text = f"""üì¶ <b>–î–ï–¢–ê–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –¢–û–í–ê–†–ï</b>

üéØ <b>–¢—Ä–µ–∫-–∫–æ–¥:</b> <code>{track_code}</code>

üë§ <b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ:</b>
‚îú –ò–º—è: {user_info["name"] or "–ù–µ —É–∫–∞–∑–∞–Ω–æ"}
‚îú –¢–µ–ª–µ—Ñ–æ–Ω: {user_info["phone"] or "–ù–µ —É–∫–∞–∑–∞–Ω"}
‚îú –†–µ–≥–∏–æ–Ω: {user_info["region"] or "–ù–µ —É–∫–∞–∑–∞–Ω"}
‚îî Telegram ID: {user_info["telegram_id"]}

üè∑Ô∏è <b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ:</b>
‚îú –ù–∞–∑–≤–∞–Ω–∏–µ: {product_info["name"] or "–ù–µ —É–∫–∞–∑–∞–Ω–æ"}
‚îú –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category_text}
‚îú –û–ø–∏—Å–∞–Ω–∏–µ: {description_text}
‚îú –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {product_info["quantity"]} —à—Ç.
‚îú –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É: ${product_info["unit_price"]:.2f}
‚îú –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${product_info["total_value"]:.2f}
‚îú –í–µ—Å: {product_info["weight"]:.2f} –∫–≥
‚îú –ì–∞–±–∞—Ä–∏—Ç—ã: {dimensions_text}
‚îî –û—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞: {special_text}

üìä <b>–°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</b>
‚îú –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: {product.status.value}
‚îú –°—Ç—Ä–∞–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è: {product.country_from or "–ù–µ —É–∫–∞–∑–∞–Ω–∞"}
‚îî –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: {product.created_at.strftime('%d.%m.%Y %H:%M')}"""
        
        await message.answer(text, parse_mode="HTML")
        
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∞–¥–º–∏–Ω–∞ –≤ –µ–≥–æ –º–µ–Ω—é
        current_state = await state.get_state()
        if current_state in [AdminChinaState.main_menu, AdminTajikistanState.main_menu]:
            from keyboards.admin import get_admin_main_menu
            await message.answer(
                "–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é:",
                reply_markup=get_admin_main_menu("admin_cn" if "china" in str(current_state) else "admin_tj")
            )

@router.message(F.text.contains("üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–≤–∞—Ä"))
async def check_product_menu(message: Message, state: FSMContext):
    """–ú–µ–Ω—é –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤"""
    text = """üîç <b>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≤–∞—Ä–∞</b>

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–≤–∞—Ä–µ –ø—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ –µ–≥–æ —Ç—Ä–µ–∫-–∫–æ–¥.

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≤–∏–¥—è—Ç:
‚Ä¢ –ü–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ
‚Ä¢ –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
‚Ä¢ –°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏
‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç—Ä–µ–∫-–∫–æ–¥ –≤ —á–∞—Ç."""
    
    await message.answer(text, parse_mode="HTML")
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\admin\profile.py =====
"""
–ü—Ä–æ—Ñ–∏–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
"""
import logging
from datetime import datetime
from aiogram import Router, F
from aiogram.types import Message, CallbackQuery
from sqlalchemy import select
from sqlalchemy.ext.asyncio import AsyncSession
from datetime import timedelta

from database.models import User
from database.session import get_async_session
from keyboards.admin import get_back_to_admin_keyboard
from config import settings

logger = logging.getLogger(__name__)
admin_profile_router = Router()

@admin_profile_router.callback_query(F.data == "admin_profile")
async def admin_profile(callback: CallbackQuery):
    """–ü—Ä–æ—Ñ–∏–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    if not settings.is_admin(callback.from_user.id):
        await callback.answer("‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω", show_alert=True)
        return
    
    user_id = callback.from_user.id
    admin_role = settings.get_admin_role(user_id)
    
    async with get_async_session() as session:
        # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        query = select(User).where(User.telegram_id == user_id)
        result = await session.execute(query)
        user = result.scalar_one_or_none()
        
        if not user:
            await callback.message.edit_text(
                "‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö",
                reply_markup=get_back_to_admin_keyboard()
            )
            return
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–æ—Ñ–∏–ª—è
        profile_text = f"üë®‚Äçüíº –ü—Ä–æ—Ñ–∏–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n\n"
        
        profile_text += f"üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:\n"
        profile_text += f"  ‚Ä¢ ID: {user.id}\n"
        profile_text += f"  ‚Ä¢ Telegram ID: {user.telegram_id}\n"
        profile_text += f"  ‚Ä¢ –†–æ–ª—å: {admin_role}\n"
        
        if user.full_name:
            profile_text += f"  ‚Ä¢ –ò–º—è: {user.full_name}\n"
        
        if user.phone:
            profile_text += f"  ‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω: {user.phone}\n"
        
        if user.region:
            profile_text += f"  ‚Ä¢ –†–µ–≥–∏–æ–Ω: {user.region}\n"
        
        profile_text += f"  ‚Ä¢ –Ø–∑—ã–∫: {'–†—É—Å—Å–∫–∏–π' if user.language == 'ru' else '–¢–∞–¥–∂–∏–∫—Å–∫–∏–π' if user.language == 'tj' else user.language}\n"
        profile_text += f"  ‚Ä¢ –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {user.created_at.strftime('%d.%m.%Y %H:%M')}\n\n"
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∞
        from database.models import Product
        from sqlalchemy import func
        
        # –¢–æ–≤–∞—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–æ–º
        added_query = select(func.count(Product.id)).where(Product.user_id == user.id)
        result = await session.execute(added_query)
        added_count = result.scalar() or 0
        
        # –¢–æ–≤–∞—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–æ–º (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é)
        week_ago = datetime.utcnow() - timedelta(days=7)
        updated_query = select(func.count(Product.id)).where(
            Product.updated_at >= week_ago,
            Product.user_id == user.id
        )
        result = await session.execute(updated_query)
        updated_count = result.scalar() or 0
        
        profile_text += f"üìä –í–∞—à–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:\n"
        profile_text += f"  ‚Ä¢ –¢–æ–≤–∞—Ä–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ: {added_count}\n"
        profile_text += f"  ‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–æ –∑–∞ –Ω–µ–¥–µ–ª—é: {updated_count}\n\n"
        
        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
        from sqlalchemy import text
        
        # –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
        total_products_query = select(func.count(Product.id))
        result = await session.execute(total_products_query)
        total_products = result.scalar() or 0
        
        total_users_query = select(func.count(User.id))
        result = await session.execute(total_users_query)
        total_users = result.scalar() or 0
        
        profile_text += f"üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã:\n"
        profile_text += f"  ‚Ä¢ –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {total_users}\n"
        profile_text += f"  ‚Ä¢ –í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: {total_products}\n"
        
        # –í–µ—Ä—Å–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ SQLite)
        try:
            version_query = text("SELECT sqlite_version()")
            result = await session.execute(version_query)
            db_version = result.scalar()
            profile_text += f"  ‚Ä¢ –í–µ—Ä—Å–∏—è –ë–î: {db_version}\n"
        except:
            pass
        
        await callback.message.edit_text(
            profile_text,
            reply_markup=get_back_to_admin_keyboard()
        )
    
    await callback.answer()

@admin_profile_router.callback_query(F.data == "admin_system_info")
async def system_info(callback: CallbackQuery):
    """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ"""
    if not settings.is_admin(callback.from_user.id):
        await callback.answer("‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω", show_alert=True)
        return
    
    import platform
    import psutil
    from datetime import datetime
    
    # –°–æ–±–∏—Ä–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    system_text = "üñ•Ô∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ\n\n"
    
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
    system_text += "üìã –°–∏—Å—Ç–µ–º–∞:\n"
    system_text += f"  ‚Ä¢ –û–°: {platform.system()} {platform.release()}\n"
    system_text += f"  ‚Ä¢ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: {platform.machine()}\n"
    system_text += f"  ‚Ä¢ –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä: {platform.processor()}\n\n"
    
    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
    memory = psutil.virtual_memory()
    system_text += "üíæ –ü–∞–º—è—Ç—å:\n"
    system_text += f"  ‚Ä¢ –í—Å–µ–≥–æ: {memory.total / (1024**3):.1f} GB\n"
    system_text += f"  ‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: {memory.used / (1024**3):.1f} GB\n"
    system_text += f"  ‚Ä¢ –°–≤–æ–±–æ–¥–Ω–æ: {memory.available / (1024**3):.1f} GB\n"
    system_text += f"  ‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: {memory.percent}%\n\n"
    
    # –î–∏—Å–∫
    disk = psutil.disk_usage('/')
    system_text += "üíø –î–∏—Å–∫:\n"
    system_text += f"  ‚Ä¢ –í—Å–µ–≥–æ: {disk.total / (1024**3):.1f} GB\n"
    system_text += f"  ‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: {disk.used / (1024**3):.1f} GB\n"
    system_text += f"  ‚Ä¢ –°–≤–æ–±–æ–¥–Ω–æ: {disk.free / (1024**3):.1f} GB\n"
    system_text += f"  ‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: {disk.percent}%\n\n"
    
    # –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
    boot_time = datetime.fromtimestamp(psutil.boot_time())
    uptime = datetime.now() - boot_time
    system_text += "‚è∞ –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:\n"
    system_text += f"  ‚Ä¢ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã: {boot_time.strftime('%d.%m.%Y %H:%M')}\n"
    system_text += f"  ‚Ä¢ –ê–ø—Ç–∞–π–º: {uptime.days} –¥–Ω., {uptime.seconds//3600} —á.\n"
    
    await callback.message.edit_text(
        system_text,
        reply_markup=get_back_to_admin_keyboard()
    )
    
    await callback.answer()
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\admin\reports.py =====
"""
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
"""
import logging
from datetime import datetime, timedelta
from io import BytesIO
import pandas as pd
from aiogram import Router, F
from aiogram.types import Message, CallbackQuery
from sqlalchemy import select, func, extract
from sqlalchemy.ext.asyncio import AsyncSession

from database.models import Product
from database.session import async_session_maker
from keyboards.admin import get_reports_keyboard, get_back_to_admin_keyboard
from config import settings

logger = logging.getLogger(__name__)
reports_router = Router()

@reports_router.callback_query(F.data == "admin_reports")
async def reports_menu(callback: CallbackQuery):
    """–ú–µ–Ω—é –æ—Ç—á–µ—Ç–æ–≤"""
    if not settings.is_admin(callback.from_user.id):
        await callback.answer("‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω", show_alert=True)
        return
    
    await callback.message.edit_text(
        "üìä –û—Ç—á–µ—Ç—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ç—á–µ—Ç–∞:",
        reply_markup=get_reports_keyboard()
    )
    await callback.answer()

@reports_router.callback_query(F.data == "report_monthly_delivered")
async def monthly_delivered_report(callback: CallbackQuery):
    """–û—Ç—á–µ—Ç –ø–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º —Ç–æ–≤–∞—Ä–∞–º –∑–∞ –º–µ—Å—è—Ü"""
    async with async_session_maker() as session:
        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
        now = datetime.utcnow()
        current_month = now.month
        current_year = now.year
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
        query = select(func.count(Product.id)).where(
            Product.status == "DELIVERED",
            extract('month', Product.updated_at) == current_month,
            extract('year', Product.updated_at) == current_year
        )
        result = await session.execute(query)
        delivered_count = result.scalar() or 0
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤
        monthly_stats = []
        for i in range(6):
            month_date = now - timedelta(days=30*i)
            month = month_date.month
            year = month_date.year
            
            query = select(func.count(Product.id)).where(
                Product.status == "DELIVERED",
                extract('month', Product.updated_at) == month,
                extract('year', Product.updated_at) == year
            )
            result = await session.execute(query)
            count = result.scalar() or 0
            
            monthly_stats.append({
                "period": f"{month:02d}.{year}",
                "delivered": count
            })
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç
        report_text = f"üì¶ –û—Ç—á–µ—Ç –ø–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º —Ç–æ–≤–∞—Ä–∞–º\n\n"
        report_text += f"–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü ({current_month:02d}.{current_year}):\n"
        report_text += f"  ‚Ä¢ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {delivered_count}\n\n"
        
        report_text += "üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤:\n"
        for stat in monthly_stats:
            report_text += f"  ‚Ä¢ {stat['period']}: {stat['delivered']} —Ç–æ–≤–∞—Ä–æ–≤\n"
        
        await callback.message.edit_text(
            report_text,
            reply_markup=get_back_to_admin_keyboard()
        )
    
    await callback.answer()

@reports_router.callback_query(F.data == "report_monthly_received")
async def monthly_received_report(callback: CallbackQuery):
    """–û—Ç—á–µ—Ç –ø–æ –ø—Ä–∏–Ω—è—Ç—ã–º —Ç–æ–≤–∞—Ä–∞–º –∑–∞ –º–µ—Å—è—Ü"""
    async with async_session_maker() as session:
        now = datetime.utcnow()
        current_month = now.month
        current_year = now.year
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–Ω—è—Ç—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–ø—Ä–∏–±—ã–≤—à–∏—Ö –≤ TJ)
        query = select(func.count(Product.id)).where(
            Product.status == "ARRIVED_TJ",
            extract('month', Product.arrival_date) == current_month,
            extract('year', Product.arrival_date) == current_year
        )
        result = await session.execute(query)
        received_count = result.scalar() or 0
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
        status_query = select(
            Product.status,
            func.count(Product.id).label('count')
        ).where(
            extract('month', Product.created_at) == current_month,
            extract('year', Product.created_at) == current_year
        ).group_by(Product.status)
        
        result = await session.execute(status_query)
        status_stats = result.all()
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç
        report_text = f"üì• –û—Ç—á–µ—Ç –ø–æ –ø—Ä–∏–Ω—è—Ç—ã–º —Ç–æ–≤–∞—Ä–∞–º\n\n"
        report_text += f"–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü ({current_month:02d}.{current_year}):\n"
        report_text += f"  ‚Ä¢ –ü—Ä–∏–Ω—è—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤: {received_count}\n\n"
        
        report_text += "üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º:\n"
        for status, count in status_stats:
            if status:
                report_text += f"  ‚Ä¢ {status}: {count} —Ç–æ–≤–∞—Ä–æ–≤\n"
        
        # –°—Ä–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
        avg_query = select(
            func.avg(Product.quantity).label('avg_quantity'),
            func.avg(Product.total_value_usd).label('avg_value'),
            func.avg(Product.weight_kg).label('avg_weight')
        ).where(
            extract('month', Product.created_at) == current_month,
            extract('year', Product.created_at) == current_year
        )
        
        result = await session.execute(avg_query)
        avg_data = result.first()
        
        if avg_data:
            report_text += f"\nüìä –°—Ä–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:\n"
            report_text += f"  ‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: {avg_data.avg_quantity:.1f} —à—Ç.\n"
            report_text += f"  ‚Ä¢ –°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${avg_data.avg_value:.2f}\n"
            report_text += f"  ‚Ä¢ –°—Ä–µ–¥–Ω–∏–π –≤–µ—Å: {avg_data.avg_weight:.2f} –∫–≥\n"
        
        await callback.message.edit_text(
            report_text,
            reply_markup=get_back_to_admin_keyboard()
        )
    
    await callback.answer()

@reports_router.callback_query(F.data == "report_database_export")
async def database_export(callback: CallbackQuery):
    """–≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ Excel"""
    async with async_session_maker() as session:
        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
        query = select(Product)
        result = await session.execute(query)
        products = result.scalars().all()
        
        if not products:
            await callback.message.edit_text(
                "‚ùå –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞",
                reply_markup=get_back_to_admin_keyboard()
            )
            return
        
        # –°–æ–∑–¥–∞–µ–º DataFrame
        data = []
        for product in products:
            data.append({
                "ID": product.id,
                "–¢—Ä–µ–∫-–∫–æ–¥": product.track_code,
                "–ù–∞–∑–≤–∞–Ω–∏–µ": product.product_name,
                "–ö–∞—Ç–µ–≥–æ—Ä–∏—è": product.product_category,
                "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ": product.quantity,
                "–¶–µ–Ω–∞ –∑–∞ –µ–¥. ($)": product.unit_price_usd,
                "–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å ($)": product.total_value_usd,
                "–í–µ—Å (–∫–≥)": product.weight_kg,
                "–°—Ç–∞—Ç—É—Å": product.status,
                "–°—Ç—Ä–∞–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è": product.country_from,
                "–¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏": product.delivery_type,
                "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏": product.send_date,
                "–î–∞—Ç–∞ –ø—Ä–∏–±—ã—Ç–∏—è": product.arrival_date,
                "–•—Ä—É–ø–∫–∏–π": "–î–∞" if product.fragile else "–ù–µ—Ç",
                "–ë–∞—Ç–∞—Ä–µ—è": "–î–∞" if product.has_battery else "–ù–µ—Ç",
                "–ñ–∏–¥–∫–æ—Å—Ç—å": "–î–∞" if product.is_liquid else "–ù–µ—Ç",
                "–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è": product.created_at,
                "–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è": product.updated_at
            })
        
        df = pd.DataFrame(data)
        
        # –°–æ–∑–¥–∞–µ–º Excel —Ñ–∞–π–ª –≤ –ø–∞–º—è—Ç–∏
        output = BytesIO()
        with pd.ExcelWriter(output, engine='openpyxl') as writer:
            df.to_excel(writer, sheet_name='–¢–æ–≤–∞—Ä—ã', index=False)
            
            # –î–æ–±–∞–≤–ª—è–µ–º –ª–∏—Å—Ç —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
            stats_df = pd.DataFrame({
                '–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å': ['–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤', '–°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å', '–°—Ä–µ–¥–Ω–∏–π –≤–µ—Å', '–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å'],
                '–ó–Ω–∞—á–µ–Ω–∏–µ': [
                    len(products),
                    df['–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å ($)'].mean(),
                    df['–í–µ—Å (–∫–≥)'].mean(),
                    df['–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å ($)'].sum()
                ]
            })
            stats_df.to_excel(writer, sheet_name='–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', index=False)
        
        output.seek(0)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∞–π–ª
        filename = f"database_export_{datetime.now().strftime('%Y%m%d_%H%M%S')}.xlsx"
        
        await callback.message.answer_document(
            document=("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet", output, filename),
            caption=f"üìä –≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n"
                   f"üìÖ –î–∞—Ç–∞: {datetime.now().strftime('%d.%m.%Y %H:%M')}\n"
                   f"üì¶ –¢–æ–≤–∞—Ä–æ–≤: {len(products)}\n"
                   f"üíæ –§–∞–π–ª: {filename}",
            reply_markup=get_back_to_admin_keyboard()
        )
        
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –º–µ–Ω—é
        await callback.message.delete()
    
    await callback.answer()

@reports_router.callback_query(F.data == "report_user_statistics")
async def user_statistics_report(callback: CallbackQuery):
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º"""
    async with async_session_maker() as session:
        from database.models import User
        
        # –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        user_query = select(
            func.count(User.id).label('total_users'),
            func.count(User.phone.isnot(None)).label('users_with_phone'),
            func.count(User.full_name.isnot(None)).label('users_with_name')
        )
        result = await session.execute(user_query)
        user_stats = result.first()
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
        region_query = select(
            User.region,
            func.count(User.id).label('count')
        ).where(User.region.isnot(None)).group_by(User.region)
        
        result = await session.execute(region_query)
        region_stats = result.all()
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —è–∑—ã–∫–∞–º
        lang_query = select(
            User.language,
            func.count(User.id).label('count')
        ).group_by(User.language)
        
        result = await session.execute(lang_query)
        lang_stats = result.all()
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç
        report_text = "üë• –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n\n"
        report_text += f"üìä –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:\n"
        report_text += f"  ‚Ä¢ –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {user_stats.total_users}\n"
        report_text += f"  ‚Ä¢ –° —É–∫–∞–∑–∞–Ω–Ω—ã–º —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º: {user_stats.users_with_phone}\n"
        report_text += f"  ‚Ä¢ –° —É–∫–∞–∑–∞–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º: {user_stats.users_with_name}\n\n"
        
        if region_stats:
            report_text += "üåç –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º:\n"
            for region, count in region_stats:
                report_text += f"  ‚Ä¢ {region or '–ù–µ —É–∫–∞–∑–∞–Ω'}: {count}\n"
            report_text += "\n"
        
        if lang_stats:
            report_text += "üó£Ô∏è –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —è–∑—ã–∫–∞–º:\n"
            for lang, count in lang_stats:
                lang_name = "–†—É—Å—Å–∫–∏–π" if lang == "ru" else "–¢–∞–¥–∂–∏–∫—Å–∫–∏–π" if lang == "tj" else lang
                report_text += f"  ‚Ä¢ {lang_name}: {count}\n"
        
        await callback.message.edit_text(
            report_text,
            reply_markup=get_back_to_admin_keyboard()
        )
    
    await callback.answer()

@reports_router.callback_query(F.data == "report_financial")
async def financial_report(callback: CallbackQuery):
    """–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç"""
    async with async_session_maker() as session:
        # –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º
        now = datetime.utcnow()
        financial_stats = []
        
        for i in range(3):  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞
            month_date = now - timedelta(days=30*i)
            month = month_date.month
            year = month_date.year
            
            # –¢–æ–≤–∞—Ä—ã —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ
            query = select(
                func.sum(Product.total_value_usd).label('total_value'),
                func.sum(Product.quantity).label('total_quantity'),
                func.count(Product.id).label('count')
            ).where(
                extract('month', Product.created_at) == month,
                extract('year', Product.created_at) == year,
                Product.total_value_usd.isnot(None)
            )
            
            result = await session.execute(query)
            stats = result.first()
            
            financial_stats.append({
                "period": f"{month:02d}.{year}",
                "total_value": stats.total_value or 0,
                "total_quantity": stats.total_quantity or 0,
                "count": stats.count or 0
            })
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç
        report_text = "üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç\n\n"
        
        for stat in financial_stats:
            avg_value = stat['total_value'] / stat['count'] if stat['count'] > 0 else 0
            report_text += f"üìÖ –ü–µ—Ä–∏–æ–¥: {stat['period']}\n"
            report_text += f"  ‚Ä¢ –¢–æ–≤–∞—Ä–æ–≤: {stat['count']} —à—Ç.\n"
            report_text += f"  ‚Ä¢ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${stat['total_value']:.2f}\n"
            report_text += f"  ‚Ä¢ –°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞: ${avg_value:.2f}\n"
            report_text += f"  ‚Ä¢ –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: {stat['total_quantity']} –µ–¥.\n\n"
        
        # –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        total_query = select(
            func.sum(Product.total_value_usd).label('total_all'),
            func.count(Product.id).label('count_all')
        ).where(Product.total_value_usd.isnot(None))
        
        result = await session.execute(total_query)
        total_stats = result.first()
        
        report_text += "üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:\n"
        report_text += f"  ‚Ä¢ –í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –±–∞–∑–µ: {total_stats.count_all}\n"
        report_text += f"  ‚Ä¢ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤: ${total_stats.total_all or 0:.2f}\n"
        
        await callback.message.edit_text(
            report_text,
            reply_markup=get_back_to_admin_keyboard()
        )
    
    await callback.answer()
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\admin\update_status.py =====
"""
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
"""
import logging
from datetime import datetime
from aiogram import Router, F
from aiogram.fsm.context import FSMContext
from aiogram.types import Message, CallbackQuery
from sqlalchemy import select, update
from sqlalchemy.ext.asyncio import AsyncSession

from database.models import Product
from database.session import async_session_maker  # –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ò–ú–ü–û–†–¢
from utils.states import AdminStates
from keyboards.admin import (
    get_status_update_menu_keyboard, 
    get_status_keyboard,
    get_back_to_admin_keyboard
)
from config import settings

logger = logging.getLogger(__name__)
update_status_router = Router()

# –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
PRODUCT_STATUSES = [
    "CREATED",           # –°–æ–∑–¥–∞–Ω
    "IN_CHINA_WAREHOUSE", # –ù–∞ —Å–∫–ª–∞–¥–µ –≤ –ö–∏—Ç–∞–µ
    "IN_TRANSIT",        # –í –ø—É—Ç–∏
    "ARRIVED_TJ",        # –ü—Ä–∏–±—ã–ª –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω
    "READY_FOR_PICKUP",  # –ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ
    "DELIVERED",         # –î–æ—Å—Ç–∞–≤–ª–µ–Ω
    "CANCELLED",         # –û—Ç–º–µ–Ω–µ–Ω
    "PROBLEM",           # –ü—Ä–æ–±–ª–µ–º–∞
]

@update_status_router.callback_query(F.data == "admin_update_status")
async def update_status_menu(callback: CallbackQuery):
    """–ú–µ–Ω—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤"""
    if not settings.is_admin(callback.from_user.id):
        await callback.answer("‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω", show_alert=True)
        return
    
    await callback.message.edit_text(
        "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:",
        reply_markup=get_status_update_menu_keyboard()
    )
    await callback.answer()

@update_status_router.callback_query(F.data == "update_by_track")
async def update_by_track(callback: CallbackQuery, state: FSMContext):
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ —Ç—Ä–µ–∫-–∫–æ–¥—É"""
    await callback.message.edit_text(
        "üìù –í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫-–∫–æ–¥ —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:",
        reply_markup=get_back_to_admin_keyboard()
    )
    await state.set_state(AdminStates.WAITING_TRACK_FOR_UPDATE)
    await callback.answer()

@update_status_router.message(AdminStates.WAITING_TRACK_FOR_UPDATE)
async def process_track_for_update(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–µ–¥–µ–Ω–Ω–æ–≥–æ —Ç—Ä–µ–∫-–∫–æ–¥–∞"""
    track_code = message.text.strip()
    
    # –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –°–ï–°–°–ò–Ø
    async with async_session_maker() as session:
        # –ò—â–µ–º —Ç–æ–≤–∞—Ä
        query = select(Product).where(Product.track_code == track_code)
        result = await session.execute(query)
        product = result.scalar_one_or_none()
        
        if not product:
            await message.answer(
                f"‚ùå –¢–æ–≤–∞—Ä —Å —Ç—Ä–µ–∫-–∫–æ–¥–æ–º {track_code} –Ω–µ –Ω–∞–π–¥–µ–Ω.\n"
                "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑:",
                reply_markup=get_back_to_admin_keyboard()
            )
            return
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ
        await state.update_data(
            product_id=product.id,
            track_code=track_code,
            current_status=product.status
        )
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –Ω–æ–≤—ã–π
        await message.answer(
            f"üì¶ –¢–æ–≤–∞—Ä –Ω–∞–π–¥–µ–Ω:\n"
            f"–ö–æ–¥: {product.track_code}\n"
            f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.product_name or '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}\n"
            f"–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: {product.status or '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}\n\n"
            f"–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å:",
            reply_markup=get_status_keyboard()
        )
        
        await state.set_state(AdminStates.WAITING_NEW_STATUS)

@update_status_router.callback_query(F.data.startswith("set_status_"))
async def set_new_status(callback: CallbackQuery, state: FSMContext):
    """–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞"""
    new_status = callback.data.replace("set_status_", "")
    
    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    data = await state.get_data()
    product_id = data.get("product_id")
    track_code = data.get("track_code")
    current_status = data.get("current_status")
    
    if not product_id:
        await callback.message.edit_text("‚ùå –û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
        await callback.answer()
        return
    
    # –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –°–ï–°–°–ò–Ø
    async with async_session_maker() as session:
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
        stmt = update(Product).where(Product.id == product_id).values(
            status=new_status,
            updated_at=datetime.utcnow()
        )
        
        # –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "–ü—Ä–∏–±—ã–ª –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω", —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞—Ç—É –ø—Ä–∏–±—ã—Ç–∏—è
        if new_status == "ARRIVED_TJ":
            await callback.message.edit_text(
                f"‚úÖ –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω —Å '{current_status}' –Ω–∞ '{new_status}'\n\n"
                f"–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –ø—Ä–∏–±—ã—Ç–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú\n"
                f"–ù–∞–ø—Ä–∏–º–µ—Ä: 05.02.2026 14:30\n"
                f"–ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å', —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è:",
                reply_markup=get_back_to_admin_keyboard()
            )
            await state.update_data(new_status=new_status)
            await state.set_state(AdminStates.WAITING_ARRIVAL_DATE)
        else:
            await session.execute(stmt)
            await session.commit()
            
            await callback.message.edit_text(
                f"‚úÖ –°—Ç–∞—Ç—É—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!\n\n"
                f"–¢—Ä–µ–∫-–∫–æ–¥: {track_code}\n"
                f"–°—Ç–∞—Ä—ã–π —Å—Ç–∞—Ç—É—Å: {current_status}\n"
                f"–ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å: {new_status}",
                reply_markup=get_back_to_admin_keyboard()
            )
        
        await callback.answer()

@update_status_router.message(AdminStates.WAITING_ARRIVAL_DATE)
async def process_arrival_date(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç—ã –ø—Ä–∏–±—ã—Ç–∏—è"""
    date_text = message.text.strip()
    
    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    data = await state.get_data()
    product_id = data.get("product_id")
    track_code = data.get("track_code")
    current_status = data.get("current_status")
    new_status = data.get("new_status")
    
    arrival_date = None
    
    if date_text.lower() != "–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å":
        try:
            # –ü–∞—Ä—Å–∏–º –¥–∞—Ç—É
            arrival_date = datetime.strptime(date_text, "%d.%m.%Y %H:%M")
        except ValueError:
            await message.answer(
                "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã.\n"
                "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú\n"
                "–ü—Ä–∏–º–µ—Ä: 05.02.2026 14:30\n"
                "–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å':",
                reply_markup=get_back_to_admin_keyboard()
            )
            return
    
    # –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –°–ï–°–°–ò–Ø
    async with async_session_maker() as session:
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏ –¥–∞—Ç—É –ø—Ä–∏–±—ã—Ç–∏—è
        update_values = {
            "status": new_status,
            "updated_at": datetime.utcnow()
        }
        
        if arrival_date:
            update_values["arrival_date"] = arrival_date
        
        stmt = update(Product).where(Product.id == product_id).values(**update_values)
        await session.execute(stmt)
        await session.commit()
        
        date_info = f"–î–∞—Ç–∞ –ø—Ä–∏–±—ã—Ç–∏—è: {arrival_date.strftime('%d.%m.%Y %H:%M')}" if arrival_date else "–î–∞—Ç–∞ –ø—Ä–∏–±—ã—Ç–∏—è: —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è"
        
        await message.answer(
            f"‚úÖ –°—Ç–∞—Ç—É—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!\n\n"
            f"–¢—Ä–µ–∫-–∫–æ–¥: {track_code}\n"
            f"–°—Ç–∞—Ä—ã–π —Å—Ç–∞—Ç—É—Å: {current_status}\n"
            f"–ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å: {new_status}\n"
            f"{date_info}",
            reply_markup=get_back_to_admin_keyboard()
        )
    
    await state.clear()

@update_status_router.callback_query(F.data == "update_by_date")
async def update_by_date(callback: CallbackQuery, state: FSMContext):
    """–ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ –¥–∞—Ç–µ"""
    await callback.message.edit_text(
        "üìÖ –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –¥–∞—Ç–µ\n\n"
        "–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì\n"
        "–ë—É–¥—É—Ç –Ω–∞–π–¥–µ–Ω—ã –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ —ç—Ç—É –¥–∞—Ç—É:",
        reply_markup=get_back_to_admin_keyboard()
    )
    await state.set_state(AdminStates.WAITING_DATE_FOR_BULK_UPDATE)
    await callback.answer()

@update_status_router.message(AdminStates.WAITING_DATE_FOR_BULK_UPDATE)
async def process_date_for_bulk_update(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç—ã –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"""
    date_text = message.text.strip()
    
    try:
        target_date = datetime.strptime(date_text, "%d.%m.%Y").date()
    except ValueError:
        await message.answer(
            "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã.\n"
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –î–î.–ú–ú.–ì–ì–ì–ì\n"
            "–ü—Ä–∏–º–µ—Ä: 05.02.2026",
            reply_markup=get_back_to_admin_keyboard()
        )
        return
    
    # –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –°–ï–°–°–ò–Ø
    async with async_session_maker() as session:
        # –ò—â–µ–º —Ç–æ–≤–∞—Ä—ã –ø–æ –¥–∞—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
        query = select(Product).where(
            Product.send_date >= target_date,
            Product.send_date < target_date.replace(day=target_date.day + 1)
        )
        result = await session.execute(query)
        products = result.scalars().all()
        
        if not products:
            await message.answer(
                f"‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö {date_text}",
                reply_markup=get_back_to_admin_keyboard()
            )
            return
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
        product_ids = [p.id for p in products]
        await state.update_data(
            bulk_product_ids=product_ids,
            bulk_date=date_text,
            found_count=len(products)
        )
        
        await message.answer(
            f"üìã –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(products)}\n"
            f"–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {date_text}\n\n"
            "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –¥–ª—è –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤:",
            reply_markup=get_status_keyboard(is_bulk=True)
        )
        
        await state.set_state(AdminStates.WAITING_BULK_STATUS)

@update_status_router.callback_query(F.data.startswith("bulk_status_"))
async def process_bulk_status_update(callback: CallbackQuery, state: FSMContext):
    """–ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤"""
    new_status = callback.data.replace("bulk_status_", "")
    
    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    data = await state.get_data()
    product_ids = data.get("bulk_product_ids", [])
    found_count = data.get("found_count", 0)
    
    if not product_ids:
        await callback.message.edit_text("‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è")
        await callback.answer()
        return
    
    # –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –°–ï–°–°–ò–Ø
    async with async_session_maker() as session:
        # –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        updated_count = 0
        for product_id in product_ids:
            stmt = update(Product).where(Product.id == product_id).values(
                status=new_status,
                updated_at=datetime.utcnow()
            )
            await session.execute(stmt)
            updated_count += 1
        
        await session.commit()
        
        await callback.message.edit_text(
            f"‚úÖ –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!\n\n"
            f"–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ: {found_count}\n"
            f"–û–±–Ω–æ–≤–ª–µ–Ω–æ: {updated_count}\n"
            f"–ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å: {new_status}",
            reply_markup=get_back_to_admin_keyboard()
        )
    
    await state.clear()
    await callback.answer()
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\address.py =====
"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–Ω—é –∞–¥—Ä–µ—Å–æ–≤ —Å–∫–ª–∞–¥–æ–≤
"""
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository
from keyboards.client import get_country_keyboard, get_main_menu_keyboard
from utils.states import ClientState

logger = logging.getLogger(__name__)

# –°–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä
address_router = Router()

@address_router.message(ClientState.address_menu)
async def address_handler(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞–Ω—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –≤ –º–µ–Ω—é –∞–¥—Ä–µ—Å–æ–≤: {message.text}")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        # –¢–µ–∫—Å—Ç—ã –∫–Ω–æ–ø–æ–∫
        back_ru = "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
        back_tj = "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"
        
        if message.text in [back_ru, back_tj]:
            await message.answer(
                "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:" if user.language == "ru" else "–ú–µ–Ω—é–∏ –∞—Å–æ—Å”£:",
                reply_markup=get_main_menu_keyboard(user.language)
            )
            await state.set_state(ClientState.main_menu)
            return
        
        # –ê–¥—Ä–µ—Å–∞ —Å–∫–ª–∞–¥–æ–≤
        country_addresses = {
            "üáπüáØ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω": {
                "ru": "üìç <b>–°–∫–ª–∞–¥ –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–µ</b>\n\n"
                      "üè¢ –ê–¥—Ä–µ—Å: –≥. –î—É—à–∞–Ω–±–µ, —É–ª. –®–µ–≤—á–µ–Ω–∫–æ 45\n"
                      "üìû –¢–µ–ª–µ—Ñ–æ–Ω: +992 123 45 67 89\n"
                      "‚è∞ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: 9:00 - 18:00\n"
                      "üìÖ –ë–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö",
                "tj": "üìç <b>–ê–Ω–±–æ—Ä –¥–∞—Ä –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω</b>\n\n"
                      "üè¢ –ê–¥—Ä–µ—Å: –î—É—à–∞–Ω–±–µ, –∫”Ø—á–∞–∏ –®–µ–≤—á–µ–Ω–∫–æ 45\n"
                      "üìû –¢–µ–ª–µ—Ñ–æ–Ω: +992 123 45 67 89\n"
                      "‚è∞ –í–∞“õ—Ç–∏ –∫–æ—Ä: 9:00 - 18:00\n"
                      "üìÖ –ë–µ —Ä”Ø–∑“≥–æ–∏ —Ç–∞—ä—Ç–∏–ª"
            },
            "üá®üá≥ –ö–∏—Ç–∞–π": {
                "ru": "üìç <b>–°–∫–ª–∞–¥ –≤ –ö–∏—Ç–∞–µ</b>\n\n"
                      "üè¢ –ê–¥—Ä–µ—Å: –≥. –ì—É–∞–Ω—á–∂–æ—É, —Ä–∞–π–æ–Ω –ë–∞–π—é–Ω—å\n"
                      "üìû –¢–µ–ª–µ—Ñ–æ–Ω: +86 138 0013 8000\n"
                      "‚è∞ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: 8:00 - 20:00\n"
                      "üìÖ –ë–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö",
                "tj": "üìç <b>–ê–Ω–±–æ—Ä –¥–∞—Ä –ß–∏–Ω</b>\n\n"
                      "üè¢ –ê–¥—Ä–µ—Å: –ì—É–∞–Ω—á–∂–æ—É, –Ω–æ“≥–∏—è–∏ –ë–∞–π—é–Ω—å\n"
                      "üìû –¢–µ–ª–µ—Ñ–æ–Ω: +86 138 0013 8000\n"
                      "‚è∞ –í–∞“õ—Ç–∏ –∫–æ—Ä: 8:00 - 20:00\n"
                      "üìÖ –ë–µ —Ä”Ø–∑“≥–æ–∏ —Ç–∞—ä—Ç–∏–ª"
            },
            "üá∫üáø –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω": {
                "ru": "üìç <b>–°–∫–ª–∞–¥ –≤ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–µ</b>\n\n"
                      "üè¢ –ê–¥—Ä–µ—Å: –≥. –¢–∞—à–∫–µ–Ω—Ç, —É–ª. –ù–∞–≤–æ–∏ 12\n"
                      "üìû –¢–µ–ª–µ—Ñ–æ–Ω: +998 71 123 45 67\n"
                      "‚è∞ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: 9:00 - 18:00\n"
                      "üìÖ –ü–Ω-–ü—Ç",
                "tj": "üìç <b>–ê–Ω–±–æ—Ä –¥–∞—Ä ”Æ–∑–±–µ–∫–∏—Å—Ç–æ–Ω</b>\n\n"
                      "üè¢ –ê–¥—Ä–µ—Å: –¢–æ—à–∫–∞–Ω–¥, –∫”Ø—á–∞–∏ –ù–∞–≤–æ”£ 12\n"
                      "üìû –¢–µ–ª–µ—Ñ–æ–Ω: +998 71 123 45 67\n"
                      "‚è∞ –í–∞“õ—Ç–∏ –∫–æ—Ä: 9:00 - 18:00\n"
                      "üìÖ –î—É—à–∞–Ω–±–µ-“∂—É–º—ä–∞"
            },
            "üá∞üáø –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω": {
                "ru": "üìç <b>–°–∫–ª–∞–¥ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ</b>\n\n"
                      "üè¢ –ê–¥—Ä–µ—Å: –≥. –ê–ª–º–∞—Ç—ã, —É–ª. –ê–±–∞—è 34\n"
                      "üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 727 123 45 67\n"
                      "‚è∞ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: 9:00 - 19:00\n"
                      "üìÖ –ü–Ω-–°–±",
                "tj": "üìç <b>–ê–Ω–±–æ—Ä –¥–∞—Ä “ö–∞–∑–æ“õ–∏—Å—Ç–æ–Ω</b>\n\n"
                      "üè¢ –ê–¥—Ä–µ—Å: –û–ª–º–æ—Ç”£, –∫”Ø—á–∞–∏ –û–±–æ–π 34\n"
                      "üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 727 123 45 67\n"
                      "‚è∞ –í–∞“õ—Ç–∏ –∫–æ—Ä: 9:00 - 19:00\n"
                      "üìÖ –î—É—à–∞–Ω–±–µ-–®–∞–Ω–±–µ"
            }
        }
        
        address_info = country_addresses.get(message.text)
        if address_info:
            await message.answer(
                address_info[user.language],
                reply_markup=get_country_keyboard(user.language),
                parse_mode="HTML"
            )
        else:
            await message.answer(
                "–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –∏–∑ —Å–ø–∏—Å–∫–∞:" if user.language == "ru" 
                else "–ö–∏—à–≤–∞—Ä—Ä–æ –∞–∑ —Ä”Ø–π—Ö–∞—Ç –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:",
                reply_markup=get_country_keyboard(user.language)
            )
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\calculator.py =====
"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
"""
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository
from keyboards.client import get_back_cancel_keyboard, get_country_keyboard, get_main_menu_keyboard
from utils.states import ClientState
from services.calculator import calculate_delivery_cost

logger = logging.getLogger(__name__)
router = Router()

async def calculator_start(message: Message, state: FSMContext):
    """–ù–∞—á–∞–ª–æ —Ä–∞—Å—á–µ—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": "üßÆ <b>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Å—Ç–∞–≤–∫–∏</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –¥–æ—Å—Ç–∞–≤–∫–∏:",
            "tj": "üßÆ <b>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∏ —Ä–∞—Å–æ–Ω–∏–¥–∞–Ω</b>\n\n–ö–∏—à–≤–∞—Ä–∏ —Ä–∞—Å–æ–Ω–∏–¥–∞–Ω—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_country_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.calculator_country)

@router.message(ClientState.calculator_country)
async def calculator_country_handler(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞–Ω—ã –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await message.answer(
            "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:" if True else "–ú–µ–Ω—é–∏ –∞—Å–æ—Å”£:",  # –ë–µ–∑ user –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
            reply_markup=get_main_menu_keyboard("ru")  # –í—Ä–µ–º–µ–Ω–Ω–æ
        )
        await state.set_state(ClientState.main_menu)
        return
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        await state.update_data(calculator_country=message.text)
        
        texts = {
            "ru": "–í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É (–≤ –º–µ—Ç—Ä–∞—Ö):",
            "tj": "–î–∞—Ä–æ–∑–∏—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä –º–µ—Ç—Ä):"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language)
        )
        await state.set_state(ClientState.calculator_dimensions)

@router.message(ClientState.calculator_dimensions)
async def calculator_dimensions_handler(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ —Ä–∞–∑–º–µ—Ä–æ–≤"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await calculator_start(message, state)
        return
    
    try:
        length = float(message.text.replace(",", "."))
        
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            if not user:
                return
            
            await state.update_data(length=length)
            
            texts = {
                "ru": "–í–≤–µ–¥–∏—Ç–µ —à–∏—Ä–∏–Ω—É (–≤ –º–µ—Ç—Ä–∞—Ö):",
                "tj": "–ë–∞—Ä–∞–Ω–¥–æ–∑–∏—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä –º–µ—Ç—Ä):"
            }
            
            await message.answer(
                texts[user.language],
                reply_markup=get_back_cancel_keyboard(user.language)
            )
            await state.set_state(ClientState.calculator_dimensions)
            
    except ValueError:
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 0.5, 1, 2.3)",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, —Ä–∞“õ–∞–º –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–º–∞—Å–∞–ª–∞–Ω: 0.5, 1, 2.3)"
            }
            await message.answer(texts[user.language])

@router.message(ClientState.calculator_weight)
async def calculator_weight_handler(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –≤–µ—Å–∞ –∏ —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            if not user:
                return
            
            texts = {
                "ru": "–í–≤–µ–¥–∏—Ç–µ –≤—ã—Å–æ—Ç—É (–≤ –º–µ—Ç—Ä–∞—Ö):",
                "tj": "–ë–∞–ª–∞–Ω–¥–∏—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä –º–µ—Ç—Ä):"
            }
            
            await message.answer(
                texts[user.language],
                reply_markup=get_back_cancel_keyboard(user.language)
            )
            await state.set_state(ClientState.calculator_dimensions)
        return
    
    try:
        weight = float(message.text.replace(",", "."))
        
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            if not user:
                return
            
            data = await state.get_data()
            
            # –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
            cost = calculate_delivery_cost(weight)
            
            texts = {
                "ru": f"""üßÆ <b>–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞</b>

–°—Ç—Ä–∞–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏: {data.get('calculator_country', '–ù–µ —É–∫–∞–∑–∞–Ω–∞')}
–î–ª–∏–Ω–∞: {data.get('length', 0)} –º
–®–∏—Ä–∏–Ω–∞: {data.get('width', 0)} –º
–í—ã—Å–æ—Ç–∞: {data.get('height', 0)} –º
–í–µ—Å: {weight} –∫–≥

<b>–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${cost:.2f}</b>""",
                "tj": f"""üßÆ <b>–ù–∞—Ç–∏“∑–∞–∏ “≥–∏—Å–æ–±</b>

–ö–∏—à–≤–∞—Ä–∏ —Ä–∞—Å–æ–Ω–∏–¥–∞–Ω: {data.get('calculator_country', '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç')}
–î–∞—Ä–æ–∑”£: {data.get('length', 0)} –º
–ë–∞—Ä–∞–Ω–¥–æ–∑”£: {data.get('width', 0)} –º
–ë–∞–ª–∞–Ω–¥”£: {data.get('height', 0)} –º
–í–∞–∑–Ω: {weight} –∫–≥

<b>–ê—Ä–∑–∏—à–∏ –Ω–∏“≥–æ”£: ${cost:.2f}</b>"""
            }
            
            await message.answer(
                texts[user.language],
                reply_markup=get_main_menu_keyboard(user.language),
                parse_mode="HTML"
            )
            await state.set_state(ClientState.main_menu)
            
    except ValueError:
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1, 5.5, 10.2)",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, —Ä–∞“õ–∞–º –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–º–∞—Å–∞–ª–∞–Ω: 1, 5.5, 10.2)"
            }
            await message.answer(texts[user.language])
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\course.py =====
"""
–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å
"""
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository
from keyboards.client import get_main_menu_keyboard, get_course_platform_keyboard
from utils.states import ClientState

logger = logging.getLogger(__name__)
router = Router()

@router.message(ClientState.main_menu, F.text.contains("üéì"))
async def free_course_menu(message: Message, state: FSMContext):
    """–ú–µ–Ω—é –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –∫—É—Ä—Å–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üéì <b>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å –ø–æ –ø–æ–∫—É–ø–∫–∞–º –≤ –ö–∏—Ç–∞–µ</b>\n\n"
                  "–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É:",
            "tj": "üéì <b>–ö—É—Ä—Å–∏ –±–µ–ø—É–ª –æ–∏–¥ –±–∞ —Ö–∞—Ä–∏–¥ –¥–∞—Ä –ß–∏–Ω</b>\n\n"
                  "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_course_platform_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.course_menu)

# –û—Å—Ç–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –∫—É—Ä—Å–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\door_delivery.py =====
"""
–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–µ–π
"""
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository, ProductRepository
from database.models import ProductStatus
from keyboards.client import get_back_cancel_keyboard, get_main_menu_keyboard
from utils.states import ClientState

logger = logging.getLogger(__name__)
router = Router()

@router.message(ClientState.main_menu, F.text.contains("üöö"))
async def door_delivery_menu(message: Message, state: FSMContext):
    """–ú–µ–Ω—é –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ –¥–≤–µ—Ä–µ–π"""
    async for session in get_db():
        user_repo = UserRepository(session)
        product_repo = ProductRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–æ–≤–∞—Ä—ã –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–µ
        products_in_tj = await product_repo.get_products_by_status(
            ProductStatus.TAJIKISTAN_WAREHOUSE
        )
        
        user_products_in_tj = [p for p in products_in_tj if p.user_id == user.id]
        
        if not user_products_in_tj:
            texts = {
                "ru": "‚ö†Ô∏è –î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–µ–π –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤, –ø—Ä–∏–±—ã–≤—à–∏—Ö –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω\n\n"
                      "–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ç–∞–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤.",
                "tj": "‚ö†Ô∏è –†–∞—Å–æ–Ω–∏–¥–∞–Ω —Ç–æ –¥–∞—Ä —Ç–∞–Ω“≥–æ –±–∞—Ä–æ–∏ –º–∞“≥—Å—É–ª–æ—Ç–µ –¥–∞—Å—Ç—Ä–∞—Å –∞—Å—Ç, –∫–∏ –±–∞ –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω –æ–º–∞–¥–∞–∞–Ω–¥\n\n"
                      "–®—É–º–æ —Ç–æ “≥–æ–ª —á—É–Ω–∏–Ω –º–∞“≥—Å—É–ª–æ—Ç –Ω–∞–¥–æ—Ä–µ–¥."
            }
            await message.answer(
                texts[user.language],
                reply_markup=get_main_menu_keyboard(user.language)
            )
            return
        
        texts = {
            "ru": "üöö <b>–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–µ–π</b>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫-–∫–æ–¥ —Ç–æ–≤–∞—Ä–∞ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):",
            "tj": "üöö <b>–†–∞—Å–æ–Ω–∏–¥–∞–Ω —Ç–æ –¥–∞—Ä</b>\n\n"
                  "–†–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (—è–∫—á–∞–Ω–¥ —Ä–∞–º–∑—Ä–æ –±–æ –≤–µ—Ä–≥—É–ª “∑—É–¥–æ –∫—É–Ω–µ–¥):"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.door_delivery_track)

# –û—Å—Ç–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –¥–æ—Å—Ç–∞–≤–∫–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\forbidden_goods.py =====
"""
–ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã (—É–∂–µ –µ—Å—Ç—å –≤ other_menus.py, –Ω–æ —Å–æ–∑–¥–∞–µ–º –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã)
"""
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository
from keyboards.client import get_main_menu_keyboard
from utils.states import ClientState

logger = logging.getLogger(__name__)
router = Router()

@router.message(ClientState.main_menu, F.text.contains("üö´"))
async def forbidden_goods(message: Message, state: FSMContext):
    """–°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": """üö´ <b>–ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</b>

1. –û—Ä—É–∂–∏–µ –∏ –±–æ–µ–ø—Ä–∏–ø–∞—Å—ã
2. –ù–∞—Ä–∫–æ—Ç–∏—á–µ—Å–∫–∏–µ –≤–µ—â–µ—Å—Ç–≤–∞
3. –í–∑—Ä—ã–≤—á–∞—Ç—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
4. –ñ–∏–≤–æ—Ç–Ω—ã–µ –∏ —Ä–∞—Å—Ç–µ–Ω–∏—è –ø–æ–¥ –æ—Ö—Ä–∞–Ω–æ–π
5. –ü–æ—Ä–Ω–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è
6. –õ–µ–∫–∞—Ä—Å—Ç–≤–∞ –±–µ–∑ —Ä–µ—Ü–µ–ø—Ç–∞
7. –ê–ª–∫–æ–≥–æ–ª—å–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è
8. –î—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã–µ –º–µ—Ç–∞–ª–ª—ã –∏ –∫–∞–º–Ω–∏
9. –†–∞–¥–∏–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
10. –ü–æ–¥–¥–µ–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—Ç–æ—á–Ω—è–π—Ç–µ —É –ø–æ–¥–¥–µ—Ä–∂–∫–∏.""",
            "tj": """üö´ <b>–ú–∞“≥—Å—É–ª–æ—Ç“≥–æ–∏ –º–∞–º–Ω—É–∞</b>

1. –û—Ä—É–∂–∏–µ –≤–∞ –±–æ—ë–º–∏–ª“≥–æ
2. –ú–æ–¥–¥–∞“≥–æ–∏ –Ω–∞—Ä–∫–æ—Ç–∏–∫”£
3. –ú–∞–≤–æ–¥“≥–æ–∏ –ø–æ—Ä—Ö–µ–∑
4. “≤–∞–π–≤–æ–Ω–æ—Ç –≤–∞ –Ω–∞–±–æ—Ç–æ—Ç–∏ –∑–µ—Ä–∏ “≥–∏–º–æ—è—Ç
5. –ú–∞“≥—Å—É–ª–æ—Ç–∏ –ø–æ—Ä–Ω–æ–≥—Ä–∞—Ñ”£
6. –î–æ—Ä—É“≥–æ –±–∏–¥—É–Ω–∏ —Ç–∞–≤—Å–∏—è–Ω–æ–º–∞
7. –ú–∞“≥—Å—É–ª–æ—Ç–∏ —Å–ø–∏—Ä—Ç”£
8. –§—É–ª—É–∑–æ—Ç–∏ –≥–∞—Ä–æ–Ω–±–∞“≥–æ –≤–∞ —Å–∞–Ω–≥—É “∑–∞–≤“≥–∞—Ä
9. –ú–∞–≤–æ–¥“≥–æ–∏ —Ä–∞–¥–∏–æ–∞–∫—Ç–∏–≤”£
10. –ú–∞“≥—Å—É–ª–æ—Ç–∏ “õ–∞–ª–±–∞–∫”£

–†”Ø–π—Ö–∞—Ç–∏ –ø—É—Ä—Ä–∞—Ä–æ –∞–∑ –¥–∞—Å—Ç–≥–∏—Ä”£ —Ç–∞—Ñ—Å–∏–ª–æ—Ç –¥–∏“≥–µ–¥."""
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_main_menu_keyboard(user.language),
            parse_mode="HTML"
        )
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\main_menu.py =====
"""
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∫–ª–∏–µ–Ω—Ç–∞
"""
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository, ProductRepository
from keyboards.client import get_main_menu_keyboard, get_track_codes_keyboard, get_country_keyboard
from utils.states import ClientState

logger = logging.getLogger(__name__)

# –°–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä
main_menu_router = Router()

@main_menu_router.message(ClientState.main_menu, F.text.contains("üì¶"))
async def track_codes_menu(message: Message, state: FSMContext):
    """–ú–µ–Ω—é —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –≤—ã–±—Ä–∞–ª '–¢—Ä–µ–∫-–∫–æ–¥—ã'")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—á–Ω–∏—Ç–µ —Å –∫–æ–º–∞–Ω–¥—ã /start")
            return
        
        texts = {
            "ru": "üì¶ <b>–¢—Ä–µ–∫-–∫–æ–¥—ã</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
            "tj": "üì¶ <b>–†–∞–º–∑“≥–æ–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω</b>\n\n–ê–º–∞–ª—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_track_codes_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.track_codes_menu)

@main_menu_router.message(ClientState.main_menu, F.text.contains("üë§"))
async def profile_menu(message: Message, state: FSMContext):
    """–ú–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –≤—ã–±—Ä–∞–ª '–ü—Ä–æ—Ñ–∏–ª—å'")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        product_repo = ProductRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—á–Ω–∏—Ç–µ —Å –∫–æ–º–∞–Ω–¥—ã /start")
            return
        
        products = await product_repo.get_user_products(user.id)
        
        texts = {
            "ru": f"""üë§ <b>–ü—Ä–æ—Ñ–∏–ª—å</b>

üë§ –ò–º—è: {user.full_name or '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
üìû –¢–µ–ª–µ—Ñ–æ–Ω: {user.phone or '–ù–µ —É–∫–∞–∑–∞–Ω'}
üìç –†–µ–≥–∏–æ–Ω: {user.region or '–ù–µ —É–∫–∞–∑–∞–Ω'}
üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(products)}
üÜî UID: {user.telegram_id}

–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:""",
            "tj": f"""üë§ <b>–ü—Ä–æ—Ñ–∏–ª</b>

üë§ –ù–æ–º: {user.full_name or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üìû –¢–µ–ª–µ—Ñ–æ–Ω: {user.phone or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üìç –ú–∏–Ω—Ç–∞“õ–∞: {user.region or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üì¶ –ú–∏“õ–¥–æ—Ä–∏ –º–∞“≥—Å—É–ª–æ—Ç: {len(products)}
üÜî UID: {user.telegram_id}

–ê–º–∞–ª—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"""
        }
        
        from keyboards.client import get_profile_keyboard
        await message.answer(
            texts[user.language],
            reply_markup=get_profile_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.profile_menu)

@main_menu_router.message(ClientState.main_menu, F.text.contains("üìç"))
async def address_menu(message: Message, state: FSMContext):
    """–ú–µ–Ω—é –∞–¥—Ä–µ—Å–æ–≤"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –≤—ã–±—Ä–∞–ª '–ê–¥—Ä–µ—Å'")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—á–Ω–∏—Ç–µ —Å –∫–æ–º–∞–Ω–¥—ã /start")
            return
        
        texts = {
            "ru": "üìç <b>–ê–¥—Ä–µ—Å–∞ —Å–∫–ª–∞–¥–æ–≤</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É:",
            "tj": "üìç <b>–ê–¥—Ä–µ—Å“≥–æ–∏ –∞–Ω–±–æ—Ä</b>\n\n–ö–∏—à–≤–∞—Ä—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_country_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.address_menu)

@main_menu_router.message(ClientState.main_menu, F.text.contains("üßÆ"))
async def calculator_menu(message: Message):
    """–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –≤—ã–±—Ä–∞–ª '–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä'")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": "üßÆ <b>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Å—Ç–∞–≤–∫–∏</b>\n\n–§—É–Ω–∫—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –°–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞!",
            "tj": "üßÆ <b>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∏ —Ä–∞—Å–æ–Ω–∏–¥–∞–Ω</b>\n\n–§—É–Ω–∫—Å–∏—è –¥–∞—Ä —Ç–∞“≥–∏—è –∞—Å—Ç. –ë–∞ –∑—É–¥”£ –¥–∞—Å—Ç—Ä–∞—Å —Ö–æ“≥–∞–¥ —à—É–¥!"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_main_menu_keyboard(user.language),
            parse_mode="HTML"
        )

@main_menu_router.message(ClientState.main_menu, F.text.contains("üö´"))
async def forbidden_goods(message: Message):
    """–ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –≤—ã–±—Ä–∞–ª '–ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã'")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": """üö´ <b>–ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</b>

1. –û—Ä—É–∂–∏–µ –∏ –±–æ–µ–ø—Ä–∏–ø–∞—Å—ã
2. –ù–∞—Ä–∫–æ—Ç–∏—á–µ—Å–∫–∏–µ –≤–µ—â–µ—Å—Ç–≤–∞
3. –í–∑—Ä—ã–≤—á–∞—Ç—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
4. –ñ–∏–≤–æ—Ç–Ω—ã–µ –ø–æ–¥ –æ—Ö—Ä–∞–Ω–æ–π
5. –ü–æ—Ä–Ω–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—Ç–æ—á–Ω—è–π—Ç–µ —É –ø–æ–¥–¥–µ—Ä–∂–∫–∏.""",
            "tj": """üö´ <b>–ú–∞“≥—Å—É–ª–æ—Ç“≥–æ–∏ –º–∞–º–Ω—É–∞</b>

1. –û—Ä—É–∂–∏–µ –≤–∞ –±–æ—ë–º–∏–ª“≥–æ
2. –ú–æ–¥–¥–∞“≥–æ–∏ –Ω–∞—Ä–∫–æ—Ç–∏–∫”£
3. –ú–∞–≤–æ–¥“≥–æ–∏ –ø–æ—Ä—Ö–µ–∑
4. “≤–∞–π–≤–æ–Ω–æ—Ç–∏ –∑–µ—Ä–∏ “≥–∏–º–æ—è—Ç
5. –ú–∞“≥—Å—É–ª–æ—Ç–∏ –ø–æ—Ä–Ω–æ–≥—Ä–∞—Ñ”£

–†”Ø–π—Ö–∞—Ç–∏ –ø—É—Ä—Ä–∞—Ä–æ –∞–∑ –¥–∞—Å—Ç–≥–∏—Ä”£ —Ç–∞—Ñ—Å–∏–ª–æ—Ç –¥–∏“≥–µ–¥."""
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_main_menu_keyboard(user.language),
            parse_mode="HTML"
        )

@main_menu_router.message(ClientState.main_menu, F.text.contains("üí¨"))
async def support_info(message: Message):
    """–ü–æ–¥–¥–µ—Ä–∂–∫–∞"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –≤—ã–±—Ä–∞–ª '–ü–æ–¥–¥–µ—Ä–∂–∫–∞'")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": """üí¨ <b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</b>

üìû –¢–µ–ª–µ—Ñ–æ–Ω: +992 123 45 67 89
üìß Email: support@example.com
üïí –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã: 9:00 - 18:00 (–ü–Ω-–ü—Ç)

–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –ø–æ –ª—é–±—ã–º –≤–æ–ø—Ä–æ—Å–∞–º!""",
            "tj": """üí¨ <b>–î–∞—Å—Ç–≥–∏—Ä”£</b>

üìû –¢–µ–ª–µ—Ñ–æ–Ω: +992 123 45 67 89
üìß Email: support@example.com
üïí –í–∞“õ—Ç–∏ –∫–æ—Ä: 9:00 - 18:00 (–î—É—à-“∂—É–º)

–ë–∞—Ä–æ–∏ “≥–∞–º–∞ —Å–∞–≤–æ–ª“≥–æ –±–æ –º–æ —Ç–∞–º–æ—Å –≥–∏—Ä–µ–¥!"""
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_main_menu_keyboard(user.language),
            parse_mode="HTML"
        )

@main_menu_router.message(ClientState.main_menu, F.text.contains("‚¨ÖÔ∏è"))
async def back_button(message: Message):
    """–ö–Ω–æ–ø–∫–∞ –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if user:
            await message.answer(
                "–í—ã —É–∂–µ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é" if user.language == "ru" else "–®—É–º–æ –∞–ª–ª–∞–∫–∞–π –¥–∞—Ä –º–µ–Ω—é–∏ –∞—Å–æ—Å”£ “≥–∞—Å—Ç–µ–¥",
                reply_markup=get_main_menu_keyboard(user.language)
            )
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\other_menus.py =====
"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –º–µ–Ω—é (–¥–æ—Å—Ç–∞–≤–∫–∞, –∫—É—Ä—Å)
"""
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository
from keyboards.client import get_main_menu_keyboard, get_course_platform_keyboard
from utils.states import ClientState

logger = logging.getLogger(__name__)

# –°–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä
other_menus_router = Router()

# ========== –î–û–°–¢–ê–í–ö–ê –î–û –î–í–ï–†–ï–ô ==========

@other_menus_router.message(F.text.contains("üöö"))
async def door_delivery_menu(message: Message):
    """–ú–µ–Ω—é –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ –¥–≤–µ—Ä–µ–π"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –≤—ã–±—Ä–∞–ª '–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–µ–π'")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": "üöö <b>–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–µ–π</b>\n\n"
                  "üì¶ <b>–£—Å–ª–æ–≤–∏—è:</b>\n"
                  "‚Ä¢ –î–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤, –ø—Ä–∏–±—ã–≤—à–∏—Ö –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω\n"
                  "‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å: –æ—Ç $10 (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–¥—Ä–µ—Å–∞)\n"
                  "‚Ä¢ –°—Ä–æ–∫: 1-3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è\n\n"
                  "üìù <b>–ö–∞–∫ –∑–∞–∫–∞–∑–∞—Ç—å:</b>\n"
                  "1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à —Ç–æ–≤–∞—Ä –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å '–ù–∞ —Å–∫–ª–∞–¥–µ –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–µ'\n"
                  "2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É '–ú–æ–∏ —Ç—Ä–µ–∫-–∫–æ–¥—ã'\n"
                  "3. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏\n"
                  "4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –¥–æ—Å—Ç–∞–≤–∫–∏",
            "tj": "üöö <b>–†–∞—Å–æ–Ω–∏–¥–∞–Ω —Ç–æ –¥–∞—Ä</b>\n\n"
                  "üì¶ <b>–®–∞—Ä—Ç“≥–æ:</b>\n"
                  "‚Ä¢ –¢–∞–Ω“≥–æ –±–∞—Ä–æ–∏ –º–∞“≥—Å—É–ª–æ—Ç–µ –¥–∞—Å—Ç—Ä–∞—Å –∞—Å—Ç, –∫–∏ –±–∞ –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω –æ–º–∞–¥–∞–∞–Ω–¥\n"
                  "‚Ä¢ –ù–∞—Ä—Ö: –∞–∑ $10 (–±–∞ –≤–æ–±–∞—Å—Ç–∞–≥–∏–∏ –∞–¥—Ä–µ—Å)\n"
                  "‚Ä¢ –ú—É–¥–¥–∞—Ç: 1-3 —Ä”Ø–∑–∏ –∫–æ—Ä”£\n\n"
                  "üìù <b>–ß”£ —Ç–∞–≤—Ä —Ñ–∞—Ä–º–æ–∏—à –¥–æ–¥–∞–Ω:</b>\n"
                  "1. –ë–æ–≤–∞—Ä”£ “≥–æ—Å–∏–ª –∫—É–Ω–µ–¥, –∫–∏ –º–∞“≥—Å—É–ª–æ—Ç–∏ —à—É–º–æ —Å—Ç–∞—Ç—É—Å–∏ '–î–∞—Ä –∞–Ω–±–æ—Ä–∏ –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω' –¥–æ—Ä–∞–¥\n"
                  "2. –¢—É–≥–º–∞–∏ '–†–∞–º–∑“≥–æ–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω–∏ –º–∞–Ω'-—Ä–æ –ø–∞—Ö—à –∫—É–Ω–µ–¥\n"
                  "3. –ú–∞“≥—Å—É–ª–æ—Ç—Ä–æ –±–∞—Ä–æ–∏ —Ä–∞—Å–æ–Ω–∏–¥–∞–Ω –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥\n"
                  "4. –§–æ—Ä–º–∏ —Ä–∞—Å–æ–Ω–∏–¥–∞–Ω—Ä–æ –ø—É—Ä –∫—É–Ω–µ–¥"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_main_menu_keyboard(user.language),
            parse_mode="HTML"
        )

# ========== –ë–ï–°–ü–õ–ê–¢–ù–´–ô –ö–£–†–° ==========

@other_menus_router.message(F.text.contains("üéì"))
async def course_menu(message: Message, state: FSMContext):
    """–ú–µ–Ω—é –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –∫—É—Ä—Å–∞"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –≤—ã–±—Ä–∞–ª '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å'")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        texts = {
            "ru": "üéì <b>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å –ø–æ –ø–æ–∫—É–ø–∫–∞–º –≤ –ö–∏—Ç–∞–µ</b>\n\n"
                  "–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É, –ø–æ –∫–æ—Ç–æ—Ä–æ–π —Ö–æ—Ç–∏—Ç–µ –æ–±—É—á–∞—Ç—å—Å—è:",
            "tj": "üéì <b>–ö—É—Ä—Å–∏ –±–µ–ø—É–ª –æ–∏–¥ –±–∞ —Ö–∞—Ä–∏–¥ –¥–∞—Ä –ß–∏–Ω</b>\n\n"
                  "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞–µ—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥, –∫–∏ –º–µ—Ö–æ“≥–µ–¥ —Ç–∞“≥—Å–∏–ª –∫—É–Ω–µ–¥:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_course_platform_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.course_menu)

@other_menus_router.message(ClientState.course_menu)
async def course_platform_handler(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è –∫—É—Ä—Å–∞"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –≤—ã–±—Ä–∞–ª –ø–ª–∞—Ç—Ñ–æ—Ä–º—É: {message.text}")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        # –¢–µ–∫—Å—Ç—ã –∫–Ω–æ–ø–æ–∫
        back_ru = "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
        back_tj = "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"
        
        if message.text in [back_ru, back_tj]:
            await message.answer(
                "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:" if user.language == "ru" else "–ú–µ–Ω—é–∏ –∞—Å–æ—Å”£:",
                reply_markup=get_main_menu_keyboard(user.language)
            )
            await state.set_state(ClientState.main_menu)
            return
        
        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö
        platform_info = {
            "Taobao": {
                "ru": {
                    "title": "üéì <b>–ö—É—Ä—Å –ø–æ Taobao</b>",
                    "description": "–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–æ–∫—É–ø–∫–∞–º –Ω–∞ Taobao:\n\n"
                                  "üìö <b>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∫—É—Ä—Å–∞:</b>\n"
                                  "1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞\n"
                                  "2. –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏\n"
                                  "3. –û–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ–¥–∞–≤—Ü–∞–º–∏\n"
                                  "4. –û–ø–ª–∞—Ç–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å\n"
                                  "5. –î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ\n\n"
                                  "üîó <b>–°—Å—ã–ª–∫–∞ –Ω–∞ –∫—É—Ä—Å:</b>\n"
                                  "https://example.com/taobao-course\n\n"
                                  "‚è∞ <b>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</b> 10 —É—Ä–æ–∫–æ–≤, 5 —á–∞—Å–æ–≤ –≤–∏–¥–µ–æ",
                    "button": "Taobao"
                },
                "tj": {
                    "title": "üéì <b>–ö—É—Ä—Å –æ–∏–¥ –±–∞ Taobao</b>",
                    "description": "–î–∞—Å—Ç—É—Ä“≥–æ–∏ –∫–æ–º–∏–ª –æ–∏–¥ –±–∞ —Ö–∞—Ä–∏–¥ –¥–∞—Ä Taobao:\n\n"
                                  "üìö <b>–ú—É–Ω–¥–∞—Ä–∏“∑–∞–∏ –∫—É—Ä—Å:</b>\n"
                                  "1. –ë–∞“õ–∞–π–¥–≥–∏—Ä”£ –≤–∞ —Ç–∞–Ω–∑–∏–º–∏ “≥–∏—Å–æ–±\n"
                                  "2. “∂—É—Å—Ç—É“∑”Ø–∏ –º–∞“≥—Å—É–ª–æ—Ç –≤–∞ –∫–æ—Ä –±–æ —Ñ–∏–ª—å—Ç—Ä“≥–æ\n"
                                  "3. –°—É“≥–±–∞—Ç –±–æ —Ñ—É—Ä”Ø—à–∞–Ω–¥–∞–≥–æ–Ω\n"
                                  "4. –ü–∞—Ä–¥–æ—Ö—Ç –≤–∞ –∞–º–Ω–∏—è—Ç\n"
                                  "5. –†–∞—Å–æ–Ω–∏–¥–∞–Ω –≤–∞ —Ç–∞–º–æ—à–æ–±–∏–Ω\n\n"
                                  "üîó <b>–ò—Å—Ç–∏–Ω–æ–¥ –±–∞ –∫—É—Ä—Å:</b>\n"
                                  "https://example.com/taobao-course\n\n"
                                  "‚è∞ <b>–ú—É–¥–¥–∞—Ç:</b> 10 –¥–∞—Ä—Å, 5 —Å–æ–∞—Ç –≤–∏–¥–µ–æ",
                    "button": "Taobao"
                }
            },
            "Pinduoduo": {
                "ru": {
                    "title": "üéì <b>–ö—É—Ä—Å –ø–æ Pinduoduo</b>",
                    "description": "–û–±—É—á–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∞–º –Ω–∞ Pinduoduo:\n\n"
                                  "üìö <b>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∫—É—Ä—Å–∞:</b>\n"
                                  "1. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Pinduoduo\n"
                                  "2. –°–æ–≤–º–µ—Å—Ç–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏\n"
                                  "3. –ê–∫—Ü–∏–∏ –∏ —Å–∫–∏–¥–∫–∏\n"
                                  "4. –ì–∞—Ä–∞–Ω—Ç–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞\n"
                                  "5. –í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–æ–≤\n\n"
                                  "üîó <b>–°—Å—ã–ª–∫–∞ –Ω–∞ –∫—É—Ä—Å:</b>\n"
                                  "https://example.com/pinduoduo-course\n\n"
                                  "‚è∞ <b>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</b> 8 —É—Ä–æ–∫–æ–≤, 4 —á–∞—Å–∞ –≤–∏–¥–µ–æ",
                    "button": "Pinduoduo"
                },
                "tj": {
                    "title": "üéì <b>–ö—É—Ä—Å –æ–∏–¥ –±–∞ Pinduoduo</b>",
                    "description": "–¢–∞“≥—Å–∏–ª –¥–∞—Ä –±–æ—Ä–∞–∏ —Ö–∞—Ä–∏–¥ –¥–∞—Ä Pinduoduo:\n\n"
                                  "üìö <b>–ú—É–Ω–¥–∞—Ä–∏“∑–∞–∏ –∫—É—Ä—Å:</b>\n"
                                  "1) –•—É—Å—É—Å–∏—è—Ç“≥–æ–∏ Pinduoduo\n"
                                  "2) –•–∞—Ä–∏–¥“≥–æ–∏ –º—É—à—Ç–∞—Ä–∞–∫\n"
                                  "3) –ê–∫—Å–∏—è“≥–æ –≤–∞ —Ç–∞—Ö—Ñ–∏—Ñ“≥–æ\n"
                                  "4) –ö–∞—Ñ–æ–ª–∞—Ç–∏ —Å–∏—Ñ–∞—Ç\n"
                                  "5) –ë–æ–∑–≥–∞—à—Ç–∏ –º–∞“≥—Å—É–ª–æ—Ç\n\n"
                                  "üîó <b>–ò—Å—Ç–∏–Ω–æ–¥ –±–∞ –∫—É—Ä—Å:</b>\n"
                                  "https://example.com/pinduoduo-course\n\n"
                                  "‚è∞ <b>–ú—É–¥–¥–∞—Ç:</b> 8 –¥–∞—Ä—Å, 4 —Å–æ–∞—Ç –≤–∏–¥–µ–æ",
                    "button": "Pinduoduo"
                }
            },
            "Alibaba": {
                "ru": {
                    "title": "üéì <b>–ö—É—Ä—Å –ø–æ Alibaba</b>",
                    "description": "–û–ø—Ç–æ–≤—ã–µ –∑–∞–∫—É–ø–∫–∏ –Ω–∞ Alibaba:\n\n"
                                  "üìö <b>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∫—É—Ä—Å–∞:</b>\n"
                                  "1. –ü–æ–∏—Å–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤\n"
                                  "2. –ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã –æ —Ü–µ–Ω–µ\n"
                                  "3. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä—Ç–∏–∏ (MOQ)\n"
                                  "4. –õ–æ–≥–∏—Å—Ç–∏–∫–∞ –∏ —Ç–∞–º–æ–∂–Ω—è\n"
                                  "5. –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã\n\n"
                                  "üîó <b>–°—Å—ã–ª–∫–∞ –Ω–∞ –∫—É—Ä—Å:</b>\n"
                                  "https://example.com/alibaba-course\n\n"
                                  "‚è∞ <b>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</b> 12 —É—Ä–æ–∫–æ–≤, 6 —á–∞—Å–æ–≤ –≤–∏–¥–µ–æ",
                    "button": "Alibaba"
                },
                "tj": {
                    "title": "üéì <b>–ö—É—Ä—Å –æ–∏–¥ –±–∞ Alibaba</b>",
                    "description": "–•–∞—Ä–∏–¥“≥–æ–∏ —á–∞–Ω–¥–≥–æ–Ω–∞ –¥–∞—Ä Alibaba:\n\n"
                                  "üìö <b>–ú—É–Ω–¥–∞—Ä–∏“∑–∞–∏ –∫—É—Ä—Å:</b>\n"
                                  "1. “∂—É—Å—Ç—É“∑”Ø–∏ —Ç–∞—ä–º–∏–Ω–∫—É–Ω–∞–Ω–¥–∞–≥–æ–Ω–∏ —Å–∞–Ω“∑–∏–¥–∞—à—É–¥–∞\n"
                                  "2. –ú—É–∑–æ–∫–∏—Ä–æ—Ç –æ–∏–¥ –±–∞ –Ω–∞—Ä—Ö\n"
                                  "3. –ü–∞—Ä—á–∞–º“≥–æ–∏ “≥–∞–¥–¥–∏ –∞“õ–∞–ª (MOQ)\n"
                                  "4. –õ–æ–≥–∏—Å—Ç–∏–∫–∞ –≤–∞ –≥—É–º—Ä—É–∫\n"
                                  "5. “∂–∏“≥–∞—Ç“≥–æ–∏ “≥—É“õ—É“õ”£\n\n"
                                  "üîó <b>–ò—Å—Ç–∏–Ω–æ–¥ –±–∞ –∫—É—Ä—Å:</b>\n"
                                  "https://example.com/alibaba-course\n\n"
                                  "‚è∞ <b>–ú—É–¥–¥–∞—Ç:</b> 12 –¥–∞—Ä—Å, 6 —Å–æ–∞—Ç –≤–∏–¥–µ–æ",
                    "button": "Alibaba"
                }
            }
        }
        
        info = platform_info.get(message.text)
        if info:
            text = f"{info[user.language]['title']}\n\n{info[user.language]['description']}"
            await message.answer(
                text,
                reply_markup=get_course_platform_keyboard(user.language),
                parse_mode="HTML"
            )
        else:
            await message.answer(
                "–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –∏–∑ —Å–ø–∏—Å–∫–∞:" if user.language == "ru" 
                else "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ä–æ –∞–∑ —Ä”Ø–π—Ö–∞—Ç –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:",
                reply_markup=get_course_platform_keyboard(user.language)
            )
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\profile.py =====
"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
"""
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository, ProductRepository
from keyboards.client import get_profile_keyboard, get_main_menu_keyboard, get_back_cancel_keyboard
from utils.states import ClientState

logger = logging.getLogger(__name__)

# –°–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä
profile_router = Router()

@profile_router.message(ClientState.profile_menu)
async def profile_handler(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –≤ –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –≤ –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è: {message.text}")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        # –¢–µ–∫—Å—Ç—ã –∫–Ω–æ–ø–æ–∫
        edit_name_ru = "üìù –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è"
        edit_name_tj = "üìù –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –Ω–æ–º"
        edit_region_ru = "üìù –ò–∑–º–µ–Ω–∏—Ç—å —Ä–µ–≥–∏–æ–Ω"
        edit_region_tj = "üìù –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –º–∏–Ω—Ç–∞“õ–∞"
        back_ru = "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
        back_tj = "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"
        
        if message.text in [edit_name_ru, edit_name_tj]:
            texts = {
                "ru": "‚úèÔ∏è <b>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏</b>\n\n–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –Ω–æ–≤–æ–µ –∏–º—è:",
                "tj": "‚úèÔ∏è <b>–¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –Ω–æ–º</b>\n\n–ù–æ–º–∏ –Ω–∞–≤–∏ —Ö—É–¥—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:"
            }
            
            await message.answer(
                texts[user.language],
                reply_markup=get_back_cancel_keyboard(user.language),
                parse_mode="HTML"
            )
            await state.set_state(ClientState.edit_name)
            
        elif message.text in [edit_region_ru, edit_region_tj]:
            texts = {
                "ru": "üìç <b>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞</b>\n\n–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–æ–≤—ã–π —Ä–µ–≥–∏–æ–Ω:",
                "tj": "üìç <b>–¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –º–∏–Ω—Ç–∞“õ–∞</b>\n\n–ú–∏–Ω—Ç–∞“õ–∞–∏ –Ω–∞–≤–∏ —Ö—É–¥—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:"
            }
            
            await message.answer(
                texts[user.language],
                reply_markup=get_back_cancel_keyboard(user.language),
                parse_mode="HTML"
            )
            await state.set_state(ClientState.edit_region)
            
        elif message.text in [back_ru, back_tj]:
            await message.answer(
                "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:" if user.language == "ru" else "–ú–µ–Ω—é–∏ –∞—Å–æ—Å”£:",
                reply_markup=get_main_menu_keyboard(user.language)
            )
            await state.set_state(ClientState.main_menu)
        else:
            await show_profile(message, state)

async def show_profile(message: Message, state: FSMContext):
    """–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    async for session in get_db():
        user_repo = UserRepository(session)
        product_repo = ProductRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—á–Ω–∏—Ç–µ —Å –∫–æ–º–∞–Ω–¥—ã /start")
            return
        
        products = await product_repo.get_user_products(user.id)
        
        texts = {
            "ru": f"""üë§ <b>–ü—Ä–æ—Ñ–∏–ª—å</b>

üë§ –ò–º—è: {user.full_name or '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
üìû –¢–µ–ª–µ—Ñ–æ–Ω: {user.phone or '–ù–µ —É–∫–∞–∑–∞–Ω'}
üìç –†–µ–≥–∏–æ–Ω: {user.region or '–ù–µ —É–∫–∞–∑–∞–Ω'}
üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(products)}
üÜî UID: {user.telegram_id}

–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:""",
            "tj": f"""üë§ <b>–ü—Ä–æ—Ñ–∏–ª</b>

üë§ –ù–æ–º: {user.full_name or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üìû –¢–µ–ª–µ—Ñ–æ–Ω: {user.phone or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üìç –ú–∏–Ω—Ç–∞“õ–∞: {user.region or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üì¶ –ú–∏“õ–¥–æ—Ä–∏ –º–∞“≥—Å—É–ª–æ—Ç: {len(products)}
üÜî UID: {user.telegram_id}

–ê–º–∞–ª—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"""
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_profile_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.profile_menu)

@profile_router.message(ClientState.edit_name)
async def edit_name_handler(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–º–µ–Ω–∏"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        # –¢–µ–∫—Å—Ç—ã –∫–Ω–æ–ø–æ–∫
        cancel_ru = "‚ùå –û—Ç–º–µ–Ω–∞"
        cancel_tj = "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"
        back_ru = "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
        back_tj = "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"
        
        if message.text in [back_ru, back_tj, cancel_ru, cancel_tj]:
            await show_profile(message, state)
            return
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è
        await user_repo.update_user_profile(
            telegram_id=message.from_user.id,
            full_name=message.text
        )
        
        texts = {
            "ru": f"‚úÖ –ò–º—è —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞: {message.text}",
            "tj": f"‚úÖ –ù–æ–º –±–æ–º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç —Ç–∞“ì–π–∏—Ä –¥–æ–¥–∞ —à—É–¥ –±–∞: {message.text}"
        }
        
        await message.answer(texts[user.language])
        await show_profile(message, state)

@profile_router.message(ClientState.edit_region)
async def edit_region_handler(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–≥–∏–æ–Ω–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        # –¢–µ–∫—Å—Ç—ã –∫–Ω–æ–ø–æ–∫
        cancel_ru = "‚ùå –û—Ç–º–µ–Ω–∞"
        cancel_tj = "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"
        back_ru = "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
        back_tj = "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"
        
        if message.text in [back_ru, back_tj, cancel_ru, cancel_tj]:
            await show_profile(message, state)
            return
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–≥–∏–æ–Ω
        await user_repo.update_user_profile(
            telegram_id=message.from_user.id,
            region=message.text
        )
        
        texts = {
            "ru": f"‚úÖ –†–µ–≥–∏–æ–Ω —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: {message.text}",
            "tj": f"‚úÖ –ú–∏–Ω—Ç–∞“õ–∞ –±–æ–º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç —Ç–∞“ì–π–∏—Ä –¥–æ–¥–∞ —à—É–¥ –±–∞: {message.text}"
        }
        
        await message.answer(texts[user.language])
        await show_profile(message, state)
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\support.py =====
"""
–ü–æ–¥–¥–µ—Ä–∂–∫–∞
"""
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository
from keyboards.client import get_main_menu_keyboard
from utils.states import ClientState

logger = logging.getLogger(__name__)
router = Router()

@router.message(ClientState.main_menu, F.text.contains("üí¨"))
async def support_info(message: Message, state: FSMContext):
    """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–¥–µ—Ä–∂–∫–µ"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": """üí¨ <b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</b>

üìû –¢–µ–ª–µ—Ñ–æ–Ω: +992 123 45 67 89
üìß Email: support@example.com
üïí –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã: 9:00 - 18:00 (–ü–Ω-–ü—Ç)

–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –ø–æ –ª—é–±—ã–º –≤–æ–ø—Ä–æ—Å–∞–º!""",
            "tj": """üí¨ <b>–î–∞—Å—Ç–≥–∏—Ä”£</b>

üìû –¢–µ–ª–µ—Ñ–æ–Ω: +992 123 45 67 89
üìß Email: support@example.com
üïí –í–∞“õ—Ç–∏ –∫–æ—Ä: 9:00 - 18:00 (–î—É—à-“∂—É–º)

–ë–∞—Ä–æ–∏ “≥–∞–º–∞ —Å–∞–≤–æ–ª“≥–æ –±–æ –º–æ —Ç–∞–º–æ—Å –≥–∏—Ä–µ–¥!"""
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_main_menu_keyboard(user.language),
            parse_mode="HTML"
        )
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\track_codes.py =====
from sqlalchemy import select
import logging
from aiogram import Router, F
from aiogram.types import Message, InlineKeyboardButton, InlineKeyboardMarkup, CallbackQuery
from aiogram.fsm.context import FSMContext
from aiogram.utils.keyboard import InlineKeyboardBuilder, ReplyKeyboardBuilder
from aiogram.types import KeyboardButton

from database.models import Product, User
from database.session import get_db
from database.repository import UserRepository, ProductRepository
from database.models import ProductStatus, ProductCategory
from keyboards.client import get_track_codes_keyboard, get_main_menu_keyboard, get_back_cancel_keyboard
from keyboards.products import get_product_categories_keyboard, get_special_info_keyboard
from utils.states import ClientState
from services.track_code_generator import TrackCodeGenerator

logger = logging.getLogger(__name__)

# –°–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä
track_codes_router = Router()
# ========== –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ –¢–†–ï–ö-–ö–û–î–û–í ==========

@track_codes_router.message(ClientState.track_codes_menu)
async def track_codes_handler(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –≤ –º–µ–Ω—é —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤"""
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –≤ –º–µ–Ω—é —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤: {message.text}")
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if not user:
            return
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —è–∑—ã–∫–∞
        my_tracks_ru = "–ú–æ–∏ —Ç—Ä–µ–∫-–∫–æ–¥—ã"
        my_tracks_tj = "–†–∞–º–∑“≥–æ–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω–∏ –º–∞–Ω"
        check_track_ru = "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–µ–∫-–∫–æ–¥"
        check_track_tj = "–¢–∞—Ñ—Ç–∏—à –∫–∞—Ä–¥–∞–Ω–∏ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω"
        add_track_ru = "–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫-–∫–æ–¥"
        add_track_tj = "–ò–ª–æ–≤–∞ –∫–∞—Ä–¥–∞–Ω–∏ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω"
        edit_track_ru = "–ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä"
        edit_track_tj = "–¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç"
        export_ru = "–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel"
        export_tj = "–≠–∫—Å–ø–æ—Ä—Ç –±–∞ Excel"
        back_ru = "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
        back_tj = "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"
        
        if message.text in [my_tracks_ru, my_tracks_tj]:
            await show_my_track_codes(message, state)
            
        elif message.text in [check_track_ru, check_track_tj]:
            await check_track_code_start(message, state)
            
        elif message.text in [add_track_ru, add_track_tj]:
            await add_track_code_start(message, state)
            
        elif message.text in [edit_track_ru, edit_track_tj]:
            await edit_track_code_start(message, state)
            
        elif message.text in [back_ru, back_tj]:
            await message.answer(
                "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:" if user.language == "ru" else "–ú–µ–Ω—é–∏ –∞—Å–æ—Å”£:",
                reply_markup=get_main_menu_keyboard(user.language)
            )
            await state.set_state(ClientState.main_menu)
        else:
            await message.answer(
                "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ –º–µ–Ω—é" if user.language == "ru"
                else "–ê–º–∞–ª—Ä–æ –∞–∑ –º–µ–Ω—é –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥",
                reply_markup=get_track_codes_keyboard(user.language)
            )

# ========== –ú–û–ò –¢–†–ï–ö-–ö–û–î–´ ==========

async def show_my_track_codes(message: Message, state: FSMContext):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Ç—Ä–µ–∫-–∫–æ–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    async for session in get_db():
        user_repo = UserRepository(session)
        product_repo = ProductRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        products = await product_repo.get_user_products(user.id, limit=50)
        
        if not products:
            texts = {
                "ru": "üì≠ –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤.\n\n"
                      "–ù–∞–∂–º–∏—Ç–µ '–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫-–∫–æ–¥' —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä!",
                "tj": "üì≠ –®—É–º–æ —Ç–æ “≥–æ–ª –º–∞“≥—Å—É–ª–æ—Ç–∏ –∏–ª–æ–≤–∞—à—É–¥–∞ –Ω–∞–¥–æ—Ä–µ–¥.\n\n"
                      "–¢—É–≥–º–∞–∏ '–ò–ª–æ–≤–∞ –∫–∞—Ä–¥–∞–Ω–∏ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω'-—Ä–æ –ø–∞—Ö—à –∫—É–Ω–µ–¥, —Ç–æ –∞–≤–≤–∞–ª–∏–Ω –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –∏–ª–æ–≤–∞ –∫—É–Ω–µ–¥!"
            }
            await message.answer(texts[user.language])
            return
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
        current_page = 1
        page_size = 5
        start_idx = (current_page - 1) * page_size
        end_idx = min(start_idx + page_size, len(products))
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
        await state.update_data(
            products_page=current_page,
            user_products=products,
            products_total=len(products)
        )
        
        await show_products_page(message, state, products[start_idx:end_idx], current_page, len(products))

async def show_products_page(message: Message, state: FSMContext, products, page: int, total: int):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —Ç–æ–≤–∞—Ä–∞–º–∏"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        page_size = 5
        total_pages = (total + page_size - 1) // page_size
        
        # –ó–∞–≥–æ–ª–æ–≤–æ–∫
        text = {
            "ru": f"üì¶ <b>–í–∞—à–∏ —Ç–æ–≤–∞—Ä—ã (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ {page}/{total_pages}):</b>\n\n",
            "tj": f"üì¶ <b>–ú–∞“≥—Å—É–ª–æ—Ç“≥–æ–∏ —à—É–º–æ (—Å–∞“≥–∏—Ñ–∞ {page}/{total_pages}):</b>\n\n"
        }[user.language]
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä—ã
        start_num = (page - 1) * page_size + 1
        for i, product in enumerate(products, start_num):
            status_text = get_status_text(product.status.value, user.language)
            product_name = product.product_name or ("–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è" if user.language == "ru" else "–ë–µ–Ω–æ–º")
            
            text += f"<b>{i}.</b> <code>{product.track_code}</code>\n"
            text += f"   üè∑Ô∏è {product_name}\n"
            text += f"   üìç {status_text}\n"
            
            if product.total_value_usd and product.total_value_usd > 0:
                cost_text = f"   üí∞ ${product.total_value_usd:.2f}\n" if user.language == "ru" else f"   üí∞ ${product.total_value_usd:.2f}\n"
                text += cost_text
            
            text += f"   üìÖ {product.created_at.strftime('%d.%m.%Y')}\n\n"
        
        # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
        keyboard = InlineKeyboardBuilder()
        
        if page > 1:
            keyboard.add(InlineKeyboardButton(
                text="‚óÄÔ∏è –ù–∞–∑–∞–¥" if user.language == "ru" else "‚óÄÔ∏è –ë–æ–∑–≥–∞—à—Ç",
                callback_data=f"prev_page_{page-1}"
            ))
        
        if page < total_pages:
            keyboard.add(InlineKeyboardButton(
                text="–í–ø–µ—Ä–µ–¥ ‚ñ∂Ô∏è" if user.language == "ru" else "–û—ë–¥ ‚ñ∂Ô∏è",
                callback_data=f"next_page_{page+1}"
            ))
        
        # –ö–Ω–æ–ø–∫–∞ –¥–µ—Ç–∞–ª–µ–π –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞, –µ—Å–ª–∏ –æ–Ω –æ–¥–∏–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        if len(products) == 1:
            keyboard.row(InlineKeyboardButton(
                text="üîç –ü–æ–¥—Ä–æ–±–Ω–µ–µ" if user.language == "ru" else "üîç –¢–∞—Ñ—Å–∏–ª–æ—Ç",
                callback_data=f"view_product_{products[0].id}"
            ))
        
        # –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
        keyboard.row(InlineKeyboardButton(
            text="üîô –í –º–µ–Ω—é" if user.language == "ru" else "üîô –ë–∞ –º–µ–Ω—é",
            callback_data="back_to_track_menu"
        ))
        
        await message.answer(
            text,
            reply_markup=keyboard.as_markup(),
            parse_mode="HTML"
        )

# ========== –ü–†–û–í–ï–†–ö–ê –¢–†–ï–ö-–ö–û–î–ê ==========

async def check_track_code_start(message: Message, state: FSMContext):
    """–ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–µ–∫-–∫–æ–¥–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üîç <b>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–∫-–∫–æ–¥–∞</b>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫-–∫–æ–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:\n"
                  "<i>–ú–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–¥–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</i>",
            "tj": "üîç <b>–¢–∞—Ñ—Ç–∏—à –∫–∞—Ä–¥–∞–Ω–∏ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω</b>\n\n"
                  "–ë–∞—Ä–æ–∏ —Ç–∞—Ñ—Ç–∏—à —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:\n"
                  "<i>–Ø–∫—á–∞–Ω–¥ —Ä–∞–º–∑—Ä–æ –±–æ –≤–µ—Ä–≥—É–ª “∑—É–¥–æ –∫–∞—Ä–¥–∞–Ω –º—É–º–∫–∏–Ω –∞—Å—Ç</i>"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.check_track_code)

@track_codes_router.message(ClientState.check_track_code)
async def process_check_track_code(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–µ–∫-–∫–æ–¥–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await back_to_track_menu(message, state)
        return
    
    async for session in get_db():
        user_repo = UserRepository(session)
        product_repo = ProductRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        # –†–∞–∑–¥–µ–ª—è–µ–º —Ç—Ä–µ–∫-–∫–æ–¥—ã
        track_codes = [code.strip() for code in message.text.split(",") if code.strip()]
        
        if not track_codes:
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç—Ä–µ–∫-–∫–æ–¥",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, –Ω–∞ –∫–∞–º—Ç–∞—Ä —è–∫ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥"
            }
            await message.answer(texts[user.language])
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π —Ç—Ä–µ–∫-–∫–æ–¥
        results = []
        for track_code in track_codes:
            product = await product_repo.get_product_by_track_code(track_code)
            
            if product:
                status_text = get_status_text(product.status.value, user.language)
                product_name = product.product_name or "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ª–∏ —Ç–æ–≤–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                belongs_to_user = product.user_id == user.id
                owner_info = ""
                if not belongs_to_user:
                    owner_info = "\n   ‚ö†Ô∏è –≠—Ç–æ—Ç —Ç–æ–≤–∞—Ä –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é" if user.language == "ru" else "\n   ‚ö†Ô∏è –ò–Ω –º–∞“≥—Å—É–ª–æ—Ç –±–∞ –∫–æ—Ä–±–∞—Ä–∏ –¥–∏–≥–∞—Ä —Ç–∞–∞–ª–ª—É“õ –¥–æ—Ä–∞–¥"
                
                results.append(f"‚úÖ <b>{track_code}</b>\n"
                             f"   üè∑Ô∏è {product_name}\n"
                             f"   üìç {status_text}{owner_info}")
            else:
                results.append(f"‚ùå <b>{track_code}</b> - –Ω–µ –Ω–∞–π–¥–µ–Ω" if user.language == "ru" else f"‚ùå <b>{track_code}</b> - —ë—Ñ—Ç –Ω–∞—à—É–¥")
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        text = {
            "ru": f"üîç <b>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:</b>\n\n" + "\n\n".join(results),
            "tj": f"üîç <b>–ù–∞—Ç–∏“∑–∞“≥–æ–∏ —Ç–∞—Ñ—Ç–∏—à:</b>\n\n" + "\n\n".join(results)
        }[user.language]
        
        await message.answer(
            text,
            reply_markup=get_track_codes_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.track_codes_menu)

# ========== –î–û–ë–ê–í–õ–ï–ù–ò–ï –¢–†–ï–ö-–ö–û–î–ê ==========

async def add_track_code_start(message: Message, state: FSMContext):
    """–ù–∞—á–∞–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫-–∫–æ–¥–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç—Ä–µ–∫-–∫–æ–¥
        track_code = TrackCodeGenerator.generate_track_code(user.telegram_id)
        
        texts = {
            "ru": f"üì¶ <b>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                  f"–í–∞—à —Ç—Ä–µ–∫-–∫–æ–¥: <code>{track_code}</code>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:",
            "tj": f"üì¶ <b>–ò–ª–æ–≤–∞ –∫–∞—Ä–¥–∞–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç–∏ –Ω–∞–≤</b>\n\n"
                  f"–†–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω–∏ —à—É–º–æ: <code>{track_code}</code>\n\n"
                  "–ù–æ–º–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:"
        }
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—Ä–µ–∫-–∫–æ–¥ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
        await state.update_data(track_code=track_code)
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_name)

@track_codes_router.message(ClientState.product_name)
async def process_product_name(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç", "‚ùå –û—Ç–º–µ–Ω–∞", "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"]:
        await back_to_track_menu(message, state)
        return
    
    await state.update_data(product_name=message.text)
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üè∑Ô∏è <b>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞:</b>",
            "tj": "üè∑Ô∏è <b>–ì—É—Ä”Ø“≥–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:</b>"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_product_categories_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_category)

@track_codes_router.message(ClientState.product_category)
async def process_product_category(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç", "‚ùå –û—Ç–º–µ–Ω–∞", "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"]:
        await state.set_state(ClientState.product_name)
        await process_product_name(message, state)
        return
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        # –ú–∞–ø–ø–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        category_map = {
            "ru": {
                "üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞": ProductCategory.ELECTRONICS,
                "üëï –û–¥–µ–∂–¥–∞": ProductCategory.CLOTHING,
                "üëü –û–±—É–≤—å": ProductCategory.SHOES,
                "üè† –ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞": ProductCategory.HOME_APPLIANCES,
                "üíÑ –ö–æ—Å–º–µ—Ç–∏–∫–∞": ProductCategory.BEAUTY,
                "üß∏ –ò–≥—Ä—É—à–∫–∏": ProductCategory.TOYS,
                "üöó –ê–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–∏": ProductCategory.AUTOMOTIVE,
                "‚öΩ –°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã": ProductCategory.SPORTS,
                "üì¶ –î—Ä—É–≥–æ–µ": ProductCategory.OTHER
            },
            "tj": {
                "üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞": ProductCategory.ELECTRONICS,
                "üëï –õ–∏–±–æ—Å": ProductCategory.CLOTHING,
                "üëü –ü–æ–π–∞—Ñ–∑–æ–ª": ProductCategory.SHOES,
                "üè† –ê—Å–±–æ–±“≥–æ–∏ —Ö–æ–Ω–∞–≥”£": ProductCategory.HOME_APPLIANCES,
                "üíÑ –ö–æ—Å–º–µ—Ç–∏–∫–∞": ProductCategory.BEAUTY,
                "üß∏ –ë–æ–∑–∏—á–∞“≥–æ": ProductCategory.TOYS,
                "üöó “ö–∏—Å–º“≥–æ–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª": ProductCategory.AUTOMOTIVE,
                "‚öΩ –ê—à—ë“≥–æ–∏ –≤–∞—Ä–∑–∏—à”£": ProductCategory.SPORTS,
                "üì¶ –î–∏–≥–∞—Ä": ProductCategory.OTHER
            }
        }
        
        selected_category = category_map[user.language].get(message.text)
        if not selected_category:
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ —Å–ø–∏—Å–∫–∞",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, –≥—É—Ä”Ø“≥—Ä–æ –∞–∑ —Ä”Ø–π—Ö–∞—Ç –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥"
            }
            await message.answer(texts[user.language])
            return
        
        await state.update_data(product_category=selected_category)
        
        texts = {
            "ru": "üìù <b>–û–ø–∏—à–∏—Ç–µ —Ç–æ–≤–∞—Ä (—Ü–≤–µ—Ç, —Ä–∞–∑–º–µ—Ä, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏):</b>\n\n"
                  "<i>–ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å'</i>",
            "tj": "üìù <b>–ú–∞“≥—Å—É–ª–æ—Ç—Ä–æ —Ç–∞–≤—Å–∏—Ñ –∫—É–Ω–µ–¥ (—Ä–∞–Ω–≥, –∞–Ω–¥–æ–∑–∞, —Ö—É—Å—É—Å–∏—è—Ç“≥–æ):</b>\n\n"
                  "<i>–Å '–ì—É–∑–∞—Ä–æ–Ω' –Ω–∞–≤–∏—Å–µ–¥</i>"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_description)

@track_codes_router.message(ClientState.product_description)
async def process_product_description(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç", "‚ùå –û—Ç–º–µ–Ω–∞", "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"]:
        await state.set_state(ClientState.product_category)
        await process_product_category(message, state)
        return
    
    skip_texts = ["–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å", "–ì—É–∑–∞—Ä–æ–Ω"]
    description = None if message.text in skip_texts else message.text
    await state.update_data(product_description=description)
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üî¢ <b>–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü —Ç–æ–≤–∞—Ä–∞:</b>\n\n"
                  "<i>–ü—Ä–∏–º–µ—Ä: 1 –∏–ª–∏ 10</i>",
            "tj": "üî¢ <b>–ú–∏“õ–¥–æ—Ä–∏ –≤–æ“≥–∏–¥“≥–æ–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:</b>\n\n"
                  "<i>–ù–∞–º—É–Ω–∞: 1 —ë 10</i>"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_quantity)

@track_codes_router.message(ClientState.product_quantity)
async def process_product_quantity(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç", "‚ùå –û—Ç–º–µ–Ω–∞", "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"]:
        await state.set_state(ClientState.product_description)
        await process_product_description(message, state)
        return
    
    try:
        quantity = int(message.text)
        if quantity <= 0:
            raise ValueError
        
        await state.update_data(quantity=quantity)
        
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "üí∞ <b>–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –∑–∞ –æ–¥–Ω—É –µ–¥–∏–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ (–≤ USD):</b>\n\n"
                      "<i>–ü—Ä–∏–º–µ—Ä: 199.99</i>",
                "tj": "üí∞ <b>–ù–∞—Ä—Ö–∏ —è–∫ –≤–æ“≥–∏–¥–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä USD):</b>\n\n"
                      "<i>–ù–∞–º—É–Ω–∞: 199.99</i>"
            }
            
            await message.answer(
                texts[user.language],
                reply_markup=get_back_cancel_keyboard(user.language),
                parse_mode="HTML"
            )
            await state.set_state(ClientState.product_unit_price)
            
    except ValueError:
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–æ–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1, 5, 10)",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, —Ä–∞“õ–∞–º–∏ –±—É—Ç—É–Ω–∏ –º—É—Å–±–∞—Ç –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–º–∞—Å–∞–ª–∞–Ω: 1, 5, 10)"
            }
            await message.answer(texts[user.language])

@track_codes_router.message(ClientState.product_unit_price)
async def process_product_unit_price(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ —Ü–µ–Ω—ã –∑–∞ –µ–¥–∏–Ω–∏—Ü—É"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç", "‚ùå –û—Ç–º–µ–Ω–∞", "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"]:
        await state.set_state(ClientState.product_quantity)
        await process_product_quantity(message, state)
        return
    
    try:
        cleaned_text = message.text.replace(",", ".")
        unit_price = float(cleaned_text)
        
        if unit_price < 0:
            raise ValueError
        
        data = await state.get_data()
        quantity = data.get('quantity', 1)
        total_value = unit_price * quantity
        
        await state.update_data(
            unit_price=unit_price,
            total_value=total_value
        )
        
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚öñÔ∏è <b>–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –æ–¥–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ (–≤ –∫–≥):</b>\n\n"
                      "<i>–ü—Ä–∏–º–µ—Ä: 0.5 –∏–ª–∏ 2.3</i>",
                "tj": "‚öñÔ∏è <b>–í–∞–∑–Ω–∏ —è–∫ –≤–æ“≥–∏–¥–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä –∫–≥):</b>\n\n"
                      "<i>–ù–∞–º—É–Ω–∞: 0.5 —ë 2.3</i>"
            }
            
            await message.answer(
                texts[user.language],
                reply_markup=get_back_cancel_keyboard(user.language),
                parse_mode="HTML"
            )
            await state.set_state(ClientState.product_weight)
            
    except ValueError:
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 50, 99.99, 150.50)",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, —Ä–∞“õ–∞–º –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–º–∞—Å–∞–ª–∞–Ω: 50, 99.99, 150.50)"
            }
            await message.answer(texts[user.language])

@track_codes_router.message(ClientState.product_weight)
async def process_product_weight(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –≤–µ—Å–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç", "‚ùå –û—Ç–º–µ–Ω–∞", "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"]:
        await state.set_state(ClientState.product_unit_price)
        await process_product_unit_price(message, state)
        return
    
    try:
        cleaned_text = message.text.replace(",", ".")
        weight = float(cleaned_text)
        
        if weight <= 0:
            raise ValueError
        
        await state.update_data(weight=weight)
        
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚ö†Ô∏è <b>–í—ã–±–µ—Ä–∏—Ç–µ –æ—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞:</b>",
                "tj": "‚ö†Ô∏è <b>–•—É—Å—É—Å–∏—è—Ç“≥–æ–∏ –º–∞—Ö—Å—É—Å–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:</b>"
            }
            
            await message.answer(
                texts[user.language],
                reply_markup=get_special_info_keyboard(user.language),
                parse_mode="HTML"
            )
            await state.set_state(ClientState.product_special_info)
            
    except ValueError:
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 0.5, 1.2, 3.0)",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, —Ä–∞“õ–∞–º–∏ –º—É—Å–±–∞—Ç –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–º–∞—Å–∞–ª–∞–Ω: 0.5, 1.2, 3.0)"
            }
            await message.answer(texts[user.language])

@track_codes_router.message(ClientState.product_special_info)
async def process_product_special_info(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –æ—Å–æ–±—ã—Ö —Å–≤–æ–π—Å—Ç–≤ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç", "‚ùå –û—Ç–º–µ–Ω–∞", "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"]:
        await state.set_state(ClientState.product_weight)
        await process_product_weight(message, state)
        return
    
    async for session in get_db():
        user_repo = UserRepository(session)
        product_repo = ProductRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞
        property_map = {
            "ru": {
                "–•—Ä—É–ø–∫–∏–π": {"fragile": True},
                "–° –±–∞—Ç–∞—Ä–µ–µ–π": {"has_battery": True},
                "–ñ–∏–¥–∫–æ—Å—Ç—å": {"is_liquid": True},
                "–ù–µ—Ç –æ—Å–æ–±—ã—Ö —Å–≤–æ–π—Å—Ç–≤": {}
            },
            "tj": {
                "–ù–æ–∑—É–∫": {"fragile": True},
                "–ë–æ –±–∞—Ç–∞—Ä–µ—è": {"has_battery": True},
                "–ú–æ–µ—ä": {"is_liquid": True},
                "–•—É—Å—É—Å–∏—è—Ç–∏ –º–∞—Ö—Å—É—Å –Ω–µ—Å—Ç": {}
            }
        }
        
        properties = property_map[user.language].get(message.text, {})
        
        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
        data = await state.get_data()
        
        try:
            # –°–æ–∑–¥–∞–µ–º —Ç–æ–≤–∞—Ä
            product = await product_repo.create_product(
                track_code=data['track_code'],
                user_id=user.id,
                product_name=data.get('product_name'),
                product_category=data.get('product_category'),
                product_description=data.get('product_description'),
                quantity=data.get('quantity', 1),
                unit_price_usd=data.get('unit_price', 0.0),
                total_value_usd=data.get('total_value', 0.0),
                weight_kg=data.get('weight', 0.0),
                **properties
            )
            
            # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
            category_name = get_category_name(data.get('product_category'), user.language)
            
            texts = {
                "ru": f"""‚úÖ <b>–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!</b>

üì¶ <b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ:</b>
üéØ –¢—Ä–µ–∫-–∫–æ–¥: <code>{data['track_code']}</code>
üè∑Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ: {data.get('product_name', '–ù–µ —É–∫–∞–∑–∞–Ω–æ')}
üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category_name}
üìù –û–ø–∏—Å–∞–Ω–∏–µ: {data.get('product_description', '–ù–µ —É–∫–∞–∑–∞–Ω–æ')}
üî¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {data.get('quantity', 1)} —à—Ç.
üí∞ –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É: ${data.get('unit_price', 0.0):.2f}
üíµ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${data.get('total_value', 0.0):.2f}
‚öñÔ∏è –í–µ—Å: {data.get('weight', 0.0):.2f} –∫–≥

üìÖ –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: {product.created_at.strftime('%d.%m.%Y %H:%M')}
üÜî ID —Ç–æ–≤–∞—Ä–∞: {product.id}

<i>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Ç–µ–ø–µ—Ä—å –≤–∏–¥—è—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∞—à–µ–º —Ç–æ–≤–∞—Ä–µ.</i>""",
                "tj": f"""‚úÖ <b>–ú–∞“≥—Å—É–ª–æ—Ç –±–æ–º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç –∏–ª–æ–≤–∞ –∫–∞—Ä–¥–∞ —à—É–¥!</b>

üì¶ <b>–ú–∞—ä–ª—É–º–æ—Ç –¥–∞—Ä –±–æ—Ä–∞–∏ –º–∞“≥—Å—É–ª–æ—Ç:</b>
üéØ –†–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω: <code>{data['track_code']}</code>
üè∑Ô∏è –ù–æ–º: {data.get('product_name', '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç')}
üìÇ –ì—É—Ä”Ø“≥: {category_name}
üìù –¢–∞–≤—Å–∏—Ñ: {data.get('product_description', '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç')}
üî¢ –ú–∏“õ–¥–æ—Ä: {data.get('quantity', 1)} –¥–æ–Ω–∞
üí∞ –ù–∞—Ä—Ö –±–∞—Ä–æ–∏ —è–∫ –≤–æ“≥–∏–¥: ${data.get('unit_price', 0.0):.2f}
üíµ –ê—Ä–∑–∏—à–∏ —É–º—É–º”£: ${data.get('total_value', 0.0):.2f}
‚öñÔ∏è –í–∞–∑–Ω: {data.get('weight', 0.0):.2f} –∫–≥

üìÖ –°–∞–Ω–∏–∏ –∏–ª–æ–≤–∞: {product.created_at.strftime('%d.%m.%Y %H:%M')}
üÜî ID –º–∞“≥—Å—É–ª–æ—Ç: {product.id}

<i>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä“≥–æ –∞–∫–Ω—É–Ω –º–∞—ä–ª—É–º–æ—Ç–∏ –ø—É—Ä—Ä–∞ –¥–∞—Ä –±–æ—Ä–∞–∏ –º–∞“≥—Å—É–ª–æ—Ç–∏ —à—É–º–æ—Ä–æ –º–µ–±–∏–Ω–∞–Ω–¥.</i>"""
            }
            
            await message.answer(
                texts[user.language],
                reply_markup=get_track_codes_keyboard(user.language),
                parse_mode="HTML"
            )
            await state.set_state(ClientState.track_codes_menu)
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞: {e}")
            texts = {
                "ru": "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.",
                "tj": "‚ùå –î–∞—Ä –∑–∞—Ö–∏—Ä–∞ –∫–∞—Ä–¥–∞–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç —Ö–∞—Ç–æ —Ä—É—Ö –¥–æ–¥. –õ—É—Ç—Ñ–∞–Ω, –±–æ—Ä–∏ –¥–∏–≥–∞—Ä –∫”Ø—à–∏—à –∫—É–Ω–µ–¥."
            }
            await message.answer(
                texts[user.language],
                reply_markup=get_track_codes_keyboard(user.language)
            )
            await state.set_state(ClientState.track_codes_menu)

# ========== –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –¢–û–í–ê–†–ê ==========

# ========== –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –¢–û–í–ê–†–ê ==========

async def edit_track_code_start(message: Message, state: FSMContext):
    """–ù–∞—á–∞–ª–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        product_repo = ProductRepository(session)
        products = await product_repo.get_user_products(user.id, limit=20)
        
        if not products:
            texts = {
                "ru": "‚ùå –£ –≤–∞—Å –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",
                "tj": "‚ùå –®—É–º–æ –º–∞“≥—Å—É–ª–æ—Ç –±–∞—Ä–æ–∏ —Ç–∞“≥—Ä–∏—Ä –∫–∞—Ä–¥–∞–Ω –Ω–∞–¥–æ—Ä–µ–¥"
            }
            await message.answer(texts[user.language])
            return
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–≤–∞—Ä—ã –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        await state.update_data(edit_products=products)
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞
        text = {
            "ru": "‚úèÔ∏è <b>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</b>\n\n",
            "tj": "‚úèÔ∏è <b>–ú–∞“≥—Å—É–ª–æ—Ç—Ä–æ –±–∞—Ä–æ–∏ —Ç–∞“≥—Ä–∏—Ä –∫–∞—Ä–¥–∞–Ω –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:</b>\n\n"
        }[user.language]
        
        keyboard = InlineKeyboardBuilder()
        
        for i, product in enumerate(products, 1):
            product_name = product.product_name or ("–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è" if user.language == "ru" else "–ë–µ–Ω–æ–º")
            status_text = get_status_text(product.status.value, user.language)
            text += f"{i}. <code>{product.track_code}</code> - {product_name} ({status_text})\n"
            
            # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ (–º–∞–∫—Å–∏–º—É–º 10)
            if i <= 10:
                keyboard.add(InlineKeyboardButton(
                    text=f"{i}. {product.track_code[:8]}...",
                    callback_data=f"edit_select_{product.id}"
                ))
        
        keyboard.add(InlineKeyboardButton(
            text="üîô –ù–∞–∑–∞–¥" if user.language == "ru" else "üîô –ë–æ–∑–≥–∞—à—Ç",
            callback_data="back_to_track_menu"
        ))
        
        keyboard.adjust(2)
        
        await message.answer(
            text,
            reply_markup=keyboard.as_markup(),
            parse_mode="HTML"
        )

# ========== INLINE CALLBACK –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø ==========

@track_codes_router.callback_query(F.data.startswith("edit_select_"))
async def edit_select_callback(callback: CallbackQuery, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    product_id = int(callback.data.split("_")[2])
    
    async for session in get_db():
        user_repo = UserRepository(session)
        product_repo = ProductRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(callback.from_user.id)
        
        # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä
        result = await session.execute(
            select(Product).where(Product.id == product_id)
        )
        product = result.scalar_one_or_none()
        
        if not product or product.user_id != user.id:
            await callback.answer("–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")
            return
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ç–æ–≤–∞—Ä–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
        await state.update_data(edit_product_id=product_id)
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
        
        texts = {
            "ru": f"‚úèÔ∏è <b>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                  f"–¢—Ä–µ–∫-–∫–æ–¥: <code>{product.track_code}</code>\n"
                  f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.product_name or '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}\n\n"
                  f"–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å?",
            "tj": f"‚úèÔ∏è <b>–¢–∞“≥—Ä–∏—Ä –∫–∞—Ä–¥–∞–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç</b>\n\n"
                  f"–†–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω: <code>{product.track_code}</code>\n"
                  f"–ù–æ–º: {product.product_name or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}\n\n"
                  f"–®—É–º–æ —á”£ –º–µ—Ö–æ“≥–µ–¥ —Ç–∞“ì–π–∏—Ä –¥–∏“≥–µ–¥?"
        }
        
        keyboard = ReplyKeyboardBuilder()
        options = [
            ("üìù –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ", "üìù –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –Ω–æ–º"),
            ("üìù –ò–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ", "üìù –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ —Ç–∞–≤—Å–∏—Ñ"),
            ("üî¢ –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ", "üî¢ –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –º–∏“õ–¥–æ—Ä"),
            ("üí∞ –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É", "üí∞ –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –Ω–∞—Ä—Ö"),
            ("‚öñÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –≤–µ—Å", "‚öñÔ∏è –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –≤–∞–∑–Ω"),
            ("üè∑Ô∏è –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é", "üè∑Ô∏è –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –≥—É—Ä”Ø“≥"),
            ("üîô –ù–∞–∑–∞–¥", "üîô –ë–æ–∑–≥–∞—à—Ç")
        ]
        
        for option_ru, option_tj in options:
            keyboard.add(KeyboardButton(
                text=option_ru if user.language == "ru" else option_tj
            ))
        
        keyboard.adjust(2, 2, 2, 1)
        
        await callback.message.answer(
            texts[user.language],
            reply_markup=keyboard.as_markup(resize_keyboard=True),
            parse_mode="HTML"
        )
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        await state.set_state(ClientState.edit_product)
    
    await callback.answer()

@track_codes_router.callback_query(F.data.startswith("edit_product_"))
async def edit_product_callback(callback: CallbackQuery, state: FSMContext):
    """–ù–∞—á–∞–ª–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    product_id = int(callback.data.split("_")[2])
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ç–æ–≤–∞—Ä–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
    await state.update_data(edit_product_id=product_id)
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(callback.from_user.id)
        
        texts = {
            "ru": "‚úèÔ∏è <b>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</b>\n\n–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å?",
            "tj": "‚úèÔ∏è <b>–¢–∞“≥—Ä–∏—Ä –∫–∞—Ä–¥–∞–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç</b>\n\n–®—É–º–æ —á”£ –º–µ—Ö–æ“≥–µ–¥ —Ç–∞“ì–π–∏—Ä –¥–∏“≥–µ–¥?"
        }
        
        keyboard = ReplyKeyboardBuilder()
        options = [
            ("üìù –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ", "üìù –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –Ω–æ–º"),
            ("üìù –ò–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ", "üìù –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ —Ç–∞–≤—Å–∏—Ñ"),
            ("üî¢ –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ", "üî¢ –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –º–∏“õ–¥–æ—Ä"),
            ("üí∞ –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É", "üí∞ –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –Ω–∞—Ä—Ö"),
            ("‚öñÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –≤–µ—Å", "‚öñÔ∏è –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –≤–∞–∑–Ω"),
            ("üè∑Ô∏è –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é", "üè∑Ô∏è –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –≥—É—Ä”Ø“≥"),
            ("üîô –ù–∞–∑–∞–¥", "üîô –ë–æ–∑–≥–∞—à—Ç")
        ]
        
        for option_ru, option_tj in options:
            keyboard.add(KeyboardButton(
                text=option_ru if user.language == "ru" else option_tj
            ))
        
        keyboard.adjust(2, 2, 2, 1)
        
        await callback.message.answer(
            texts[user.language],
            reply_markup=keyboard.as_markup(resize_keyboard=True),
            parse_mode="HTML"
        )
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        await state.set_state(ClientState.edit_product)
    
    await callback.answer()

@track_codes_router.callback_query(F.data.startswith("edit_name_"))
async def edit_name_callback(callback: CallbackQuery, state: FSMContext):
    """–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    product_id = int(callback.data.split("_")[2])
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(callback.from_user.id)
        
        await state.update_data(edit_field="name", edit_product_id=product_id)
        
        texts = {
            "ru": "‚úèÔ∏è <b>–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:</b>",
            "tj": "‚úèÔ∏è <b>–ù–æ–º–∏ –Ω–∞–≤–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:</b>"
        }
        
        await callback.message.edit_text(
            texts[user.language],
            parse_mode="HTML"
        )
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è
        from utils.states import ClientState
        await state.set_state(ClientState.edit_product_name)
    
    await callback.answer()

@track_codes_router.callback_query(F.data.startswith("edit_desc_"))
async def edit_desc_callback(callback: CallbackQuery, state: FSMContext):
    """–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    product_id = int(callback.data.split("_")[2])
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(callback.from_user.id)
        
        await state.update_data(edit_field="description", edit_product_id=product_id)
        
        texts = {
            "ru": "‚úèÔ∏è <b>–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:</b>\n\n<i>–ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ '–£–¥–∞–ª–∏—Ç—å' —á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ</i>",
            "tj": "‚úèÔ∏è <b>–¢–∞–≤—Å–∏—Ñ–∏ –Ω–∞–≤–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:</b>\n\n<i>–Å '–ù–µ—Å—Ç –∫–∞—Ä–¥–∞–Ω' –Ω–∞–≤–∏—Å–µ–¥, —Ç–æ —Ç–∞–≤—Å–∏—Ñ—Ä–æ –Ω–µ—Å—Ç –∫—É–Ω–µ–¥</i>"
        }
        
        await callback.message.edit_text(
            texts[user.language],
            parse_mode="HTML"
        )
        
        await state.set_state(ClientState.edit_product_desc)
    
    await callback.answer()

# –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π:
# edit_quantity_, edit_price_, edit_weight_, edit_category_

@track_codes_router.callback_query(F.data == "back_to_edit_list")
async def back_to_edit_list_callback(callback: CallbackQuery, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    await edit_track_code_start(callback.message, state)
    await callback.answer()

# ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –í–í–û–î–ê –î–ê–ù–ù–´–• –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø ==========

@track_codes_router.message(ClientState.edit_product_name)
async def process_edit_product_name(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç", "‚ùå –û—Ç–º–µ–Ω–∞", "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"]:
        await back_to_track_menu(message, state)
        return
    
    data = await state.get_data()
    product_id = data.get('edit_product_id')
    
    async for session in get_db():
        product_repo = ProductRepository(session)
        user_repo = UserRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
        updated_product = await product_repo.update_product(
            product_id,
            product_name=message.text
        )
        
        if updated_product:
            texts = {
                "ru": f"‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ <code>{updated_product.track_code}</code> —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞: {message.text}",
                "tj": f"‚úÖ –ù–æ–º–∏ –º–∞“≥—Å—É–ª–æ—Ç <code>{updated_product.track_code}</code> –±–æ–º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç —Ç–∞“ì–π–∏—Ä –¥–æ–¥–∞ —à—É–¥ –±–∞: {message.text}"
            }
            await message.answer(texts[user.language], parse_mode="HTML")
        else:
            texts = {
                "ru": "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è",
                "tj": "‚ùå –•–∞—Ç–æ –¥–∞—Ä —Ç–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –Ω–æ–º"
            }
            await message.answer(texts[user.language])
    
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –º–µ–Ω—é —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤
    await back_to_track_menu(message, state)

@track_codes_router.message(ClientState.edit_product_desc)
async def process_edit_product_desc(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç", "‚ùå –û—Ç–º–µ–Ω–∞", "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"]:
        await back_to_track_menu(message, state)
        return
    
    data = await state.get_data()
    product_id = data.get('edit_product_id')
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Ö–æ—á–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
    delete_texts = ["–£–¥–∞–ª–∏—Ç—å", "–ù–µ—Å—Ç –∫–∞—Ä–¥–∞–Ω"]
    new_description = None if message.text in delete_texts else message.text
    
    async for session in get_db():
        product_repo = ProductRepository(session)
        user_repo = UserRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
        updated_product = await product_repo.update_product(
            product_id,
            product_description=new_description
        )
        
        if updated_product:
            if new_description is None:
                texts = {
                    "ru": f"‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ <code>{updated_product.track_code}</code> —É–¥–∞–ª–µ–Ω–æ",
                    "tj": f"‚úÖ –¢–∞–≤—Å–∏—Ñ–∏ –º–∞“≥—Å—É–ª–æ—Ç <code>{updated_product.track_code}</code> –Ω–µ—Å—Ç –∫–∞—Ä–¥–∞ —à—É–¥"
                }
            else:
                texts = {
                    "ru": f"‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ <code>{updated_product.track_code}</code> —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–æ",
                    "tj": f"‚úÖ –¢–∞–≤—Å–∏—Ñ–∏ –º–∞“≥—Å—É–ª–æ—Ç <code>{updated_product.track_code}</code> –±–æ–º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç —Ç–∞“ì–π–∏—Ä –¥–æ–¥–∞ —à—É–¥"
                }
            await message.answer(texts[user.language], parse_mode="HTML")
        else:
            texts = {
                "ru": "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ–ø–∏—Å–∞–Ω–∏—è",
                "tj": "‚ùå –•–∞—Ç–æ –¥–∞—Ä —Ç–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ —Ç–∞–≤—Å–∏—Ñ"
            }
            await message.answer(texts[user.language])
    
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –º–µ–Ω—é —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤
    await back_to_track_menu(message, state)

# ========== –≠–ö–°–ü–û–†–¢ –í EXCEL ==========

# ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========

async def back_to_track_menu(message: Message, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –≤ –º–µ–Ω—é —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üì¶ <b>–¢—Ä–µ–∫-–∫–æ–¥—ã</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
            "tj": "üì¶ <b>–†–∞–º–∑“≥–æ–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω</b>\n\n–ê–º–∞–ª—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_track_codes_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.track_codes_menu)

def get_status_text(status: str, language: str = "ru") -> str:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ –Ω—É–∂–Ω–æ–º —è–∑—ã–∫–µ"""
    status_texts = {
        "ru": {
            "created": "–°–æ–∑–¥–∞–Ω",
            "china_warehouse": "–ù–∞ —Å–∫–ª–∞–¥–µ –≤ –ö–∏—Ç–∞–µ",
            "in_transit": "–í –ø—É—Ç–∏",
            "tajikistan_warehouse": "–ù–∞ —Å–∫–ª–∞–¥–µ –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–µ",
            "delivered": "–î–æ—Å—Ç–∞–≤–ª–µ–Ω",
            "completed": "–ó–∞–≤–µ—Ä—à–µ–Ω"
        },
        "tj": {
            "created": "–°–æ—Ö—Ç–∞ —à—É–¥–∞–∞—Å—Ç",
            "china_warehouse": "–î–∞—Ä –∞–Ω–±–æ—Ä–∏ –ß–∏–Ω",
            "in_transit": "–î–∞—Ä —Ä–æ“≥",
            "tajikistan_warehouse": "–î–∞—Ä –∞–Ω–±–æ—Ä–∏ –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω",
            "delivered": "–†–∞—Å–æ–Ω–∏–¥–∞ —à—É–¥",
            "completed": "–ê–Ω“∑–æ–º —ë—Ñ—Ç"
        }
    }
    
    return status_texts.get(language, status_texts["ru"]).get(status, status)

def get_category_name(category, language: str = "ru") -> str:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""
    if not category:
        return "–ù–µ —É–∫–∞–∑–∞–Ω–∞" if language == "ru" else "–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç"
    
    category_names = {
        "ru": {
            ProductCategory.ELECTRONICS: "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
            ProductCategory.CLOTHING: "–û–¥–µ–∂–¥–∞",
            ProductCategory.SHOES: "–û–±—É–≤—å",
            ProductCategory.HOME_APPLIANCES: "–ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞",
            ProductCategory.BEAUTY: "–ö–æ—Å–º–µ—Ç–∏–∫–∞",
            ProductCategory.TOYS: "–ò–≥—Ä—É—à–∫–∏",
            ProductCategory.AUTOMOTIVE: "–ê–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–∏",
            ProductCategory.SPORTS: "–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã",
            ProductCategory.OTHER: "–î—Ä—É–≥–æ–µ"
        },
        "tj": {
            ProductCategory.ELECTRONICS: "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
            ProductCategory.CLOTHING: "–õ–∏–±–æ—Å",
            ProductCategory.SHOES: "–ü–æ–π–∞—Ñ–∑–æ–ª",
            ProductCategory.HOME_APPLIANCES: "–ê—Å–±–æ–±“≥–æ–∏ —Ö–æ–Ω–∞–≥”£",
            ProductCategory.BEAUTY: "–ö–æ—Å–º–µ—Ç–∏–∫–∞",
            ProductCategory.TOYS: "–ë–æ–∑–∏—á–∞“≥–æ",
            ProductCategory.AUTOMOTIVE: "“ö–∏—Å–º“≥–æ–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª",
            ProductCategory.SPORTS: "–ê—à—ë“≥–æ–∏ –≤–∞—Ä–∑–∏—à”£",
            ProductCategory.OTHER: "–î–∏–≥–∞—Ä"
        }
    }
    
    return category_names[language].get(category, str(category))

# ========== INLINE CALLBACK –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ==========



@track_codes_router.callback_query(F.data.startswith("prev_page_"))
async def prev_page_callback(callback: CallbackQuery, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"""
    page_num = int(callback.data.split("_")[2])
    
    data = await state.get_data()
    products = data.get('user_products', [])
    total = data.get('products_total', 0)
    
    if products:
        page_size = 5
        start_idx = (page_num - 1) * page_size
        end_idx = min(start_idx + page_size, len(products))
        
        await state.update_data(products_page=page_num)
        await show_products_page(callback.message, state, products[start_idx:end_idx], page_num, total)
    
    await callback.answer()


@track_codes_router.callback_query(F.data.startswith("next_page_"))
async def next_page_callback(callback: CallbackQuery, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"""
    page_num = int(callback.data.split("_")[2])
    
    data = await state.get_data()
    products = data.get('user_products', [])
    total = data.get('products_total', 0)
    
    if products:
        page_size = 5
        start_idx = (page_num - 1) * page_size
        end_idx = min(start_idx + page_size, len(products))
        
        await state.update_data(products_page=page_num)
        await show_products_page(callback.message, state, products[start_idx:end_idx], page_num, total)
    
    await callback.answer()

@track_codes_router.callback_query(F.data.startswith("view_product_"))
async def view_product_callback(callback: CallbackQuery, state: FSMContext):
    """–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–≤–∞—Ä–µ"""
    product_id = int(callback.data.split("_")[2])
    
    async for session in get_db():
        product_repo = ProductRepository(session)
        user_repo = UserRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(callback.from_user.id)
        # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä –ø–æ ID (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
        result = await session.execute(
            select(Product).where(Product.id == product_id)
        )
        product = result.scalar_one_or_none()
        
        if not product:
            await callback.answer("–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ª–∏ —Ç–æ–≤–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        if product.user_id != user.id:
            await callback.answer("–≠—Ç–æ—Ç —Ç–æ–≤–∞—Ä –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –≤–∞–º")
            return
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        status_text = get_status_text(product.status.value, user.language)
        category_name = get_category_name(product.product_category, user.language)
        
        # –û—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
        special_props = []
        if product.fragile:
            special_props.append("–•—Ä—É–ø–∫–∏–π" if user.language == "ru" else "–ù–æ–∑—É–∫")
        if product.has_battery:
            special_props.append("–° –±–∞—Ç–∞—Ä–µ–µ–π" if user.language == "ru" else "–ë–æ –±–∞—Ç–∞—Ä–µ—è")
        if product.is_liquid:
            special_props.append("–ñ–∏–¥–∫–æ—Å—Ç—å" if user.language == "ru" else "–ú–æ–µ—ä")
        special_text = ", ".join(special_props) if special_props else ("–ù–µ—Ç" if user.language == "ru" else "–ù–µ")
        
        text = {
            "ru": f"""üì¶ <b>–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ</b>

üéØ <b>–¢—Ä–µ–∫-–∫–æ–¥:</b> <code>{product.track_code}</code>
üè∑Ô∏è <b>–ù–∞–∑–≤–∞–Ω–∏–µ:</b> {product.product_name or '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
üìÇ <b>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</b> {category_name}
üìù <b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> {product.product_description or '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
üìç <b>–°—Ç–∞—Ç—É—Å:</b> {status_text}

üî¢ <b>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</b> {product.quantity or 1} —à—Ç.
üí∞ <b>–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É:</b> ${product.unit_price_usd:.2f}
üíµ <b>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</b> ${product.total_value_usd:.2f}
‚öñÔ∏è <b>–í–µ—Å:</b> {product.weight_kg:.2f} –∫–≥
‚ö†Ô∏è <b>–û—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞:</b> {special_text}

üìÖ <b>–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:</b> {product.created_at.strftime('%d.%m.%Y %H:%M')}
üÜî <b>ID —Ç–æ–≤–∞—Ä–∞:</b> {product.id}""",
            "tj": f"""üì¶ <b>–ú–∞—ä–ª—É–º–æ—Ç–∏ —Ç–∞—Ñ—Å–∏–ª–æ—Ç”£ –æ–∏–¥ –±–∞ –º–∞“≥—Å—É–ª–æ—Ç</b>

üéØ <b>–†–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω:</b> <code>{product.track_code}</code>
üè∑Ô∏è <b>–ù–æ–º:</b> {product.product_name or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üìÇ <b>–ì—É—Ä”Ø“≥:</b> {category_name}
üìù <b>–¢–∞–≤—Å–∏—Ñ:</b> {product.product_description or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üìç <b>–°—Ç–∞—Ç—É—Å:</b> {status_text}

üî¢ <b>–ú–∏“õ–¥–æ—Ä:</b> {product.quantity or 1} –¥–æ–Ω–∞
üí∞ <b>–ù–∞—Ä—Ö –±–∞—Ä–æ–∏ —è–∫ –≤–æ“≥–∏–¥:</b> ${product.unit_price_usd:.2f}
üíµ <b>–ê—Ä–∑–∏—à–∏ —É–º—É–º”£:</b> ${product.total_value_usd:.2f}
‚öñÔ∏è <b>–í–∞–∑–Ω:</b> {product.weight_kg:.2f} –∫–≥
‚ö†Ô∏è <b>–•—É—Å—É—Å–∏—è—Ç“≥–æ–∏ –º–∞—Ö—Å—É—Å:</b> {special_text}

üìÖ <b>–°–∞–Ω–∏–∏ –∏–ª–æ–≤–∞:</b> {product.created_at.strftime('%d.%m.%Y %H:%M')}
üÜî <b>ID –º–∞“≥—Å—É–ª–æ—Ç:</b> {product.id}"""
        }[user.language]
        
        keyboard = InlineKeyboardBuilder()
        keyboard.add(InlineKeyboardButton(
            text="üîô –ù–∞–∑–∞–¥" if user.language == "ru" else "üîô –ë–æ–∑–≥–∞—à—Ç",
            callback_data="back_to_products"
        ))
        
        # –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å (—Å—Ç–∞—Ç—É—Å "–°–æ–∑–¥–∞–Ω" –∏–ª–∏ "–ù–∞ —Å–∫–ª–∞–¥–µ –≤ –ö–∏—Ç–∞–µ")
        if product.status in [ProductStatus.CREATED, ProductStatus.CHINA_WAREHOUSE]:
            keyboard.add(InlineKeyboardButton(
                text="‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" if user.language == "ru" else "‚úèÔ∏è –¢–∞“≥—Ä–∏—Ä –∫–∞—Ä–¥–∞–Ω",
                callback_data=f"edit_product_{product.id}"
            ))
        
        await callback.message.edit_text(
            text,
            reply_markup=keyboard.as_markup(),
            parse_mode="HTML"
        )
    
    await callback.answer()

@track_codes_router.message(ClientState.edit_product)
async def edit_product_menu(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    if message.text in ["üîô –ù–∞–∑–∞–¥", "üîô –ë–æ–∑–≥–∞—à—Ç", "‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await back_to_track_menu(message, state)
        return
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —á—Ç–æ —Ö–æ—á–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        edit_options = {
            "ru": {
                "üìù –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ": "name",
                "üìù –ò–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ": "description",
                "üî¢ –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ": "quantity",
                "üí∞ –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É": "price",
                "‚öñÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –≤–µ—Å": "weight",
                "üè∑Ô∏è –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é": "category"
            },
            "tj": {
                "üìù –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –Ω–æ–º": "name",
                "üìù –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ —Ç–∞–≤—Å–∏—Ñ": "description",
                "üî¢ –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –º–∏“õ–¥–æ—Ä": "quantity",
                "üí∞ –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –Ω–∞—Ä—Ö": "price",
                "‚öñÔ∏è –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –≤–∞–∑–Ω": "weight",
                "üè∑Ô∏è –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –≥—É—Ä”Ø“≥": "category"
            }
        }
        
        action = edit_options[user.language].get(message.text)
        
        if not action:
            await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ –º–µ–Ω—é" if user.language == "ru" else "–õ—É—Ç—Ñ–∞–Ω, –∞–º–∞–ª—Ä–æ –∞–∑ –º–µ–Ω—é –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥")
            return
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        if action == "name":
            texts = {
                "ru": "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:",
                "tj": "–ù–æ–º–∏ –Ω–∞–≤–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:"
            }
            await state.set_state(ClientState.edit_product_name)
            
        elif action == "description":
            texts = {
                "ru": "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:",
                "tj": "–¢–∞–≤—Å–∏—Ñ–∏ –Ω–∞–≤–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:"
            }
            await state.set_state(ClientState.edit_product_description)
            
        elif action == "quantity":
            texts = {
                "ru": "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞:",
                "tj": "–ú–∏“õ–¥–æ—Ä–∏ –Ω–∞–≤–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:"
            }
            await state.set_state(ClientState.edit_product_quantity)
            
        elif action == "price":
            texts = {
                "ru": "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é —Ü–µ–Ω—É –∑–∞ –µ–¥–∏–Ω–∏—Ü—É (–≤ USD):",
                "tj": "–ù–∞—Ä—Ö–∏ –Ω–∞–≤–∏ –±–∞—Ä–æ–∏ —è–∫ –≤–æ“≥–∏–¥—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä USD):"
            }
            await state.set_state(ClientState.edit_product_price)
            
        elif action == "weight":
            texts = {
                "ru": "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –≤–µ—Å —Ç–æ–≤–∞—Ä–∞ (–≤ –∫–≥):",
                "tj": "–í–∞–∑–Ω–∏ –Ω–∞–≤–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä –∫–≥):"
            }
            await state.set_state(ClientState.edit_product_weight)
            
        elif action == "category":
            texts = {
                "ru": "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞:",
                "tj": "–ì—É—Ä”Ø“≥–∏ –Ω–∞–≤–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"
            }
            await message.answer(
                texts[user.language],
                reply_markup=get_product_categories_keyboard(user.language)
            )
            await state.set_state(ClientState.edit_product_category)
            return
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language)
        )

@track_codes_router.callback_query(F.data == "back_to_products")
async def back_to_products_callback(callback: CallbackQuery, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É —Ç–æ–≤–∞—Ä–æ–≤"""
    data = await state.get_data()
    products = data.get('user_products', [])
    page = data.get('products_page', 1)
    total = data.get('products_total', 0)
    
    if products:
        page_size = 5
        start_idx = (page - 1) * page_size
        end_idx = min(start_idx + page_size, len(products))
        
        await show_products_page(callback.message, state, products[start_idx:end_idx], page, total)
    
    await callback.answer()

@track_codes_router.callback_query(F.data == "back_to_track_menu")
async def back_to_track_menu_callback(callback: CallbackQuery, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –≤ –º–µ–Ω—é —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤ —á–µ—Ä–µ–∑ callback"""
    await back_to_track_menu(callback.message, state)
    await callback.answer()
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\utils.py =====
"""
–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
"""
from aiogram import Router
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

router = Router()

@router.message()
async def debug_handler(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (–ª–æ–≤–∏—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è)"""
    current_state = await state.get_state()
    print(f"DEBUG: –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: '{message.text}'")
    print(f"DEBUG: –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: {current_state}")
    print(f"DEBUG: User ID: {message.from_user.id}")
    print(f"DEBUG: –ü–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç message: {message}")
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    from handlers.common import get_welcome_text
    from database.session import get_db
    from database.repository import UserRepository
    from keyboards.client import get_main_menu_keyboard
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if user:
            await message.answer(
                f"–û—Ç–ª–∞–¥–∫–∞: –≤—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ '{message.text}'\n"
                f"–°–æ—Å—Ç–æ—è–Ω–∏–µ: {current_state}\n"
                f"–í–∞—à —è–∑—ã–∫: {user.language}\n\n"
                f"–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:",
                reply_markup=get_main_menu_keyboard(user.language)
            )
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\products\add_product.py =====
"""
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ (8 —à–∞–≥–æ–≤)
"""
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository, ProductRepository
from database.models import ProductCategory
from keyboards.client import get_back_cancel_keyboard
from keyboards.products import get_product_categories_keyboard, get_special_info_keyboard
from utils.states import ClientState
from .utils import track_codes_menu_back, get_status_text

logger = logging.getLogger(__name__)
router = Router()

# ========== –î–û–ë–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê –° –ò–ù–§–û–†–ú–ê–¶–ò–ï–ô ==========

@router.message(ClientState.track_codes_menu, F.text.contains("–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫-–∫–æ–¥"))
@router.message(ClientState.track_codes_menu, F.text.contains("–ò–ª–æ–≤–∞ –∫–∞—Ä–¥–∞–Ω–∏ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω"))
async def add_track_code_start(message: Message, state: FSMContext):
    """–ù–∞—á–∞–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫-–∫–æ–¥–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üì¶ <b>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫-–∫–æ–¥ —Ç–æ–≤–∞—Ä–∞:",
            "tj": "üì¶ <b>–ò–ª–æ–≤–∞ –∫–∞—Ä–¥–∞–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç–∏ –Ω–∞–≤</b>\n\n"
                  "–†–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.add_track_code)
# –í —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª –¥–æ–±–∞–≤–ª—è–µ–º:

@router.message(ClientState.product_special_info)
async def process_product_special_info(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –æ—Å–æ–±—ã—Ö —Å–≤–æ–π—Å—Ç–≤ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await product_dimensions_back(message, state)
        return
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç—Ä–µ–∫-–∫–æ–¥–∞
        from services.track_code import TrackCodeGenerator
        data = await state.get_data()
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–∫-–∫–æ–¥–∞
        category = data.get('product_category')
        if category:
            category_str = category.value
        else:
            category_str = "other"
        
        track_code = TrackCodeGenerator.generate_track_code(
            user_id=message.from_user.id,
            product_type=category_str
        )
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—Ä–µ–∫-–∫–æ–¥
        await state.update_data(track_code=track_code)
        
        # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞...
        
@router.message(ClientState.add_track_code)
async def process_track_code(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ —Ç—Ä–µ–∫-–∫–æ–¥–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–±–æ—Ä—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await track_codes_menu_back(message, state)
        return
    
    async for session in get_db():
        user_repo = UserRepository(session)
        product_repo = ProductRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π —Ç—Ä–µ–∫-–∫–æ–¥
        existing_product = await product_repo.get_product_by_track_code(message.text)
        
        if existing_product:
            texts = {
                "ru": "‚ùå –≠—Ç–æ—Ç —Ç—Ä–µ–∫-–∫–æ–¥ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–µ",
                "tj": "‚ùå –ò–Ω —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω –∞–ª–ª–∞–∫–∞–π –¥–∞—Ä —Å–∏—Å—Ç–µ–º–∞ –º–∞–≤“∑—É–¥ –∞—Å—Ç"
            }
            await message.answer(texts[user.language])
            return
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—Ä–µ–∫-–∫–æ–¥
        await state.update_data(track_code=message.text)
        
        texts = {
            "ru": "‚úèÔ∏è <b>–®–∞–≥ 1 –∏–∑ 8: –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:\n"
                  "<i>–ü—Ä–∏–º–µ—Ä: –°–º–∞—Ä—Ç—Ñ–æ–Ω iPhone 15 Pro</i>",
            "tj": "‚úèÔ∏è <b>“ö–∞–¥–∞–º–∏ 1 –∞–∑ 8: –ù–æ–º–∏ –º–∞“≥—Å—É–ª–æ—Ç</b>\n\n"
                  "–ù–æ–º–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:\n"
                  "<i>–ù–∞–º—É–Ω–∞: –°–º–∞—Ä—Ç—Ñ–æ–Ω–∏ iPhone 15 Pro</i>"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_name)

@router.message(ClientState.product_name)
async def process_product_name(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        # –í–æ–∑–≤—Ä–∞—Ç –∫ –≤–≤–æ–¥—É —Ç—Ä–µ–∫-–∫–æ–¥–∞
        await add_track_code_back(message, state)
        return
    
    await state.update_data(product_name=message.text)
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üè∑Ô∏è <b>–®–∞–≥ 2 –∏–∑ 8: –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                  "–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞:",
            "tj": "üè∑Ô∏è <b>“ö–∞–¥–∞–º–∏ 2 –∞–∑ 8: –ì—É—Ä”Ø“≥–∏ –º–∞“≥—Å—É–ª–æ—Ç</b>\n\n"
                  "–ì—É—Ä”Ø“≥–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_product_categories_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_category)

@router.message(ClientState.product_category)
async def process_product_category(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await product_name_back(message, state)
        return
    
    # –ú–∞–ø–ø–∏–Ω–≥ –Ω–∞–∑–≤–∞–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è enum
    category_map = {
        "ru": {
            "üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞": ProductCategory.ELECTRONICS,
            "üëï –û–¥–µ–∂–¥–∞": ProductCategory.CLOTHING,
            "üëü –û–±—É–≤—å": ProductCategory.SHOES,
            "üè† –ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞": ProductCategory.HOME_APPLIANCES,
            "üíÑ –ö–æ—Å–º–µ—Ç–∏–∫–∞": ProductCategory.BEAUTY,
            "üß∏ –ò–≥—Ä—É—à–∫–∏": ProductCategory.TOYS,
            "üöó –ê–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–∏": ProductCategory.AUTOMOTIVE,
            "‚öΩ –°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã": ProductCategory.SPORTS,
            "üì¶ –î—Ä—É–≥–æ–µ": ProductCategory.OTHER
        },
        "tj": {
            "üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞": ProductCategory.ELECTRONICS,
            "üëï –õ–∏–±–æ—Å": ProductCategory.CLOTHING,
            "üëü –ü–æ–π–∞—Ñ–∑–æ–ª": ProductCategory.SHOES,
            "üè† –ê—Å–±–æ–±“≥–æ–∏ —Ö–æ–Ω–∞–≥”£": ProductCategory.HOME_APPLIANCES,
            "üíÑ –ö–æ—Å–º–µ—Ç–∏–∫–∞": ProductCategory.BEAUTY,
            "üß∏ –ë–æ–∑–∏—á–∞“≥–æ": ProductCategory.TOYS,
            "üöó “ö–∏—Å–º“≥–æ–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª": ProductCategory.AUTOMOTIVE,
            "‚öΩ –ê—à—ë“≥–æ–∏ –≤–∞—Ä–∑–∏—à”£": ProductCategory.SPORTS,
            "üì¶ –î–∏–≥–∞—Ä": ProductCategory.OTHER
        }
    }
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        selected_category = category_map[user.language].get(message.text)
        if not selected_category:
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ —Å–ø–∏—Å–∫–∞",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, –≥—É—Ä”Ø“≥—Ä–æ –∞–∑ —Ä”Ø–π—Ö–∞—Ç –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥"
            }
            await message.answer(texts[user.language])
            return
        
        await state.update_data(product_category=selected_category)
        
        texts = {
            "ru": "üìù <b>–®–∞–≥ 3 –∏–∑ 8: –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                  "–û–ø–∏—à–∏—Ç–µ —Ç–æ–≤–∞—Ä (—Ü–≤–µ—Ç, —Ä–∞–∑–º–µ—Ä, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏):\n"
                  "<i>–ü—Ä–∏–º–µ—Ä: –ß–µ—Ä–Ω—ã–π, 256 –ì–ë, —á–µ—Ö–æ–ª –≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ</i>\n\n"
                  "–ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å', –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ",
            "tj": "üìù <b>“ö–∞–¥–∞–º–∏ 3 –∞–∑ 8: –¢–∞–≤—Å–∏—Ñ–∏ –º–∞“≥—Å—É–ª–æ—Ç</b>\n\n"
                  "–ú–∞“≥—Å—É–ª–æ—Ç—Ä–æ —Ç–∞–≤—Å–∏—Ñ –∫—É–Ω–µ–¥ (—Ä–∞–Ω–≥, –∞–Ω–¥–æ–∑–∞, —Ö—É—Å—É—Å–∏—è—Ç“≥–æ):\n"
                  "<i>–ù–∞–º—É–Ω–∞: –°–∏—ë“≥, 256 –ì–ë, “∑–∏–ª–¥ –¥–∞—Ä –∫–æ–º–ø–ª–µ–∫—Ç</i>\n\n"
                  "–Å '–ì—É–∑–∞—Ä–æ–Ω' –Ω–∞–≤–∏—Å–µ–¥, –∞–≥–∞—Ä —Ç–∞–≤—Å–∏—Ñ –∏–ª–æ–≤–∞ –∫–∞—Ä–¥–∞–Ω –Ω–∞–º–µ—Ö–æ“≥–µ–¥"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_description)

@router.message(ClientState.product_description)
async def process_product_description(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await product_category_back(message, state)
        return
    
    skip_texts = ["–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å", "–ì—É–∑–∞—Ä–æ–Ω"]
    description = None if message.text in skip_texts else message.text
    await state.update_data(product_description=description)
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üî¢ <b>–®–∞–≥ 4 –∏–∑ 8: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</b>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü —Ç–æ–≤–∞—Ä–∞:\n"
                  "<i>–ü—Ä–∏–º–µ—Ä: 1 –∏–ª–∏ 10</i>",
            "tj": "üî¢ <b>“ö–∞–¥–∞–º–∏ 4 –∞–∑ 8: –ú–∏“õ–¥–æ—Ä</b>\n\n"
                  "–ú–∏“õ–¥–æ—Ä–∏ –≤–æ“≥–∏–¥“≥–æ–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:\n"
                  "<i>–ù–∞–º—É–Ω–∞: 1 —ë 10</i>"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_quantity)

@router.message(ClientState.product_quantity)
async def process_product_quantity(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await product_description_back(message, state)
        return
    
    try:
        quantity = int(message.text)
        if quantity <= 0:
            raise ValueError
        
        await state.update_data(quantity=quantity)
        
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "üí∞ <b>–®–∞–≥ 5 –∏–∑ 8: –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É</b>\n\n"
                      "–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –∑–∞ –æ–¥–Ω—É –µ–¥–∏–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ (–≤ USD):\n"
                      "<i>–ü—Ä–∏–º–µ—Ä: 199.99</i>",
                "tj": "üí∞ <b>“ö–∞–¥–∞–º–∏ 5 –∞–∑ 8: –ù–∞—Ä—Ö –±–∞—Ä–æ–∏ —è–∫ –≤–æ“≥–∏–¥</b>\n\n"
                      "–ù–∞—Ä—Ö–∏ —è–∫ –≤–æ“≥–∏–¥–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä USD):\n"
                      "<i>–ù–∞–º—É–Ω–∞: 199.99</i>"
            }
            
            await message.answer(
                texts[user.language],
                reply_markup=get_back_cancel_keyboard(user.language),
                parse_mode="HTML"
            )
            await state.set_state(ClientState.product_unit_price)
            
    except ValueError:
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–æ–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1, 5, 10)",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, —Ä–∞“õ–∞–º–∏ –±—É—Ç—É–Ω–∏ –º—É—Å–±–∞—Ç –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–º–∞—Å–∞–ª–∞–Ω: 1, 5, 10)"
            }
            await message.answer(texts[user.language])

@router.message(ClientState.product_unit_price)
async def process_product_unit_price(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ —Ü–µ–Ω—ã –∑–∞ –µ–¥–∏–Ω–∏—Ü—É"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await product_quantity_back(message, state)
        return
    
    try:
        cleaned_text = message.text.replace(",", ".")
        unit_price = float(cleaned_text)
        
        if unit_price < 0:
            raise ValueError
        
        await state.update_data(unit_price=unit_price)
        
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚öñÔ∏è <b>–®–∞–≥ 6 –∏–∑ 8: –í–µ—Å —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                      "–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –æ–¥–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ (–≤ –∫–≥):\n"
                      "<i>–ü—Ä–∏–º–µ—Ä: 0.5 –∏–ª–∏ 2.3</i>",
                "tj": "‚öñÔ∏è <b>“ö–∞–¥–∞–º–∏ 6 –∞–∑ 8: –í–∞–∑–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç</b>\n\n"
                      "–í–∞–∑–Ω–∏ —è–∫ –≤–æ“≥–∏–¥–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä –∫–≥):\n"
                      "<i>–ù–∞–º—É–Ω–∞: 0.5 —ë 2.3</i>"
            }
            
            await message.answer(
                texts[user.language],
                reply_markup=get_back_cancel_keyboard(user.language),
                parse_mode="HTML"
            )
            await state.set_state(ClientState.product_weight)
            
    except ValueError:
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 50, 99.99, 150.50)",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, —Ä–∞“õ–∞–º –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–º–∞—Å–∞–ª–∞–Ω: 50, 99.99, 150.50)"
            }
            await message.answer(texts[user.language])

@router.message(ClientState.product_weight)
async def process_product_weight(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –≤–µ—Å–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await product_unit_price_back(message, state)
        return
    
    try:
        cleaned_text = message.text.replace(",", ".")
        weight = float(cleaned_text)
        
        if weight <= 0:
            raise ValueError
        
        await state.update_data(weight=weight)
        
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "üìè <b>–®–∞–≥ 7 –∏–∑ 8: –ì–∞–±–∞—Ä–∏—Ç—ã —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                      "–í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã –æ–¥–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã (–¥–ª–∏–Ω–∞√ó—à–∏—Ä–∏–Ω–∞√ó–≤—ã—Å–æ—Ç–∞ –≤ —Å–º):\n"
                      "<i>–ü—Ä–∏–º–µ—Ä: 15√ó8√ó3 –∏–ª–∏ 20 10 5</i>\n\n"
                      "–ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å'",
                "tj": "üìè <b>“ö–∞–¥–∞–º–∏ 7 –∞–∑ 8: –ê–Ω–¥–æ–∑–∞“≥–æ–∏ –º–∞“≥—Å—É–ª–æ—Ç</b>\n\n"
                      "–ê–Ω–¥–æ–∑–∞“≥–æ–∏ —è–∫ –≤–æ“≥–∏–¥—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä–æ–∑”£√ó–±–∞—Ä–∞–Ω–¥–æ–∑”£√ó–±–∞–ª–∞–Ω–¥”£ –¥–∞—Ä —Å–º):\n"
                      "<i>–ù–∞–º—É–Ω–∞: 15√ó8√ó3 —ë 20 10 5</i>\n\n"
                      "–Å '–ì—É–∑–∞—Ä–æ–Ω' –Ω–∞–≤–∏—Å–µ–¥"
            }
            
            await message.answer(
                texts[user.language],
                reply_markup=get_back_cancel_keyboard(user.language),
                parse_mode="HTML"
            )
            await state.set_state(ClientState.product_dimensions)
            
    except ValueError:
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 0.5, 1.2, 3.0)",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, —Ä–∞“õ–∞–º–∏ –º—É—Å–±–∞—Ç –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–º–∞—Å–∞–ª–∞–Ω: 0.5, 1.2, 3.0)"
            }
            await message.answer(texts[user.language])

@router.message(ClientState.product_dimensions)
async def process_product_dimensions(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –≥–∞–±–∞—Ä–∏—Ç–æ–≤"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await product_weight_back(message, state)
        return
    
    skip_texts = ["–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å", "–ì—É–∑–∞—Ä–æ–Ω"]
    if message.text in skip_texts:
        await state.update_data(length=None, width=None, height=None)
    else:
        try:
            # –ü–∞—Ä—Å–∏–º —Ä–∞–∑–º–µ—Ä—ã: 15√ó8√ó3 –∏–ª–∏ 15x8x3 –∏–ª–∏ 15 8 3
            text = message.text.replace('√ó', 'x').replace('—Ö', 'x').replace('–•', 'x')
            parts = text.replace('x', ' ').split()
            
            if len(parts) == 3:
                length = float(parts[0])
                width = float(parts[1])
                height = float(parts[2])
                
                if length <= 0 or width <= 0 or height <= 0:
                    raise ValueError
                
                await state.update_data(length=length, width=width, height=height)
            else:
                raise ValueError
                
        except (ValueError, IndexError):
            async for session in get_db():
                user_repo = UserRepository(session)
                user = await user_repo.get_user_by_telegram_id(message.from_user.id)
                
                texts = {
                    "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ: –¥–ª–∏–Ω–∞√ó—à–∏—Ä–∏–Ω–∞√ó–≤—ã—Å–æ—Ç–∞\n"
                          "<i>–ü—Ä–∏–º–µ—Ä: 15√ó8√ó3 –∏–ª–∏ 20 10 5</i>",
                    "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, –∞–Ω–¥–æ–∑–∞“≥–æ—Ä–æ –¥–∞—Ä —Ñ–æ—Ä–º–∞—Ç–∏: –¥–∞—Ä–æ–∑”£√ó–±–∞—Ä–∞–Ω–¥–æ–∑”£√ó–±–∞–ª–∞–Ω–¥”£ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥\n"
                          "<i>–ù–∞–º—É–Ω–∞: 15√ó8√ó3 —ë 20 10 5</i>"
                }
                await message.answer(texts[user.language], parse_mode="HTML")
                return
    
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "‚ö†Ô∏è <b>–®–∞–≥ 8 –∏–∑ 8: –û—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞</b>\n\n"
                  "–í—ã–±–µ—Ä–∏—Ç–µ –æ—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞:",
            "tj": "‚ö†Ô∏è <b>“ö–∞–¥–∞–º–∏ 8 –∞–∑ 8: –•—É—Å—É—Å–∏—è—Ç“≥–æ–∏ –º–∞—Ö—Å—É—Å</b>\n\n"
                  "–•—É—Å—É—Å–∏—è—Ç“≥–æ–∏ –º–∞—Ö—Å—É—Å–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_special_info_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_special_info)

@router.message(ClientState.product_special_info)
async def process_product_special_info(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –æ—Å–æ–±—ã—Ö —Å–≤–æ–π—Å—Ç–≤ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await product_dimensions_back(message, state)
        return
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        property_texts = {
            "ru": {
                "–•—Ä—É–ø–∫–∏–π": "fragile",
                "–° –±–∞—Ç–∞—Ä–µ–µ–π": "battery",
                "–ñ–∏–¥–∫–æ—Å—Ç—å": "liquid",
                "–ù–µ—Ç –æ—Å–æ–±—ã—Ö —Å–≤–æ–π—Å—Ç–≤": "none"
            },
            "tj": {
                "–ù–æ–∑—É–∫": "fragile",
                "–ë–æ –±–∞—Ç–∞—Ä–µ—è": "battery",
                "–ú–æ–µ—ä": "liquid",
                "–•—É—Å—É—Å–∏—è—Ç–∏ –º–∞—Ö—Å—É—Å –Ω–µ—Å—Ç": "none"
            }
        }
        
        selected_property = property_texts[user.language].get(message.text)
        if not selected_property:
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, –≤–∞—Ä–∏–∞–Ω—Ç—Ä–æ –∞–∑ —Ä”Ø–π—Ö–∞—Ç –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥"
            }
            await message.answer(texts[user.language])
            return
        
        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        data = await state.get_data()
        track_code = data.get('track_code')
        product_name = data.get('product_name')
        product_category = data.get('product_category')
        product_description = data.get('product_description')
        quantity = data.get('quantity', 1)
        unit_price = data.get('unit_price', 0.0)
        weight = data.get('weight', 0.0)
        length = data.get('length')
        width = data.get('width')
        height = data.get('height')
        
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
        total_value = unit_price * quantity
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞
        fragile = selected_property == "fragile"
        has_battery = selected_property == "battery"
        is_liquid = selected_property == "liquid"
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–≤–∞—Ä –≤ –ë–î
        product_repo = ProductRepository(session)
        
        try:
            product = await product_repo.create_product(
                track_code=track_code,
                user_id=user.id,
                product_name=product_name,
                product_category=product_category.value,
                product_description=product_description,
                quantity=quantity,
                unit_price_usd=unit_price,
                total_value_usd=total_value,
                weight_kg=weight,
                length_cm=length,
                width_cm=width,
                height_cm=height,
                fragile=fragile,
                has_battery=has_battery,
                is_liquid=is_liquid
            )
            
            from .utils import show_product_success_message
            await show_product_success_message(
                message=message,
                state=state,
                product=product,
                user=user,
                track_code=track_code,
                product_name=product_name,
                product_category=product_category,
                quantity=quantity,
                unit_price=unit_price,
                total_value=total_value,
                weight=weight,
                length=length,
                width=width,
                height=height,
                fragile=fragile,
                has_battery=has_battery,
                is_liquid=is_liquid,
                product_description=product_description
            )
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞: {e}")
            texts = {
                "ru": "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.",
                "tj": "‚ùå –î–∞—Ä –∑–∞—Ö–∏—Ä–∞ –∫–∞—Ä–¥–∞–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç —Ö–∞—Ç–æ —Ä—É—Ö –¥–æ–¥. –õ—É—Ç—Ñ–∞–Ω, –±–æ—Ä–∏ –¥–∏–≥–∞—Ä –∫”Ø—à–∏—à –∫—É–Ω–µ–¥."
            }
            from keyboards.client import get_track_codes_keyboard
            await message.answer(
                texts[user.language],
                reply_markup=get_track_codes_keyboard(user.language)
            )
            await state.set_state(ClientState.track_codes_menu)

# ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –í–û–ó–í–†–ê–¢–ê ==========

async def add_track_code_back(message: Message, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ –≤–≤–æ–¥—É —Ç—Ä–µ–∫-–∫–æ–¥–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üì¶ <b>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫-–∫–æ–¥ —Ç–æ–≤–∞—Ä–∞:",
            "tj": "üì¶ <b>–ò–ª–æ–≤–∞ –∫–∞—Ä–¥–∞–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç–∏ –Ω–∞–≤</b>\n\n"
                  "–†–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.add_track_code)

async def product_name_back(message: Message, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ –≤–≤–æ–¥—É –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "‚úèÔ∏è <b>–®–∞–≥ 1 –∏–∑ 8: –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:\n"
                  "<i>–ü—Ä–∏–º–µ—Ä: –°–º–∞—Ä—Ç—Ñ–æ–Ω iPhone 15 Pro</i>",
            "tj": "‚úèÔ∏è <b>“ö–∞–¥–∞–º–∏ 1 –∞–∑ 8: –ù–æ–º–∏ –º–∞“≥—Å—É–ª–æ—Ç</b>\n\n"
                  "–ù–æ–º–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:\n"
                  "<i>–ù–∞–º—É–Ω–∞: –°–º–∞—Ä—Ç—Ñ–æ–Ω–∏ iPhone 15 Pro</i>"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_name)

async def product_category_back(message: Message, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ –≤—ã–±–æ—Ä—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üè∑Ô∏è <b>–®–∞–≥ 2 –∏–∑ 8: –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                  "–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞:",
            "tj": "üè∑Ô∏è <b>“ö–∞–¥–∞–º–∏ 2 –∞–∑ 8: –ì—É—Ä”Ø“≥–∏ –º–∞“≥—Å—É–ª–æ—Ç</b>\n\n"
                  "–ì—É—Ä”Ø“≥–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_product_categories_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_category)

async def product_description_back(message: Message, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ –≤–≤–æ–¥—É –æ–ø–∏—Å–∞–Ω–∏—è"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üìù <b>–®–∞–≥ 3 –∏–∑ 8: –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                  "–û–ø–∏—à–∏—Ç–µ —Ç–æ–≤–∞—Ä (—Ü–≤–µ—Ç, —Ä–∞–∑–º–µ—Ä, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏):\n"
                  "<i>–ü—Ä–∏–º–µ—Ä: –ß–µ—Ä–Ω—ã–π, 256 –ì–ë, —á–µ—Ö–æ–ª –≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ</i>\n\n"
                  "–ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å', –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ",
            "tj": "üìù <b>“ö–∞–¥–∞–º–∏ 3 –∞–∑ 8: –¢–∞–≤—Å–∏—Ñ–∏ –º–∞“≥—Å—É–ª–æ—Ç</b>\n\n"
                  "–ú–∞“≥—Å—É–ª–æ—Ç—Ä–æ —Ç–∞–≤—Å–∏—Ñ –∫—É–Ω–µ–¥ (—Ä–∞–Ω–≥, –∞–Ω–¥–æ–∑–∞, —Ö—É—Å—É—Å–∏—è—Ç“≥–æ):\n"
                  "<i>–ù–∞–º—É–Ω–∞: –°–∏—ë“≥, 256 –ì–ë, “∑–∏–ª–¥ –¥–∞—Ä –∫–æ–º–ø–ª–µ–∫—Ç</i>\n\n"
                  "–Å '–ì—É–∑–∞—Ä–æ–Ω' –Ω–∞–≤–∏—Å–µ–¥, –∞–≥–∞—Ä —Ç–∞–≤—Å–∏—Ñ –∏–ª–æ–≤–∞ –∫–∞—Ä–¥–∞–Ω –Ω–∞–º–µ—Ö–æ“≥–µ–¥"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_description)

async def product_quantity_back(message: Message, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ –≤–≤–æ–¥—É –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üî¢ <b>–®–∞–≥ 4 –∏–∑ 8: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</b>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü —Ç–æ–≤–∞—Ä–∞:\n"
                  "<i>–ü—Ä–∏–º–µ—Ä: 1 –∏–ª–∏ 10</i>",
            "tj": "üî¢ <b>“ö–∞–¥–∞–º–∏ 4 –∞–∑ 8: –ú–∏“õ–¥–æ—Ä</b>\n\n"
                  "–ú–∏“õ–¥–æ—Ä–∏ –≤–æ“≥–∏–¥“≥–æ–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:\n"
                  "<i>–ù–∞–º—É–Ω–∞: 1 —ë 10</i>"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_quantity)

async def product_unit_price_back(message: Message, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ –≤–≤–æ–¥—É —Ü–µ–Ω—ã –∑–∞ –µ–¥–∏–Ω–∏—Ü—É"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üí∞ <b>–®–∞–≥ 5 –∏–∑ 8: –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É</b>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –∑–∞ –æ–¥–Ω—É –µ–¥–∏–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ (–≤ USD):\n"
                  "<i>–ü—Ä–∏–º–µ—Ä: 199.99</i>",
            "tj": "üí∞ <b>“ö–∞–¥–∞–º–∏ 5 –∞–∑ 8: –ù–∞—Ä—Ö –±–∞—Ä–æ–∏ —è–∫ –≤–æ“≥–∏–¥</b>\n\n"
                  "–ù–∞—Ä—Ö–∏ —è–∫ –≤–æ“≥–∏–¥–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä USD):\n"
                  "<i>–ù–∞–º—É–Ω–∞: 199.99</i>"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_unit_price)

async def product_weight_back(message: Message, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ –≤–≤–æ–¥—É –≤–µ—Å–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "‚öñÔ∏è <b>–®–∞–≥ 6 –∏–∑ 8: –í–µ—Å —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –æ–¥–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ (–≤ –∫–≥):\n"
                  "<i>–ü—Ä–∏–º–µ—Ä: 0.5 –∏–ª–∏ 2.3</i>",
            "tj": "‚öñÔ∏è <b>“ö–∞–¥–∞–º–∏ 6 –∞–∑ 8: –í–∞–∑–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç</b>\n\n"
                  "–í–∞–∑–Ω–∏ —è–∫ –≤–æ“≥–∏–¥–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä –∫–≥):\n"
                  "<i>–ù–∞–º—É–Ω–∞: 0.5 —ë 2.3</i>"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_weight)

async def product_dimensions_back(message: Message, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ –≤–≤–æ–¥—É –≥–∞–±–∞—Ä–∏—Ç–æ–≤"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üìè <b>–®–∞–≥ 7 –∏–∑ 8: –ì–∞–±–∞—Ä–∏—Ç—ã —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã –æ–¥–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã (–¥–ª–∏–Ω–∞√ó—à–∏—Ä–∏–Ω–∞√ó–≤—ã—Å–æ—Ç–∞ –≤ —Å–º):\n"
                  "<i>–ü—Ä–∏–º–µ—Ä: 15√ó8√ó3 –∏–ª–∏ 20 10 5</i>\n\n"
                  "–ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å'",
            "tj": "üìè <b>“ö–∞–¥–∞–º–∏ 7 –∞–∑ 8: –ê–Ω–¥–æ–∑–∞“≥–æ–∏ –º–∞“≥—Å—É–ª–æ—Ç</b>\n\n"
                  "–ê–Ω–¥–æ–∑–∞“≥–æ–∏ —è–∫ –≤–æ“≥–∏–¥—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä–æ–∑”£√ó–±–∞—Ä–∞–Ω–¥–æ–∑”£√ó–±–∞–ª–∞–Ω–¥”£ –¥–∞—Ä —Å–º):\n"
                  "<i>–ù–∞–º—É–Ω–∞: 15√ó8√ó3 —ë 20 10 5</i>\n\n"
                  "–Å '–ì—É–∑–∞—Ä–æ–Ω' –Ω–∞–≤–∏—Å–µ–¥"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.product_dimensions)
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\products\check_track.py =====
"""
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤
"""
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository, ProductRepository
from keyboards.client import get_back_cancel_keyboard, get_track_codes_keyboard
from utils.states import ClientState
from .utils import track_codes_menu_back, get_status_text

logger = logging.getLogger(__name__)
router = Router()

@router.message(ClientState.track_codes_menu, F.text.contains("–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–µ–∫-–∫–æ–¥"))
@router.message(ClientState.track_codes_menu, F.text.contains("–¢–∞—Ñ—Ç–∏—à –∫–∞—Ä–¥–∞–Ω–∏ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω"))
async def check_track_code_start(message: Message, state: FSMContext):
    """–ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–µ–∫-–∫–æ–¥–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üîç <b>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–∫-–∫–æ–¥–∞</b>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫-–∫–æ–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:\n"
                  "<i>–ú–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–¥–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</i>",
            "tj": "üîç <b>–¢–∞—Ñ—Ç–∏—à –∫–∞—Ä–¥–∞–Ω–∏ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω</b>\n\n"
                  "–ë–∞—Ä–æ–∏ —Ç–∞—Ñ—Ç–∏—à —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:\n"
                  "<i>–Ø–∫—á–∞–Ω–¥ —Ä–∞–º–∑—Ä–æ –±–æ –≤–µ—Ä–≥—É–ª “∑—É–¥–æ –∫–∞—Ä–¥–∞–Ω –º—É–º–∫–∏–Ω –∞—Å—Ç</i>"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.check_track_code)
        
@router.message(ClientState.check_track_code)
async def process_check_track_code(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–µ–∫-–∫–æ–¥–∞ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await track_codes_menu_back(message, state)
        return
    
    track_codes = [code.strip() for code in message.text.split(",") if code.strip()]
    
    if not track_codes:
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç—Ä–µ–∫-–∫–æ–¥",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, –Ω–∞ –∫–∞–º—Ç–∞—Ä —è–∫ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥"
            }
            await message.answer(texts[user.language])
            return
    
    async for session in get_db():
        user_repo = UserRepository(session)
        product_repo = ProductRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        for track_code in track_codes:
            detailed_info = await product_repo.get_detailed_product_info(track_code)
            
            if not detailed_info:
                texts = {
                    "ru": f"‚ùå –¢–æ–≤–∞—Ä —Å —Ç—Ä–µ–∫-–∫–æ–¥–æ–º {track_code} –Ω–µ –Ω–∞–π–¥–µ–Ω",
                    "tj": f"‚ùå –ú–∞“≥—Å—É–ª–æ—Ç –±–æ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω {track_code} —ë—Ñ—Ç –Ω–∞—à—É–¥"
                }
                await message.answer(texts[user.language])
                continue
            
            product = detailed_info["product"]
            product_info = detailed_info["product_info"]
            
            # –§–æ—Ä–º–∏—Ä—É–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            status_text = get_status_text(product.status.value, user.language)
            
            # –î–∞—Ç—ã
            created_date = product.created_at.strftime("%d.%m.%Y %H:%M")
            arrival_date = product.arrival_date.strftime("%d.%m.%Y") if product.arrival_date else "–ù–µ —É–∫–∞–∑–∞–Ω–∞"
            expected_date = product.expected_delivery_date.strftime("%d.%m.%Y") if product.expected_delivery_date else "–ù–µ —É–∫–∞–∑–∞–Ω–∞"
            
            text = {
                "ru": f"""üì¶ <b>–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –¢–û–í–ê–†–ï</b>

üéØ <b>–¢—Ä–µ–∫-–∫–æ–¥:</b> <code>{track_code}</code>
üè∑Ô∏è <b>–ù–∞–∑–≤–∞–Ω–∏–µ:</b> {product_info['name'] or '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
üìÇ <b>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</b> {product_info['category'] or '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}
üìù <b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> {product_info['description'] or '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}

üìç <b>–°—Ç–∞—Ç—É—Å:</b> {status_text}
üìÖ <b>–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:</b> {created_date}
üìÖ <b>–î–∞—Ç–∞ –ø—Ä–∏–±—ã—Ç–∏—è:</b> {arrival_date}
üìÖ <b>–û–∂–∏–¥–∞–µ–º–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞:</b> {expected_date}

üî¢ <b>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</b> {product_info['quantity']} —à—Ç.
üí∞ <b>–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É:</b> ${product_info['unit_price']:.2f}
üíµ <b>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</b> ${product_info['total_value']:.2f}
‚öñÔ∏è <b>–í–µ—Å:</b> {product_info['weight']:.2f} –∫–≥
üìè <b>–ì–∞–±–∞—Ä–∏—Ç—ã:</b> {product_info['dimensions'] or '–ù–µ —É–∫–∞–∑–∞–Ω—ã'}

‚ö†Ô∏è <b>–û—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞:</b> 
{'–•—Ä—É–ø–∫–∏–π' if product_info['fragile'] else ''} 
{'–° –±–∞—Ç–∞—Ä–µ–µ–π' if product_info['has_battery'] else ''} 
{'–ñ–∏–¥–∫–æ—Å—Ç—å' if product_info['is_liquid'] else ''} 
{'–ù–µ—Ç' if not any([product_info['fragile'], product_info['has_battery'], product_info['is_liquid']]) else ''}""",
                "tj": f"""üì¶ <b>–ú–ê–™–õ–£–ú–û–¢ –î–ê–† –ë–û–†–ê–ò –ú–ê“≤–°–£–õ–û–¢</b>

üéØ <b>–†–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω:</b> <code>{track_code}</code>
üè∑Ô∏è <b>–ù–æ–º:</b> {product_info['name'] or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üìÇ <b>–ì—É—Ä”Ø“≥:</b> {product_info['category'] or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üìù <b>–¢–∞–≤—Å–∏—Ñ:</b> {product_info['description'] or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}

üìç <b>–°—Ç–∞—Ç—É—Å:</b> {status_text}
üìÖ <b>–°–∞–Ω–∏–∏ –∏–ª–æ–≤–∞:</b> {created_date}
üìÖ <b>–°–∞–Ω–∏–∏ —Ä–∞—Å–∏–¥–∞–Ω:</b> {arrival_date}
üìÖ <b>–†–∞—Å–æ–Ω–∏–∏–¥–∞–Ω–∏ –∏–Ω—Ç–∏–∑–æ—Ä—à–∞–≤–∞–Ω–¥–∞:</b> {expected_date}

üî¢ <b>–ú–∏“õ–¥–æ—Ä:</b> {product_info['quantity']} –¥–æ–Ω–∞
üí∞ <b>–ù–∞—Ä—Ö –±–∞—Ä–æ–∏ —è–∫ –≤–æ“≥–∏–¥:</b> ${product_info['unit_price']:.2f}
üíµ <b>–ê—Ä–∑–∏—à–∏ —É–º—É–º”£:</b> ${product_info['total_value']:.2f}
‚öñÔ∏è <b>–í–∞–∑–Ω:</b> {product_info['weight']:.2f} –∫–≥
üìè <b>–ê–Ω–¥–æ–∑–∞“≥–æ:</b> {product_info['dimensions'] or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}

‚ö†Ô∏è <b>–•—É—Å—É—Å–∏—è—Ç“≥–æ–∏ –º–∞—Ö—Å—É—Å:</b> 
{'–ù–æ–∑—É–∫' if product_info['fragile'] else ''} 
{'–ë–æ –±–∞—Ç–∞—Ä–µ—è' if product_info['has_battery'] else ''} 
{'–ú–æ–µ—ä' if product_info['is_liquid'] else ''} 
{'–ù–µ' if not any([product_info['fragile'], product_info['has_battery'], product_info['is_liquid']]) else ''}"""
            }
            
            await message.answer(
                text[user.language],
                parse_mode="HTML"
            )
        
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –º–µ–Ω—é —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤
        from keyboards.client import get_track_codes_keyboard
        await message.answer(
            "üì¶ –ú–µ–Ω—é —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤:" if user.language == "ru" else "üì¶ –ú–µ–Ω—é–∏ —Ä–∞–º–∑“≥–æ–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω:",
            reply_markup=get_track_codes_keyboard(user.language)
        )
        await state.set_state(ClientState.track_codes_menu)

@router.message(ClientState.check_track_code)
async def process_check_track_code(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–µ–∫-–∫–æ–¥–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await track_codes_menu_back(message, state)
        return
    
    track_codes = [code.strip() for code in message.text.split(",") if code.strip()]
    
    if not track_codes:
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç—Ä–µ–∫-–∫–æ–¥",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, –Ω–∞ –∫–∞–º—Ç–∞—Ä —è–∫ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥"
            }
            await message.answer(texts[user.language])
            return
    
    async for session in get_db():
        user_repo = UserRepository(session)
        product_repo = ProductRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        results = []
        for track_code in track_codes:
            product = await product_repo.get_product_by_track_code(track_code)
            
            if product:
                status_text = get_status_text(product.status.value, user.language)
                results.append(f"‚úÖ <b>{track_code}</b> - {status_text}")
            else:
                results.append(f"‚ùå <b>{track_code}</b> - –Ω–µ –Ω–∞–π–¥–µ–Ω" if user.language == "ru" else f"‚ùå <b>{track_code}</b> - —ë—Ñ—Ç –Ω–∞—à—É–¥")
        
        text = {
            "ru": f"üîç <b>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:</b>\n\n" + "\n\n".join(results),
            "tj": f"üîç <b>–ù–∞—Ç–∏“∑–∞“≥–æ–∏ —Ç–∞—Ñ—Ç–∏—à:</b>\n\n" + "\n\n".join(results)
        }
        
        await message.answer(
            text[user.language],
            reply_markup=get_track_codes_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.track_codes_menu)
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\products\edit_product.py =====
from sqlalchemy import select
"""
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
"""
import logging
from aiogram import Router, F
from aiogram.types import Message, CallbackQuery
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository, ProductRepository
from keyboards.client import get_back_cancel_keyboard, get_track_codes_keyboard
from keyboards.products import get_edit_product_keyboard
from utils.states import ClientState
from .utils import track_codes_menu_back

logger = logging.getLogger(__name__)
router = Router()

@router.message(ClientState.track_codes_menu, F.text.contains("–ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä"))
@router.message(ClientState.track_codes_menu, F.text.contains("–¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç"))
async def edit_product_start(message: Message, state: FSMContext):
    """–ù–∞—á–∞–ª–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "‚úèÔ∏è <b>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</b>\n\n"
                  "–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫-–∫–æ–¥ —Ç–æ–≤–∞—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å:",
            "tj": "‚úèÔ∏è <b>–¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç</b>\n\n"
                  "–†–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥, –∫–∏ –º–µ—Ö–æ“≥–µ–¥ —Ç–∞“ì–π–∏—Ä –¥–∏“≥–µ–¥:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_back_cancel_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.edit_product_start)

@router.message(ClientState.edit_product_start)
async def edit_product_select(message: Message, state: FSMContext):
    """–í—ã–±–æ—Ä —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await track_codes_menu_back(message, state)
        return
    
    track_code = message.text.strip()
    
    async for session in get_db():
        user_repo = UserRepository(session)
        product_repo = ProductRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        product = await product_repo.get_product_by_track_code(track_code)
        
        if not product:
            texts = {
                "ru": f"‚ùå –¢–æ–≤–∞—Ä —Å —Ç—Ä–µ–∫-–∫–æ–¥–æ–º {track_code} –Ω–µ –Ω–∞–π–¥–µ–Ω",
                "tj": f"‚ùå –ú–∞“≥—Å—É–ª–æ—Ç –±–æ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω {track_code} —ë—Ñ—Ç –Ω–∞—à—É–¥"
            }
            await message.answer(texts[user.language])
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ª–∏ —Ç–æ–≤–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        if product.user_id != user.id:
            texts = {
                "ru": "‚ùå –≠—Ç–æ—Ç —Ç–æ–≤–∞—Ä –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –≤–∞–º",
                "tj": "‚ùå –ò–Ω –º–∞“≥—Å—É–ª–æ—Ç –±–∞ —à—É–º–æ —Ç–∞–∞–ª–ª—É“õ –Ω–∞–¥–æ—Ä–∞–¥"
            }
            await message.answer(texts[user.language])
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä
        from database.models import ProductStatus
        if product.status not in [ProductStatus.CREATED, ProductStatus.CHINA_WAREHOUSE]:
            texts = {
                "ru": "‚ö†Ô∏è –≠—Ç–æ—Ç —Ç–æ–≤–∞—Ä —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ.",
                "tj": "‚ö†Ô∏è –ò–Ω –º–∞“≥—Å—É–ª–æ—Ç –∞–ª–ª–∞–∫–∞–π —Ñ–∏—Ä–∏—Å—Ç–æ–¥–∞ —à—É–¥–∞–∞—Å—Ç. –®—É–º–æ –º–µ—Ç–∞–≤–æ–Ω–µ–¥ —Ç–∞–Ω“≥–æ –Ω–æ–º –≤–∞ —Ç–∞–≤—Å–∏—Ñ—Ä–æ —Ç–∞“ì–π–∏—Ä –¥–∏“≥–µ–¥."
            }
            await message.answer(texts[user.language])
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞
        await state.update_data(
            edit_track_code=track_code,
            edit_product_id=product.id
        )
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ
        from .utils import get_status_text
        
        status_text = get_status_text(product.status.value, user.language)
        
        texts = {
            "ru": f"""‚úèÔ∏è <b>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</b>

üéØ –¢—Ä–µ–∫-–∫–æ–¥: <code>{track_code}</code>
üè∑Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ: {product.product_name or '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
üìù –û–ø–∏—Å–∞–Ω–∏–µ: {product.product_description or '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
üìç –°—Ç–∞—Ç—É—Å: {status_text}

–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å?""",
            "tj": f"""‚úèÔ∏è <b>–¢–∞“≥—Ä–∏—Ä –∫–∞—Ä–¥–∞–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç</b>

üéØ –†–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω: <code>{track_code}</code>
üè∑Ô∏è –ù–æ–º: {product.product_name or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üìù –¢–∞–≤—Å–∏—Ñ: {product.product_description or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üìç –°—Ç–∞—Ç—É—Å: {status_text}

–®—É–º–æ —á”£ –º–µ—Ö–æ“≥–µ–¥ —Ç–∞“ì–π–∏—Ä –¥–∏“≥–µ–¥?"""
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_edit_product_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.edit_product_menu)

@router.message(ClientState.edit_product_menu)
async def edit_product_menu_handler(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –≤ –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
            await track_codes_menu_back(message, state)
            return
        
        texts = {
            "ru": {
                "edit_name": "üìù –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ",
                "edit_desc": "üìù –ò–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ",
                "edit_quantity": "üî¢ –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ",
                "edit_price": "üí∞ –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É",
                "edit_weight": "‚öñÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –≤–µ—Å",
                "edit_category": "üè∑Ô∏è –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é",
                "back": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
            },
            "tj": {
                "edit_name": "üìù –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –Ω–æ–º",
                "edit_desc": "üìù –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ —Ç–∞–≤—Å–∏—Ñ",
                "edit_quantity": "üî¢ –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –º–∏“õ–¥–æ—Ä",
                "edit_price": "üí∞ –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –Ω–∞—Ä—Ö",
                "edit_weight": "‚öñÔ∏è –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –≤–∞–∑–Ω",
                "edit_category": "üè∑Ô∏è –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –≥—É—Ä”Ø“≥",
                "back": "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"
            }
        }
        
        t = texts[user.language]
        
        if message.text == t["edit_name"]:
            texts = {
                "ru": "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:",
                "tj": "–ù–æ–º–∏ –Ω–∞–≤–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:"
            }
            await message.answer(
                texts[user.language],
                reply_markup=get_back_cancel_keyboard(user.language)
            )
            await state.set_state(ClientState.edit_product_name)
            
        elif message.text == t["edit_desc"]:
            texts = {
                "ru": "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:",
                "tj": "–¢–∞–≤—Å–∏—Ñ–∏ –Ω–∞–≤–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:"
            }
            await message.answer(
                texts[user.language],
                reply_markup=get_back_cancel_keyboard(user.language)
            )
            await state.set_state(ClientState.edit_product_desc)
        
        elif message.text == t["edit_quantity"]:
            texts = {
                "ru": "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞:",
                "tj": "–ú–∏“õ–¥–æ—Ä–∏ –Ω–∞–≤–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥:"
            }
            await message.answer(
                texts[user.language],
                reply_markup=get_back_cancel_keyboard(user.language)
            )
            await state.set_state(ClientState.edit_product_quantity)
        
        elif message.text == t["edit_price"]:
            texts = {
                "ru": "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é —Ü–µ–Ω—É –∑–∞ –µ–¥–∏–Ω–∏—Ü—É (–≤ USD):",
                "tj": "–ù–∞—Ä—Ö–∏ –Ω–∞–≤–∏ –±–∞—Ä–æ–∏ —è–∫ –≤–æ“≥–∏–¥—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä USD):"
            }
            await message.answer(
                texts[user.language],
                reply_markup=get_back_cancel_keyboard(user.language)
            )
            await state.set_state(ClientState.edit_product_price)
        
        elif message.text == t["edit_weight"]:
            texts = {
                "ru": "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –≤–µ—Å —Ç–æ–≤–∞—Ä–∞ (–≤ –∫–≥):",
                "tj": "–í–∞–∑–Ω–∏ –Ω–∞–≤–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–¥–∞—Ä –∫–≥):"
            }
            await message.answer(
                texts[user.language],
                reply_markup=get_back_cancel_keyboard(user.language)
            )
            await state.set_state(ClientState.edit_product_weight)
        
        elif message.text == t["edit_category"]:
            from keyboards.products import get_product_categories_keyboard
            texts = {
                "ru": "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞:",
                "tj": "–ì—É—Ä”Ø“≥–∏ –Ω–∞–≤–∏ –º–∞“≥—Å—É–ª–æ—Ç—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"
            }
            await message.answer(
                texts[user.language],
                reply_markup=get_product_categories_keyboard(user.language)
            )
            await state.set_state(ClientState.edit_product_category)
        
        else:
            await edit_product_select(message, state)

@router.message(ClientState.edit_product_name)
async def edit_product_name_handler(message: Message, state: FSMContext):
    """–ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    await _edit_product_field(message, state, "product_name", message.text)

@router.message(ClientState.edit_product_desc)
async def edit_product_desc_handler(message: Message, state: FSMContext):
    """–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    await _edit_product_field(message, state, "product_description", message.text)

@router.message(ClientState.edit_product_quantity)
async def edit_product_quantity_handler(message: Message, state: FSMContext):
    """–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞"""
    try:
        quantity = int(message.text)
        if quantity <= 0:
            raise ValueError
        await _edit_product_field(message, state, "quantity", quantity)
    except ValueError:
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–æ–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, —Ä–∞“õ–∞–º–∏ –±—É—Ç—É–Ω–∏ –º—É—Å–±–∞—Ç –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥"
            }
            await message.answer(texts[user.language])

@router.message(ClientState.edit_product_price)
async def edit_product_price_handler(message: Message, state: FSMContext):
    """–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞"""
    try:
        price = float(message.text.replace(",", "."))
        if price < 0:
            raise ValueError
        
        data = await state.get_data()
        quantity = data.get('quantity', 1)
        total_value = price * quantity
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –∏ —Ü–µ–Ω—É –∏ –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
        async for session in get_db():
            product_repo = ProductRepository(session)
            await product_repo.update_product(
                data['edit_product_id'],
                unit_price_usd=price,
                total_value_usd=total_value
            )
        
        await _show_edit_success(message, state)
    except ValueError:
        async for session in get_db():
            user_repo = UserRepository(session)
            user = await user_repo.get_user_by_telegram_id(message.from_user.id)
            
            texts = {
                "ru": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 50, 99.99)",
                "tj": "‚ùå –õ—É—Ç—Ñ–∞–Ω, —Ä–∞“õ–∞–º –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (–º–∞—Å–∞–ª–∞–Ω: 50, 99.99)"
            }
            await message.answer(texts[user.language])

async def _edit_product_field(message: Message, state: FSMContext, field: str, value):
    """–û–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—è —Ç–æ–≤–∞—Ä–∞"""
    if message.text in ["‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"]:
        await edit_product_select(message, state)
        return
    
    data = await state.get_data()
    
    async for session in get_db():
        product_repo = ProductRepository(session)
        await product_repo.update_product(data['edit_product_id'], **{field: value})
    
    await _show_edit_success(message, state)

async def _show_edit_success(message: Message, state: FSMContext):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        data = await state.get_data()
        track_code = data.get('edit_track_code')
        
        texts = {
            "ru": f"‚úÖ –¢–æ–≤–∞—Ä —Å —Ç—Ä–µ–∫-–∫–æ–¥–æ–º <code>{track_code}</code> —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!",
            "tj": f"‚úÖ –ú–∞“≥—Å—É–ª–æ—Ç –±–æ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω <code>{track_code}</code> –±–æ–º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç –Ω–∞–≤—Å–æ–∑”£ —à—É–¥!"
        }
        
        await message.answer(
            texts[user.language],
            parse_mode="HTML"
        )
        
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        await edit_product_select(message, state)
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\products\export_products.py =====
"""
–≠–∫—Å–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ Excel
"""
import logging
from datetime import datetime
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository, ProductRepository
from utils.states import ClientState
from .utils import track_codes_menu_back

logger = logging.getLogger(__name__)
router = Router()

@router.message(ClientState.track_codes_menu, F.text.contains("–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel"))
async def export_products_to_excel(message: Message, state: FSMContext):
    """–≠–∫—Å–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Excel"""
    async for session in get_db():
        user_repo = UserRepository(session)
        product_repo = ProductRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        products = await product_repo.get_user_products(user.id, limit=1000)  # –ë–æ–ª—å—à–æ–π –ª–∏–º–∏—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
        
        if not products:
            texts = {
                "ru": "‚ùó –£ –≤–∞—Å –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞",
                "tj": "‚ùó –®—É–º–æ –º–∞“≥—Å—É–ª–æ—Ç –±–∞—Ä–æ–∏ —ç–∫—Å–ø–æ—Ä—Ç –Ω–∞–¥–æ—Ä–µ–¥"
            }
            await message.answer(texts[user.language])
            return
        
        try:
            # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∏–º–ø–æ—Ä—Ç–æ–≤
            from services.excel_export import generate_user_products_report
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º Excel —Ñ–∞–π–ª
            file_path = await generate_user_products_report(products, user.language)
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∞–π–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            from aiogram.types import FSInputFile
            
            texts = {
                "ru": f"üìä <b>–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!</b>\n\n"
                      f"–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Å {len(products)} —Ç–æ–≤–∞—Ä–∞–º–∏.",
                "tj": f"üìä <b>–≠–∫—Å–ø–æ—Ä—Ç –∞–Ω“∑–æ–º —ë—Ñ—Ç!</b>\n\n"
                      f"–§–∞–π–ª –±–æ {len(products)} –º–∞“≥—Å—É–ª–æ—Ç —Å–æ—Ö—Ç–∞ —à—É–¥."
            }
            
            await message.answer(texts[user.language], parse_mode="HTML")
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∞–π–ª
            file = FSInputFile(file_path, filename=f"–º–æ–∏_—Ç–æ–≤–∞—Ä—ã_{datetime.now().strftime('%Y%m%d_%H%M')}.xlsx")
            await message.answer_document(file)
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ Excel: {e}")
            texts = {
                "ru": "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Excel —Ñ–∞–π–ª–∞",
                "tj": "‚ùå –•–∞—Ç–æ –¥–∞—Ä —Å–æ—Ö—Ç–∞–Ω–∏ —Ñ–∞–π–ª–∏ Excel"
            }
            await message.answer(texts[user.language])
        
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –º–µ–Ω—é —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤
        from keyboards.client import get_track_codes_keyboard
        await message.answer(
            "üì¶ –ú–µ–Ω—é —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤:" if user.language == "ru" else "üì¶ –ú–µ–Ω—é–∏ —Ä–∞–º–∑“≥–æ–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω:",
            reply_markup=get_track_codes_keyboard(user.language)
        )
        await state.set_state(ClientState.track_codes_menu)
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\products\main.py =====
"""
–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏
"""
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository
from keyboards.client import get_track_codes_keyboard
from utils.states import ClientState
from .utils import track_codes_menu_back

logger = logging.getLogger(__name__)
router = Router()

# ========== –ú–ï–ù–Æ –¢–†–ï–ö-–ö–û–î–û–í ==========

@router.message(ClientState.main_menu, F.text.contains("üì¶"))
async def track_codes_menu(message: Message, state: FSMContext):
    """–ú–µ–Ω—é —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤"""
    async for session in get_db():
        user_repo = UserRepository(session)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üì¶ <b>–¢—Ä–µ–∫-–∫–æ–¥—ã</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
            "tj": "üì¶ <b>–†–∞–º–∑“≥–æ–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω</b>\n\n–ê–º–∞–ª—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_track_codes_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.track_codes_menu)
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\products\product_details.py =====
"""
–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ
"""
import logging
from aiogram import Router, F
from aiogram.types import CallbackQuery
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository, ProductRepository
from utils.states import ClientState
from .utils import get_status_text

logger = logging.getLogger(__name__)
router = Router()

@router.callback_query(F.data.startswith("view_product_"))
async def view_product_details(callback: CallbackQuery, state: FSMContext):
    """–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–≤–∞—Ä–µ"""
    product_id = int(callback.data.split("_")[2])
    
    async for session in get_db():
        product_repo = ProductRepository(session)
        user_repo = UserRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(callback.from_user.id)
        product = await session.get(product_repo.model, product_id)
        
        if not product:
            await callback.answer("‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ª–∏ —Ç–æ–≤–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        if product.user_id != user.id:
            await callback.answer("‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É —Ç–æ–≤–∞—Ä—É")
            return
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        status_text = get_status_text(product.status.value, user.language)
        
        # –ü–µ—Ä–µ–≤–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        category_names_ru = {
            "electronics": "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
            "clothing": "–û–¥–µ–∂–¥–∞",
            "shoes": "–û–±—É–≤—å",
            "home_appliances": "–ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞",
            "beauty": "–ö–æ—Å–º–µ—Ç–∏–∫–∞",
            "toys": "–ò–≥—Ä—É—à–∫–∏",
            "automotive": "–ê–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–∏",
            "sports": "–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã",
            "other": "–î—Ä—É–≥–æ–µ"
        }
        
        category_names_tj = {
            "electronics": "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
            "clothing": "–õ–∏–±–æ—Å",
            "shoes": "–ü–æ–π–∞—Ñ–∑–æ–ª",
            "home_appliances": "–ê—Å–±–æ–±“≥–æ–∏ —Ö–æ–Ω–∞–≥”£",
            "beauty": "–ö–æ—Å–º–µ—Ç–∏–∫–∞",
            "toys": "–ë–æ–∑–∏—á–∞“≥–æ",
            "automotive": "“ö–∏—Å–º“≥–æ–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª",
            "sports": "–ê—à—ë“≥–æ–∏ –≤–∞—Ä–∑–∏—à”£",
            "other": "–î–∏–≥–∞—Ä"
        }
        
        category_name = category_names_ru.get(product.product_category, product.product_category) if user.language == "ru" else category_names_tj.get(product.product_category, product.product_category)
        
        # –û–ø–∏—Å–∞–Ω–∏–µ
        description = product.product_description or ("–ù–µ —É–∫–∞–∑–∞–Ω–æ" if user.language == "ru" else "–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç")
        
        # –ì–∞–±–∞—Ä–∏—Ç—ã
        dimensions = ""
        if product.length_cm and product.width_cm and product.height_cm:
            dimensions = f"{product.length_cm}√ó{product.width_cm}√ó{product.height_cm} —Å–º"
        else:
            dimensions = "–ù–µ —É–∫–∞–∑–∞–Ω—ã" if user.language == "ru" else "–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç"
        
        # –û—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
        special_properties = []
        if product.fragile:
            special_properties.append("–•—Ä—É–ø–∫–∏–π" if user.language == "ru" else "–ù–æ–∑—É–∫")
        if product.has_battery:
            special_properties.append("–° –±–∞—Ç–∞—Ä–µ–µ–π" if user.language == "ru" else "–ë–æ –±–∞—Ç–∞—Ä–µ—è")
        if product.is_liquid:
            special_properties.append("–ñ–∏–¥–∫–æ—Å—Ç—å" if user.language == "ru" else "–ú–æ–µ—ä")
        
        special_text = ", ".join(special_properties) if special_properties else ("–ù–µ—Ç" if user.language == "ru" else "–ù–µ")
        
        text = {
            "ru": f"""üì¶ <b>–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ</b>

üéØ <b>–¢—Ä–µ–∫-–∫–æ–¥:</b> <code>{product.track_code}</code>
üè∑Ô∏è <b>–ù–∞–∑–≤–∞–Ω–∏–µ:</b> {product.product_name or '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
üìÇ <b>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</b> {category_name}
üìù <b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> {description}
üìç <b>–°—Ç–∞—Ç—É—Å:</b> {status_text}

üî¢ <b>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</b> {product.quantity or 1} —à—Ç.
üí∞ <b>–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É:</b> ${product.unit_price_usd:.2f} USD
üíµ <b>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</b> ${product.total_value_usd:.2f} USD
‚öñÔ∏è <b>–í–µ—Å:</b> {product.weight_kg:.2f} –∫–≥
üìè <b>–ì–∞–±–∞—Ä–∏—Ç—ã:</b> {dimensions}

‚ö†Ô∏è <b>–û—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞:</b> {special_text}

üè¨ <b>–°—Ç—Ä–∞–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</b> {product.country_from or '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}
üöö <b>–¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏:</b> {product.delivery_type or '–ù–µ —É–∫–∞–∑–∞–Ω'}

üìÖ <b>–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:</b> {product.send_date.strftime('%d.%m.%Y') if product.send_date else '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}
üìÖ <b>–û–∂–∏–¥–∞–µ–º–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞:</b> {product.expected_delivery_date.strftime('%d.%m.%Y') if product.expected_delivery_date else '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}

üìÖ <b>–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:</b> {product.created_at.strftime('%d.%m.%Y %H:%M')}
üÜî <b>ID —Ç–æ–≤–∞—Ä–∞:</b> {product.id}""",
            "tj": f"""üì¶ <b>–ú–∞—ä–ª—É–º–æ—Ç–∏ —Ç–∞—Ñ—Å–∏–ª–æ—Ç”£ –æ–∏–¥ –±–∞ –º–∞“≥—Å—É–ª–æ—Ç</b>

üéØ <b>–†–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω:</b> <code>{product.track_code}</code>
üè∑Ô∏è <b>–ù–æ–º:</b> {product.product_name or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üìÇ <b>–ì—É—Ä”Ø“≥:</b> {category_name}
üìù <b>–¢–∞–≤—Å–∏—Ñ:</b> {description}
üìç <b>–°—Ç–∞—Ç—É—Å:</b> {status_text}

üî¢ <b>–ú–∏“õ–¥–æ—Ä:</b> {product.quantity or 1} –¥–æ–Ω–∞
üí∞ <b>–ù–∞—Ä—Ö –±–∞—Ä–æ–∏ —è–∫ –≤–æ“≥–∏–¥:</b> ${product.unit_price_usd:.2f} USD
üíµ <b>–ê—Ä–∑–∏—à–∏ —É–º—É–º”£:</b> ${product.total_value_usd:.2f} USD
‚öñÔ∏è <b>–í–∞–∑–Ω:</b> {product.weight_kg:.2f} –∫–≥
üìè <b>–ê–Ω–¥–æ–∑–∞“≥–æ:</b> {dimensions}

‚ö†Ô∏è <b>–•—É—Å—É—Å–∏—è—Ç“≥–æ–∏ –º–∞—Ö—Å—É—Å:</b> {special_text}

üè¨ <b>–ö–∏—à–≤–∞—Ä–∏ —Ñ–∏—Ä–∏—Å—Ç–æ–¥:</b> {product.country_from or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üöö <b>–ù–∞–≤—ä–∏ —Ä–∞—Å–æ–Ω–∏–¥–∞–Ω:</b> {product.delivery_type or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}

üìÖ <b>–°–∞–Ω–∞–∏ —Ñ–∏—Ä–∏—Å—Ç–æ–¥:</b> {product.send_date.strftime('%d.%m.%Y') if product.send_date else '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üìÖ <b>–†–∞—Å–æ–Ω–∏–∏–¥–∞–Ω–∏ –∏–Ω—Ç–∏–∑–æ—Ä—à–∞–≤–∞–Ω–¥–∞:</b> {product.expected_delivery_date.strftime('%d.%m.%Y') if product.expected_delivery_date else '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}

üìÖ <b>–°–∞–Ω–∏–∏ –∏–ª–æ–≤–∞:</b> {product.created_at.strftime('%d.%m.%Y %H:%M')}
üÜî <b>ID –º–∞“≥—Å—É–ª–æ—Ç:</b> {product.id}"""
        }
        
        # –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
        
        keyboard = [
            [
                InlineKeyboardButton(
                    text="üîô –ö —Å–ø–∏—Å–∫—É" if user.language == "ru" else "üîô –ë–∞ —Ä”Ø–π—Ö–∞—Ç",
                    callback_data="back_to_list"
                )
            ]
        ]
        
        # –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω, –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        from database.models import ProductStatus
        if product.status in [ProductStatus.CREATED, ProductStatus.CHINA_WAREHOUSE]:
            keyboard[0].append(
                InlineKeyboardButton(
                    text="‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" if user.language == "ru" else "‚úèÔ∏è –¢–∞“≥—Ä–∏—Ä –∫–∞—Ä–¥–∞–Ω",
                    callback_data=f"edit_product_{product.id}"
                )
            )
        
        reply_markup = InlineKeyboardMarkup(inline_keyboard=keyboard)
        
        await callback.message.edit_text(
            text[user.language],
            reply_markup=reply_markup,
            parse_mode="HTML"
        )
        await callback.answer()

@router.callback_query(F.data == "back_to_list")
async def back_to_products_list(callback: CallbackQuery, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É —Ç–æ–≤–∞—Ä–æ–≤"""
    from .view_products import my_products_list
    await my_products_list(callback.message, state)
    await callback.answer()
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\products\utils.py =====
"""
–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏
"""
from datetime import datetime
from database.models import ProductCategory
from keyboards.client import get_track_codes_keyboard

async def track_codes_menu_back(message, state):
    """–í–æ–∑–≤—Ä–∞—Ç –≤ –º–µ–Ω—é —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤"""
    async for db in get_db():
        user_repo = UserRepository(db)
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        
        texts = {
            "ru": "üì¶ <b>–¢—Ä–µ–∫-–∫–æ–¥—ã</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
            "tj": "üì¶ <b>–†–∞–º–∑“≥–æ–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω</b>\n\n–ê–º–∞–ª—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:"
        }
        
        await message.answer(
            texts[user.language],
            reply_markup=get_track_codes_keyboard(user.language),
            parse_mode="HTML"
        )
        await state.set_state(ClientState.track_codes_menu)

def get_status_text(status: str, language: str = "ru") -> str:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ –Ω—É–∂–Ω–æ–º —è–∑—ã–∫–µ"""
    status_texts = {
        "ru": {
            "created": "–°–æ–∑–¥–∞–Ω",
            "china_warehouse": "–ù–∞ —Å–∫–ª–∞–¥–µ –≤ –ö–∏—Ç–∞–µ",
            "in_transit": "–í –ø—É—Ç–∏",
            "tajikistan_warehouse": "–ù–∞ —Å–∫–ª–∞–¥–µ –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–µ",
            "delivered": "–î–æ—Å—Ç–∞–≤–ª–µ–Ω",
            "completed": "–ó–∞–≤–µ—Ä—à–µ–Ω"
        },
        "tj": {
            "created": "–°–æ—Ö—Ç–∞ —à—É–¥–∞–∞—Å—Ç",
            "china_warehouse": "–î–∞—Ä –∞–Ω–±–æ—Ä–∏ –ß–∏–Ω",
            "in_transit": "–î–∞—Ä —Ä–æ“≥",
            "tajikistan_warehouse": "–î–∞—Ä –∞–Ω–±–æ—Ä–∏ –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω",
            "delivered": "–†–∞—Å–æ–Ω–∏–¥–∞ —à—É–¥",
            "completed": "–ê–Ω“∑–æ–º —ë—Ñ—Ç"
        }
    }
    
    return status_texts.get(language, status_texts["ru"]).get(status, status)

async def show_product_success_message(
    message, state, product, user, track_code, product_name, product_category,
    quantity, unit_price, total_value, weight, length, width, height,
    fragile, has_battery, is_liquid, product_description
):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞"""
    from keyboards.client import get_track_codes_keyboard
    
    # –ü–æ–ª—É—á–∞–µ–º —Ä—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    category_names_ru = {
        ProductCategory.ELECTRONICS: "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
        ProductCategory.CLOTHING: "–û–¥–µ–∂–¥–∞",
        ProductCategory.SHOES: "–û–±—É–≤—å",
        ProductCategory.HOME_APPLIANCES: "–ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞",
        ProductCategory.BEAUTY: "–ö–æ—Å–º–µ—Ç–∏–∫–∞",
        ProductCategory.TOYS: "–ò–≥—Ä—É—à–∫–∏",
        ProductCategory.AUTOMOTIVE: "–ê–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–∏",
        ProductCategory.SPORTS: "–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã",
        ProductCategory.OTHER: "–î—Ä—É–≥–æ–µ"
    }
    
    category_names_tj = {
        ProductCategory.ELECTRONICS: "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
        ProductCategory.CLOTHING: "–õ–∏–±–æ—Å",
        ProductCategory.SHOES: "–ü–æ–π–∞—Ñ–∑–æ–ª",
        ProductCategory.HOME_APPLIANCES: "–ê—Å–±–æ–±“≥–æ–∏ —Ö–æ–Ω–∞–≥”£",
        ProductCategory.BEAUTY: "–ö–æ—Å–º–µ—Ç–∏–∫–∞",
        ProductCategory.TOYS: "–ë–æ–∑–∏—á–∞“≥–æ",
        ProductCategory.AUTOMOTIVE: "“ö–∏—Å–º“≥–æ–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª",
        ProductCategory.SPORTS: "–ê—à—ë“≥–æ–∏ –≤–∞—Ä–∑–∏—à”£",
        ProductCategory.OTHER: "–î–∏–≥–∞—Ä"
    }
    
    category_name = category_names_ru[product_category] if user.language == "ru" else category_names_tj[product_category]
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–º —Ç–æ–≤–∞—Ä–µ
    dimensions_text = ""
    if length and width and height:
        dimensions_text = f"üìè –ì–∞–±–∞—Ä–∏—Ç—ã: {length}√ó{width}√ó{height} —Å–º\n" if user.language == "ru" else f"üìè –ê–Ω–¥–æ–∑–∞“≥–æ: {length}√ó{width}√ó{height} —Å–º\n"
    
    special_text = ""
    if fragile:
        special_text = "‚ö†Ô∏è –•—Ä—É–ø–∫–∏–π\n" if user.language == "ru" else "‚ö†Ô∏è –ù–æ–∑—É–∫\n"
    if has_battery:
        special_text += "üîã –° –±–∞—Ç–∞—Ä–µ–µ–π\n" if user.language == "ru" else "üîã –ë–æ –±–∞—Ç–∞—Ä–µ—è\n"
    if is_liquid:
        special_text += "üíß –ñ–∏–¥–∫–æ—Å—Ç—å\n" if user.language == "ru" else "üíß –ú–æ–µ—ä\n"
    
    if special_text == "":
        special_text = "‚úÖ –ë–µ–∑ –æ—Å–æ–±—ã—Ö —Å–≤–æ–π—Å—Ç–≤\n" if user.language == "ru" else "‚úÖ –ë–µ —Ö—É—Å—É—Å–∏—è—Ç–∏ –º–∞—Ö—Å—É—Å\n"
    
    texts = {
        "ru": f"""‚úÖ <b>–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!</b>

üì¶ <b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ:</b>
üéØ –¢—Ä–µ–∫-–∫–æ–¥: <code>{track_code}</code>
üè∑Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ: {product_name}
üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category_name}
üìù –û–ø–∏—Å–∞–Ω–∏–µ: {product_description or '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
üî¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {quantity} —à—Ç.
üí∞ –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É: ${unit_price:.2f}
üíµ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${total_value:.2f}
‚öñÔ∏è –í–µ—Å: {weight:.2f} –∫–≥
{dimensions_text}{special_text}
üìÖ –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: {product.created_at.strftime('%d.%m.%Y %H:%M')}

<i>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Ç–µ–ø–µ—Ä—å –≤–∏–¥—è—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∞—à–µ–º —Ç–æ–≤–∞—Ä–µ.</i>""",
        "tj": f"""‚úÖ <b>–ú–∞“≥—Å—É–ª–æ—Ç –±–æ–º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç –∏–ª–æ–≤–∞ –∫–∞—Ä–¥–∞ —à—É–¥!</b>

üì¶ <b>–ú–∞—ä–ª—É–º–æ—Ç –¥–∞—Ä –±–æ—Ä–∞–∏ –º–∞“≥—Å—É–ª–æ—Ç:</b>
üéØ –†–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω: <code>{track_code}</code>
üè∑Ô∏è –ù–æ–º: {product_name}
üìÇ –ì—É—Ä”Ø“≥: {category_name}
üìù –¢–∞–≤—Å–∏—Ñ: {product_description or '–ú—É–∞–π—è–Ω –Ω–∞—à—É–¥–∞–∞—Å—Ç'}
üî¢ –ú–∏“õ–¥–æ—Ä: {quantity} –¥–æ–Ω–∞
üí∞ –ù–∞—Ä—Ö –±–∞—Ä–æ–∏ —è–∫ –≤–æ“≥–∏–¥: ${unit_price:.2f}
üíµ –ê—Ä–∑–∏—à–∏ —É–º—É–º”£: ${total_value:.2f}
‚öñÔ∏è –í–∞–∑–Ω: {weight:.2f} –∫–≥
{dimensions_text}{special_text}
üìÖ –°–∞–Ω–∏–∏ –∏–ª–æ–≤–∞: {product.created_at.strftime('%d.%m.%Y %H:%M')}

<i>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä“≥–æ –∞–∫–Ω—É–Ω –º–∞—ä–ª—É–º–æ—Ç–∏ –ø—É—Ä—Ä–∞ –¥–∞—Ä –±–æ—Ä–∞–∏ –º–∞“≥—Å—É–ª–æ—Ç–∏ —à—É–º–æ—Ä–æ –º–µ–±–∏–Ω–∞–Ω–¥.</i>"""
    }
    
    await message.answer(
        texts[user.language],
        reply_markup=get_track_codes_keyboard(user.language),
        parse_mode="HTML"
    )
    await state.set_state(ClientState.track_codes_menu)
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\products\view_products.py =====
"""
–ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
"""
import logging
from aiogram import Router, F
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

from database.session import get_db
from database.repository import UserRepository, ProductRepository
from utils.states import ClientState
from .utils import get_status_text

logger = logging.getLogger(__name__)
router = Router()

@router.message(ClientState.track_codes_menu, F.text.contains("–ú–æ–∏ —Ç—Ä–µ–∫-–∫–æ–¥—ã"))
@router.message(ClientState.track_codes_menu, F.text.contains("–†–∞–º–∑“≥–æ–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω–∏ –º–∞–Ω"))
async def my_products_list(message: Message, state: FSMContext):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π"""
    async for session in get_db():
        user_repo = UserRepository(session)
        product_repo = ProductRepository(session)
        
        user = await user_repo.get_user_by_telegram_id(message.from_user.id)
        products = await product_repo.get_user_products(user.id)
        
        if not products:
            texts = {
                "ru": "‚ùó –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤",
                "tj": "‚ùó –®—É–º–æ —Ç–æ “≥–æ–ª –º–∞“≥—Å—É–ª–æ—Ç–∏ –∏–ª–æ–≤–∞—à—É–¥–∞ –Ω–∞–¥–æ—Ä–µ–¥"
            }
            await message.answer(texts[user.language])
            return
        
        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        state_data = await state.get_data()
        current_page = state_data.get('products_page', 1)
        page_size = 5  # 5 —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        # –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
        total_pages = (len(products) + page_size - 1) // page_size
        
        # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        current_page = max(1, min(current_page, total_pages))
        
        # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä—ã –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        start_idx = (current_page - 1) * page_size
        end_idx = min(start_idx + page_size, len(products))
        products_to_show = products[start_idx:end_idx]
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
        text = f"üì¶ <b>–í–∞—à–∏ —Ç–æ–≤–∞—Ä—ã (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ {current_page}/{total_pages}):</b>\n\n" if user.language == "ru" else f"üì¶ <b>–ú–∞“≥—Å—É–ª–æ—Ç“≥–æ–∏ —à—É–º–æ (—Å–∞“≥–∏—Ñ–∞ {current_page}/{total_pages}):</b>\n\n"
        
        for i, product in enumerate(products_to_show, start_idx + 1):
            status_text = get_status_text(product.status.value, user.language)
            
            # –î–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ
            product_name = product.product_name or "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"
            if user.language == "tj":
                product_name = product.product_name or "–ë–µ–Ω–æ–º"
            
            text += f"<b>{i}.</b> <code>{product.track_code}</code>\n"
            text += f"   üè∑Ô∏è {product_name}\n"
            text += f"   üìç –°—Ç–∞—Ç—É—Å: {status_text}\n"
            
            # –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å, –µ—Å–ª–∏ –µ—Å—Ç—å
            if product.total_value_usd and product.total_value_usd > 0:
                text += f"   üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: ${product.total_value_usd:.2f}\n" if user.language == "ru" else f"   üí∞ –ê—Ä–∑–∏—à: ${product.total_value_usd:.2f}\n"
            
            # –î–æ–±–∞–≤–ª—è–µ–º –¥–∞—Ç—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            text += f"   üìÖ –î–æ–±–∞–≤–ª–µ–Ω: {product.created_at.strftime('%d.%m.%Y')}\n"
            
            if i < end_idx:
                text += "\n"
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
        await state.update_data(products_page=current_page)
        
        # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
        from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
        keyboard = []
        
        if total_pages > 1:
            if current_page > 1:
                keyboard.append(
                    InlineKeyboardButton(
                        text="‚óÄÔ∏è –ù–∞–∑–∞–¥" if user.language == "ru" else "‚óÄÔ∏è –ë–æ–∑–≥–∞—à—Ç",
                        callback_data=f"prev_page_{current_page-1}"
                    )
                )
            
            if current_page < total_pages:
                keyboard.append(
                    InlineKeyboardButton(
                        text="–í–ø–µ—Ä–µ–¥ ‚ñ∂Ô∏è" if user.language == "ru" else "–û—ë–¥ ‚ñ∂Ô∏è",
                        callback_data=f"next_page_{current_page+1}"
                    )
                )
        
        # –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π
        if len(products_to_show) == 1:
            product = products_to_show[0]
            keyboard.append(
                InlineKeyboardButton(
                    text="üîç –ü–æ–¥—Ä–æ–±–Ω–µ–µ" if user.language == "ru" else "üîç –¢–∞—Ñ—Å–∏–ª–æ—Ç",
                    callback_data=f"view_product_{product.id}"
                )
            )
        
        reply_markup = InlineKeyboardMarkup(inline_keyboard=[keyboard]) if keyboard else None
        
        await message.answer(
            text,
            reply_markup=reply_markup,
            parse_mode="HTML"
        )

from aiogram.types import CallbackQuery

@router.callback_query(F.data.startswith("prev_page_"))
async def prev_page(callback: CallbackQuery, state: FSMContext):
    """–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"""
    page_num = int(callback.data.split("_")[2])
    await state.update_data(products_page=page_num)
    
    # –ü–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
    await my_products_list(callback.message, state)
    await callback.answer()

@router.callback_query(F.data.startswith("next_page_"))
async def next_page(callback: CallbackQuery, state: FSMContext):
    """–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"""
    page_num = int(callback.data.split("_")[2])
    await state.update_data(products_page=page_num)
    
    # –ü–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
    await my_products_list(callback.message, state)
    await callback.answer()
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\handlers\client\products\__init__.py =====
"""
–ú–æ–¥—É–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ (—Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ –ø–æ–¥–º–æ–¥—É–ª–∏)
"""
from aiogram import Router

from .main import router as main_router
from .add_product import router as add_product_router
from .view_products import router as view_products_router
from .check_track import router as check_track_router
from .product_details import router as product_details_router
from .edit_product import router as edit_product_router
from .export_products import router as export_products_router

# –°–æ–∑–¥–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
products_router = Router()

# –í–∫–ª—é—á–∞–µ–º –≤—Å–µ –ø–æ–¥—Ä–æ—É—Ç–µ—Ä—ã
products_router.include_router(main_router)
products_router.include_router(add_product_router)
products_router.include_router(view_products_router)
products_router.include_router(check_track_router)
products_router.include_router(product_details_router)
products_router.include_router(edit_product_router)
products_router.include_router(export_products_router)

__all__ = ['products_router']
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\keyboards\admin.py =====
# keyboards/admin.py - –¥–æ–ø–æ–ª–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.utils.keyboard import InlineKeyboardBuilder

def get_admin_main_keyboard(role: str = "admin_cn"):
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω–∞"""
    keyboard = InlineKeyboardBuilder()
    
    # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∞–¥–º–∏–Ω–æ–≤
    keyboard.button(text="üì¶ –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫-–∫–æ–¥", callback_data="admin_add_product")
    keyboard.button(text="üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã", callback_data="admin_update_status")
    keyboard.button(text="üìä –û—Ç—á–µ—Ç—ã", callback_data="admin_reports")
    keyboard.button(text="üë®‚Äçüíº –ü—Ä–æ—Ñ–∏–ª—å", callback_data="admin_profile")
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    keyboard.button(text="üìã –í—Å–µ —Ç–æ–≤–∞—Ä—ã", callback_data="admin_all_products")
    keyboard.button(text="üîç –ü–æ–∏—Å–∫", callback_data="admin_search")
    
    # –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
    if role == "admin_cn":
        keyboard.button(text="üá®üá≥ –ö–∏—Ç–∞–π—Å–∫–∏–π —Å–∫–ª–∞–¥", callback_data="admin_china_warehouse")
    elif role == "admin_tj":
        keyboard.button(text="üáπüáØ –¢–∞–¥–∂–∏–∫—Å–∫–∏–π —Å–∫–ª–∞–¥", callback_data="admin_tj_warehouse")
    
    keyboard.button(text="‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏", callback_data="admin_settings")
    keyboard.button(text="üîô –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="main_menu")
    
    keyboard.adjust(2, 2, 2, 1, 1)
    return keyboard.as_markup()

def get_status_update_menu_keyboard():
    """–ú–µ–Ω—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤"""
    keyboard = InlineKeyboardBuilder()
    
    keyboard.button(text="üîç –ü–æ —Ç—Ä–µ–∫-–∫–æ–¥—É", callback_data="update_by_track")
    keyboard.button(text="üìÖ –ü–æ –¥–∞—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫–∏", callback_data="update_by_date")
    keyboard.button(text="üìã –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ", callback_data="update_bulk")
    keyboard.button(text="üîô –ù–∞–∑–∞–¥", callback_data="admin_menu")
    
    keyboard.adjust(2, 1, 1)
    return keyboard.as_markup()

def get_status_keyboard(is_bulk: bool = False):
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤—ã–±–æ—Ä–∞ —Å—Ç–∞—Ç—É—Å–∞"""
    statuses = [
        ("CREATED", "üìù –°–æ–∑–¥–∞–Ω"),
        ("IN_CHINA_WAREHOUSE", "üá®üá≥ –í –ö–∏—Ç–∞–µ"),
        ("IN_TRANSIT", "‚úàÔ∏è –í –ø—É—Ç–∏"),
        ("ARRIVED_TJ", "üáπüáØ –ü—Ä–∏–±—ã–ª –≤ TJ"),
        ("READY_FOR_PICKUP", "‚úÖ –ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ"),
        ("DELIVERED", "üì¶ –î–æ—Å—Ç–∞–≤–ª–µ–Ω"),
        ("CANCELLED", "‚ùå –û—Ç–º–µ–Ω–µ–Ω"),
        ("PROBLEM", "‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞"),
    ]
    
    keyboard = InlineKeyboardBuilder()
    
    for status_code, status_text in statuses:
        callback_data = f"bulk_status_{status_code}" if is_bulk else f"set_status_{status_code}"
        keyboard.button(text=status_text, callback_data=callback_data)
    
    keyboard.button(text="üîô –ù–∞–∑–∞–¥", callback_data="admin_update_status")
    keyboard.adjust(2, 2, 2, 2, 1)
    return keyboard.as_markup()

def get_reports_keyboard():
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤"""
    keyboard = InlineKeyboardBuilder()
    
    keyboard.button(text="üì¶ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –∑–∞ –º–µ—Å—è—Ü", callback_data="report_monthly_delivered")
    keyboard.button(text="üì• –ü—Ä–∏–Ω—è—Ç–æ –∑–∞ –º–µ—Å—è—Ü", callback_data="report_monthly_received")
    keyboard.button(text="üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç", callback_data="report_financial")
    keyboard.button(text="üë• –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π", callback_data="report_user_statistics")
    keyboard.button(text="üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel", callback_data="report_database_export")
    keyboard.button(text="üñ•Ô∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ", callback_data="admin_system_info")
    keyboard.button(text="üîô –ù–∞–∑–∞–¥", callback_data="admin_menu")
    
    keyboard.adjust(2, 2, 2, 1)
    return keyboard.as_markup()

def get_back_to_admin_keyboard():
    """–ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ –≤ –∞–¥–º–∏–Ω-–º–µ–Ω—é"""
    keyboard = InlineKeyboardBuilder()
    keyboard.button(text="üîô –ù–∞–∑–∞–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å", callback_data="admin_menu")
    return keyboard.as_markup()
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\keyboards\calculator.py =====
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.utils.keyboard import ReplyKeyboardBuilder

def get_calculator_route_keyboard(language: str = "ru"):
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–∞—Ä—à—Ä—É—Ç–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞"""
    texts = {
        "ru": {
            "urumchi": "Urumchi ‚Üí Khujand",
            "yiwu": "Yiwu ‚Üí Khujand",
            "back": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
            "cancel": "‚ùå –û—Ç–º–µ–Ω–∞"
        },
        "tj": {
            "urumchi": "–£—Ä—É–º—á”£ ‚Üí –•—É“∑–∞–Ω–¥",
            "yiwu": "–ò–≤—É ‚Üí –•—É“∑–∞–Ω–¥",
            "back": "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç",
            "cancel": "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"
        }
    }
    
    t = texts[language]
    keyboard = ReplyKeyboardBuilder()
    keyboard.add(KeyboardButton(text=t["urumchi"]))
    keyboard.add(KeyboardButton(text=t["yiwu"]))
    keyboard.add(KeyboardButton(text=t["back"]))
    keyboard.add(KeyboardButton(text=t["cancel"]))
    keyboard.adjust(2, 2)
    return keyboard.as_markup(resize_keyboard=True)
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\keyboards\client.py =====
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.utils.keyboard import ReplyKeyboardBuilder


def get_language_keyboard():
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞"""
    keyboard = ReplyKeyboardBuilder()
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—á–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–∂–∏–¥–∞—é—Ç—Å—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ
    keyboard.add(KeyboardButton(text="üá∑üá∫ –†—É—Å—Å–∫–∏–π"))
    keyboard.add(KeyboardButton(text="üáπüáØ –¢–æ“∑–∏–∫”£"))
    
    keyboard.adjust(2)
    return keyboard.as_markup(
        resize_keyboard=True,
        one_time_keyboard=True  # –°–∫—Ä—ã—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞
    )

def get_main_menu_keyboard(language: str = "ru"):
    texts = {
        "ru": {
            "track_codes": "üì¶ –¢–†–ï–ö –ö–û–î–´",
            "profile": "üë§ –ü–†–û–§–ò–õ–¨",
            "address": "üìç –ê–î–†–ï–°",
            "calculator": "üßÆ –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†",
            "door_delivery": "üöö –î–û–°–¢–ê–í–ö–ê –î–û –î–í–ï–†–ï–ô",
            "forbidden": "üö´ –ó–ê–ü–†–ï–©–Å–ù–ù–´–ï –¢–û–í–ê–†–´",
            "course": "üéì –ë–ï–°–ü–õ–ê–¢–ù–´–ô –ö–£–†–°",
            "support": "üí¨ –ü–û–î–î–ï–†–ñ–ö–ê"
        },
        "tj": {
            "track_codes": "üì¶ –†–ê–ö–ê–ú“≤–û–ò –¢–ê–ú–û–®–û–ë–ò–ù",
            "profile": "üë§ –ü–†–û–§–ò–õ",
            "address": "üìç –ê–î–†–ï–°",
            "calculator": "üßÆ –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†",
            "door_delivery": "üöö –†–ê–°–û–ù–ò–î–ê–ù –¢–û –î–ê–†",
            "forbidden": "üö´ –ú–ê“≤–°–£–õ–û–¢“≤–û–ò –ú–ê–ú–ù–£–ê",
            "course": "üéì –ö–£–†–°–ò –ë–ï–ü–£–õ",
            "support": "üí¨ –î–ê–°–¢–ì–ò–†”¢"
        }
    }
    
    t = texts[language]
    keyboard = ReplyKeyboardBuilder()
    keyboard.add(KeyboardButton(text=t["track_codes"]))
    keyboard.add(KeyboardButton(text=t["profile"]))
    keyboard.add(KeyboardButton(text=t["address"]))
    keyboard.add(KeyboardButton(text=t["calculator"]))
    keyboard.add(KeyboardButton(text=t["door_delivery"]))
    keyboard.add(KeyboardButton(text=t["forbidden"]))
    keyboard.add(KeyboardButton(text=t["course"]))
    keyboard.add(KeyboardButton(text=t["support"]))
    keyboard.adjust(2, 2, 2, 2)
    return keyboard.as_markup(resize_keyboard=True)

def get_back_cancel_keyboard(language: str = "ru"):
    texts = {
        "ru": {"back": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "cancel": "‚ùå –û—Ç–º–µ–Ω–∞"},
        "tj": {"back": "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç", "cancel": "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"}
    }
    
    t = texts[language]
    keyboard = ReplyKeyboardBuilder()
    keyboard.add(KeyboardButton(text=t["back"]))
    keyboard.add(KeyboardButton(text=t["cancel"]))
    keyboard.adjust(2)
    return keyboard.as_markup(resize_keyboard=True)

def get_track_codes_keyboard(language: str = "ru"):
    texts = {
        "ru": {
            "my_track": "–ú–æ–∏ —Ç—Ä–µ–∫-–∫–æ–¥—ã",
            "check_track": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–µ–∫-–∫–æ–¥",
            "add_track": "–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫-–∫–æ–¥",
            "edit_track": "–ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä",
            # "export": "–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel",  # –£–ë–ò–†–ê–ï–ú –≠–¢–£ –°–¢–†–û–ö–£
            "back": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
        },
        "tj": {
            "my_track": "–†–∞–º–∑“≥–æ–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω–∏ –º–∞–Ω",
            "check_track": "–¢–∞—Ñ—Ç–∏—à –∫–∞—Ä–¥–∞–Ω–∏ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω",
            "add_track": "–ò–ª–æ–≤–∞ –∫–∞—Ä–¥–∞–Ω–∏ —Ä–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω",
            "edit_track": "–¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç",
            # "export": "–≠–∫—Å–ø–æ—Ä—Ç –±–∞ Excel",  # –£–ë–ò–†–ê–ï–ú –≠–¢–£ –°–¢–†–û–ö–£
            "back": "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"
        }
    }
    
    t = texts[language]
    keyboard = ReplyKeyboardBuilder()
    keyboard.add(KeyboardButton(text=t["my_track"]))
    keyboard.add(KeyboardButton(text=t["check_track"]))
    keyboard.add(KeyboardButton(text=t["add_track"]))
    keyboard.add(KeyboardButton(text=t["edit_track"]))
    # keyboard.add(KeyboardButton(text=t["export"]))  # –£–ë–ò–†–ê–ï–ú –≠–¢–£ –°–¢–†–û–ö–£
    keyboard.add(KeyboardButton(text=t["back"]))
    keyboard.adjust(2, 2, 1)  # –ú–µ–Ω—è–µ–º —Ä–∞—Å–∫–ª–∞–¥–∫—É
    return keyboard.as_markup(resize_keyboard=True)
    
def get_profile_keyboard(language: str = "ru"):
    texts = {
        "ru": {
            "edit_name": "üìù –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è",
            "edit_region": "üìù –ò–∑–º–µ–Ω–∏—Ç—å —Ä–µ–≥–∏–æ–Ω"
        },
        "tj": {
            "edit_name": "üìù –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –Ω–æ–º",
            "edit_region": "üìù –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –º–∏–Ω—Ç–∞“õ–∞"
        }
    }
    
    t = texts[language]
    keyboard = ReplyKeyboardBuilder()
    keyboard.add(KeyboardButton(text=t["edit_name"]))
    keyboard.add(KeyboardButton(text=t["edit_region"]))
    keyboard.add(KeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥" if language == "ru" else "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"))
    keyboard.adjust(2, 1)
    return keyboard.as_markup(resize_keyboard=True)

def get_country_keyboard(language: str = "ru"):
    keyboard = ReplyKeyboardBuilder()
    keyboard.add(KeyboardButton(text="üáπüáØ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω"))
    keyboard.add(KeyboardButton(text="üá®üá≥ –ö–∏—Ç–∞–π"))
    keyboard.add(KeyboardButton(text="üá∫üáø –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω"))
    keyboard.add(KeyboardButton(text="üá∞üáø –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω"))
    keyboard.add(KeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥" if language == "ru" else "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"))
    keyboard.adjust(2, 2, 1)
    return keyboard.as_markup(resize_keyboard=True)

def get_course_platform_keyboard(language: str = "ru"):
    keyboard = ReplyKeyboardBuilder()
    keyboard.add(KeyboardButton(text="Taobao"))
    keyboard.add(KeyboardButton(text="Pinduoduo"))
    keyboard.add(KeyboardButton(text="Alibaba"))
    keyboard.add(KeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥" if language == "ru" else "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç"))
    keyboard.adjust(1, 1, 1, 1)
    return keyboard.as_markup(resize_keyboard=True)

# –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
def get_calculator_yes_no_keyboard(language: str = "ru"):
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞"""
    texts = {
        "ru": {
            "yes": "‚úÖ –î–∞, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å",
            "no": "‚ùå –ù–µ—Ç, –≤–µ—Ä–Ω—É—Ç—å—Å—è"
        },
        "tj": {
            "yes": "‚úÖ “≤–∞, –¥–∞–≤–æ–º –¥–æ–¥–∞–Ω",
            "no": "‚ùå –ù–µ, –±–∞—Ä–≥–∞—à—Ç–∞–Ω"
        }
    }
    
    t = texts[language]
    keyboard = ReplyKeyboardBuilder()
    keyboard.add(KeyboardButton(text=t["yes"]))
    keyboard.add(KeyboardButton(text=t["no"]))
    keyboard.adjust(2)
    return keyboard.as_markup(resize_keyboard=True)
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\keyboards\products.py =====
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.utils.keyboard import ReplyKeyboardBuilder

def get_product_categories_keyboard(language: str = "ru"):
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞"""
    categories = {
        "ru": {
            "electronics": "üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
            "clothing": "üëï –û–¥–µ–∂–¥–∞",
            "shoes": "üëü –û–±—É–≤—å",
            "home_appliances": "üè† –ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞",
            "beauty": "üíÑ –ö–æ—Å–º–µ—Ç–∏–∫–∞",
            "toys": "üß∏ –ò–≥—Ä—É—à–∫–∏",
            "automotive": "üöó –ê–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–∏",
            "sports": "‚öΩ –°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã",
            "other": "üì¶ –î—Ä—É–≥–æ–µ",
            "back": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
            "cancel": "‚ùå –û—Ç–º–µ–Ω–∞"
        },
        "tj": {
            "electronics": "üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
            "clothing": "üëï –õ–∏–±–æ—Å",
            "shoes": "üëü –ü–æ–π–∞—Ñ–∑–æ–ª",
            "home_appliances": "üè† –ê—Å–±–æ–±“≥–æ–∏ —Ö–æ–Ω–∞–≥”£",
            "beauty": "üíÑ –ö–æ—Å–º–µ—Ç–∏–∫–∞",
            "toys": "üß∏ –ë–æ–∑–∏—á–∞“≥–æ",
            "automotive": "üöó “ö–∏—Å–º“≥–æ–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª",
            "sports": "‚öΩ –ê—à—ë“≥–æ–∏ –≤–∞—Ä–∑–∏—à”£",
            "other": "üì¶ –î–∏–≥–∞—Ä",
            "back": "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç",
            "cancel": "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"
        }
    }
    
    t = categories[language]
    keyboard = ReplyKeyboardBuilder()
    
    keyboard.add(KeyboardButton(text=t["electronics"]))
    keyboard.add(KeyboardButton(text=t["clothing"]))
    keyboard.add(KeyboardButton(text=t["shoes"]))
    keyboard.add(KeyboardButton(text=t["home_appliances"]))
    keyboard.add(KeyboardButton(text=t["beauty"]))
    keyboard.add(KeyboardButton(text=t["toys"]))
    keyboard.add(KeyboardButton(text=t["automotive"]))
    keyboard.add(KeyboardButton(text=t["sports"]))
    keyboard.add(KeyboardButton(text=t["other"]))
    keyboard.add(KeyboardButton(text=t["back"]))
    keyboard.add(KeyboardButton(text=t["cancel"]))
    
    keyboard.adjust(2, 2, 2, 2, 1, 2)
    return keyboard.as_markup(resize_keyboard=True)

def get_special_info_keyboard(language: str = "ru"):
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–≤–∞—Ä–µ"""
    texts = {
        "ru": {
            "fragile": "–•—Ä—É–ø–∫–∏–π",
            "battery": "–° –±–∞—Ç–∞—Ä–µ–µ–π",
            "liquid": "–ñ–∏–¥–∫–æ—Å—Ç—å",
            "none": "–ù–µ—Ç –æ—Å–æ–±—ã—Ö —Å–≤–æ–π—Å—Ç–≤",
            "back": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
            "cancel": "‚ùå –û—Ç–º–µ–Ω–∞"
        },
        "tj": {
            "fragile": "–ù–æ–∑—É–∫",
            "battery": "–ë–æ –±–∞—Ç–∞—Ä–µ—è",
            "liquid": "–ú–æ–µ—ä",
            "none": "–•—É—Å—É—Å–∏—è—Ç–∏ –º–∞—Ö—Å—É—Å –Ω–µ—Å—Ç",
            "back": "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç",
            "cancel": "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"
        }
    }
    
    t = texts[language]
    keyboard = ReplyKeyboardBuilder()
    
    keyboard.add(KeyboardButton(text=t["fragile"]))
    keyboard.add(KeyboardButton(text=t["battery"]))
    keyboard.add(KeyboardButton(text=t["liquid"]))
    keyboard.add(KeyboardButton(text=t["none"]))
    keyboard.add(KeyboardButton(text=t["back"]))
    keyboard.add(KeyboardButton(text=t["cancel"]))
    
    keyboard.adjust(2, 2, 2)
    return keyboard.as_markup(resize_keyboard=True)

def get_edit_product_keyboard(language: str = "ru"):
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    texts = {
        "ru": {
            "edit_name": "üìù –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ",
            "edit_desc": "üìù –ò–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ",
            "edit_quantity": "üî¢ –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ",
            "edit_price": "üí∞ –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É",
            "edit_weight": "‚öñÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –≤–µ—Å",
            "edit_category": "üè∑Ô∏è –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é",
            "back": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
            "cancel": "‚ùå –û—Ç–º–µ–Ω–∞"
        },
        "tj": {
            "edit_name": "üìù –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –Ω–æ–º",
            "edit_desc": "üìù –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ —Ç–∞–≤—Å–∏—Ñ",
            "edit_quantity": "üî¢ –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –º–∏“õ–¥–æ—Ä",
            "edit_price": "üí∞ –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –Ω–∞—Ä—Ö",
            "edit_weight": "‚öñÔ∏è –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –≤–∞–∑–Ω",
            "edit_category": "üè∑Ô∏è –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ –≥—É—Ä”Ø“≥",
            "back": "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç",
            "cancel": "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"
        }
    }
    
    t = texts[language]
    keyboard = ReplyKeyboardBuilder()
    
    keyboard.add(KeyboardButton(text=t["edit_name"]))
    keyboard.add(KeyboardButton(text=t["edit_desc"]))
    keyboard.add(KeyboardButton(text=t["edit_quantity"]))
    keyboard.add(KeyboardButton(text=t["edit_price"]))
    keyboard.add(KeyboardButton(text=t["edit_weight"]))
    keyboard.add(KeyboardButton(text=t["edit_category"]))
    keyboard.add(KeyboardButton(text=t["back"]))
    keyboard.add(KeyboardButton(text=t["cancel"]))
    
    keyboard.adjust(2, 2, 2, 2)
    return keyboard.as_markup(resize_keyboard=True)

def get_yes_no_keyboard(language: str = "ru", prefix: str = ""):
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –î–∞/–ù–µ—Ç"""
    texts = {
        "ru": {
            "yes": "‚úÖ –î–∞",
            "no": "‚ùå –ù–µ—Ç",
            "back": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
            "cancel": "‚ùå –û—Ç–º–µ–Ω–∞"
        },
        "tj": {
            "yes": "‚úÖ “≤–∞",
            "no": "‚ùå –ù–µ",
            "back": "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç",
            "cancel": "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω"
        }
    }
    
    t = texts[language]
    keyboard = ReplyKeyboardBuilder()
    
    keyboard.add(KeyboardButton(text=t["yes"]))
    keyboard.add(KeyboardButton(text=t["no"]))
    keyboard.add(KeyboardButton(text=t["back"]))
    keyboard.add(KeyboardButton(text=t["cancel"]))
    
    keyboard.adjust(2, 2)
    return keyboard.as_markup(resize_keyboard=True)
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\keyboards\__init__.py =====

===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\locales\ru.json =====
{
    "welcome": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ –º–µ–Ω—é:",
    "main_menu": "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
    "track_codes": "üì¶ –¢–†–ï–ö –ö–û–î–´",
    "profile": "üë§ –ü–†–û–§–ò–õ–¨",
    "address": "üìç –ê–î–†–ï–°",
    "calculator": "üßÆ –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†",
    "door_delivery": "üöö –î–û–°–¢–ê–í–ö–ê –î–û –î–í–ï–†–ï–ô",
    "forbidden": "üö´ –ó–ê–ü–†–ï–©–Å–ù–ù–´–ï –¢–û–í–ê–†–´",
    "course": "üéì –ë–ï–°–ü–õ–ê–¢–ù–´–ô –ö–£–†–°",
    "support": "üí¨ –ü–û–î–î–ï–†–ñ–ö–ê",
    "back": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
    "cancel": "‚ùå –û—Ç–º–µ–Ω–∞",
    "choose_language": "üá∑üá∫ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫:",
    "share_phone": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:",
    "phone_shared": "‚úÖ –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!",
    "no_products": "‚ùó –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤",
    "product_status": {
      "created": "–°–æ–∑–¥–∞–Ω",
      "china_warehouse": "–ù–∞ —Å–∫–ª–∞–¥–µ –≤ –ö–∏—Ç–∞–µ",
      "in_transit": "–í –ø—É—Ç–∏",
      "tajikistan_warehouse": "–ù–∞ —Å–∫–ª–∞–¥–µ –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–µ",
      "delivered": "–î–æ—Å—Ç–∞–≤–ª–µ–Ω",
      "completed": "–ó–∞–≤–µ—Ä—à–µ–Ω"
    },
    "door_delivery_status": {
      "pending": "–í –æ–∂–∏–¥–∞–Ω–∏–∏",
      "delivered": "–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ",
      "cancelled": "–û—Ç–º–µ–Ω–µ–Ω–æ"
    },
    "forbidden_list": [
      "–û—Ä—É–∂–∏–µ –∏ –±–æ–µ–ø—Ä–∏–ø–∞—Å—ã",
      "–ù–∞—Ä–∫–æ—Ç–∏—á–µ—Å–∫–∏–µ –≤–µ—â–µ—Å—Ç–≤–∞",
      "–í–∑—Ä—ã–≤—á–∞—Ç—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã",
      "–ñ–∏–≤–æ—Ç–Ω—ã–µ –∏ —Ä–∞—Å—Ç–µ–Ω–∏—è –ø–æ–¥ –æ—Ö—Ä–∞–Ω–æ–π",
      "–ü–æ—Ä–Ω–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è",
      "–õ–µ–∫–∞—Ä—Å—Ç–≤–∞ –±–µ–∑ —Ä–µ—Ü–µ–ø—Ç–∞",
      "–ê–ª–∫–æ–≥–æ–ª—å–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è",
      "–î—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã–µ –º–µ—Ç–∞–ª–ª—ã –∏ –∫–∞–º–Ω–∏",
      "–†–∞–¥–∏–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã",
      "–ü–æ–¥–¥–µ–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã"
    ],
    "support_info": {
      "phone": "+992 123 45 67 89",
      "email": "support@example.com",
      "hours": "9:00 - 18:00 (–ü–Ω-–ü—Ç)"
    },
    "admin": {
      "welcome": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!",
      "add_product": "‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä(—ã)",
      "bulk_update": "üîÑ –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",
      "reports": "üìä –û—Ç—á—ë—Ç—ã",
      "confirm_arrival": "‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø—Ä–∏–±—ã—Ç–∏–µ",
      "update_status": "‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å",
      "door_delivery_manage": "üöö –î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–µ–π",
      "week_report": "üìÖ –ó–∞ –Ω–µ–¥–µ–ª—é",
      "month_report": "üìÜ –ó–∞ –º–µ—Å—è—Ü",
      "year_report": "üìà –ó–∞ –≥–æ–¥"
    },
    "errors": {
      "invalid_input": "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥",
      "not_found": "‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ",
      "access_denied": "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω",
      "internal_error": "‚ùå –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",
      "try_again": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑"
    },
    "success": {
      "updated": "‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ",
      "created": "‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ",
      "deleted": "‚úÖ –£—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ",
      "sent": "‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ"
    }
  }
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\locales\tj.json =====
{
    "welcome": "–•—É—à –æ–º–∞–¥–µ–¥! –ê–º–∞–ª—Ä–æ –∞–∑ –º–µ–Ω—é –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:",
    "main_menu": "–ú–µ–Ω—é–∏ –∞—Å–æ—Å”£",
    "track_codes": "üì¶ –†–ê–ö–ê–ú“≤–û–ò –¢–ê–ú–û–®–û–ë–ò–ù",
    "profile": "üë§ –ü–†–û–§–ò–õ",
    "address": "üìç –ê–î–†–ï–°",
    "calculator": "üßÆ –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†",
    "door_delivery": "üöö –†–ê–°–û–ù–ò–î–ê–ù –¢–û –î–ê–†",
    "forbidden": "üö´ –ú–ê“≤–°–£–õ–û–¢“≤–û–ò –ú–ê–ú–ù–£–ê",
    "course": "üéì –ö–£–†–°–ò –ë–ï–ü–£–õ",
    "support": "üí¨ –î–ê–°–¢–ì–ò–†”¢",
    "back": "‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç",
    "cancel": "‚ùå –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω",
    "choose_language": "üáπüáØ –õ—É—Ç—Ñ–∞–Ω, –∑–∞–±–æ–Ω–∏ —Ö—É–¥—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥:",
    "share_phone": "–õ—É—Ç—Ñ–∞–Ω, –±–∞—Ä–æ–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ç—Å–∏—è —Ä–∞“õ–∞–º–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∏ —Ö—É–¥—Ä–æ –º—É–±–æ–¥–∏–ª–∞ –∫—É–Ω–µ–¥:",
    "phone_shared": "‚úÖ –†–∞“õ–∞–º–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –±–æ–º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç –∑–∞—Ö–∏—Ä–∞ –∫–∞—Ä–¥–∞ —à—É–¥!",
    "no_products": "‚ùó –®—É–º–æ —Ç–æ “≥–æ–ª –º–∞“≥—Å—É–ª–æ—Ç–∏ –∏–ª–æ–≤–∞—à—É–¥–∞ –Ω–∞–¥–æ—Ä–µ–¥",
    "product_status": {
      "created": "–°–æ—Ö—Ç–∞ —à—É–¥–∞–∞—Å—Ç",
      "china_warehouse": "–î–∞—Ä –∞–Ω–±–æ—Ä–∏ –ß–∏–Ω",
      "in_transit": "–î–∞—Ä —Ä–æ“≥",
      "tajikistan_warehouse": "–î–∞—Ä –∞–Ω–±–æ—Ä–∏ –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω",
      "delivered": "–†–∞—Å–æ–Ω–∏–¥–∞ —à—É–¥",
      "completed": "–ê–Ω“∑–æ–º —ë—Ñ—Ç"
    },
    "door_delivery_status": {
      "pending": "–î–∞—Ä –∏–Ω—Ç–∏–∑–æ—Ä”£",
      "delivered": "–†–∞—Å–æ–Ω–∏–¥–∞ —à—É–¥",
      "cancelled": "–ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞ —à—É–¥"
    },
    "forbidden_list": [
      "–û—Ä—É–∂–∏–µ –≤–∞ –±–æ—ë–º–∏–ª“≥–æ",
      "–ú–æ–¥–¥–∞“≥–æ–∏ –Ω–∞—Ä–∫–æ—Ç–∏–∫”£",
      "–ú–∞–≤–æ–¥“≥–æ–∏ –ø–æ—Ä—Ö–µ–∑",
      "“≤–∞–π–≤–æ–Ω–æ—Ç –≤–∞ –Ω–∞–±–æ—Ç–æ—Ç–∏ –∑–µ—Ä–∏ “≥–∏–º–æ—è—Ç",
      "–ú–∞“≥—Å—É–ª–æ—Ç–∏ –ø–æ—Ä–Ω–æ–≥—Ä–∞—Ñ”£",
      "–î–æ—Ä—É“≥–æ –±–∏–¥—É–Ω–∏ —Ç–∞–≤—Å–∏—è–Ω–æ–º–∞",
      "–ú–∞“≥—Å—É–ª–æ—Ç–∏ —Å–ø–∏—Ä—Ç”£",
      "–§—É–ª—É–∑–æ—Ç–∏ –≥–∞—Ä–æ–Ω–±–∞“≥–æ –≤–∞ —Å–∞–Ω–≥—É “∑–∞–≤“≥–∞—Ä",
      "–ú–∞–≤–æ–¥“≥–æ–∏ —Ä–∞–¥–∏–æ–∞–∫—Ç–∏–≤”£",
      "–ú–∞“≥—Å—É–ª–æ—Ç–∏ “õ–∞–ª–±–∞–∫”£"
    ],
    "support_info": {
      "phone": "+992 123 45 67 89",
      "email": "support@example.com",
      "hours": "9:00 - 18:00 (–î—É—à–∞–Ω–±–µ-“∂—É–º—ä–∞)"
    },
    "admin": {
      "welcome": "–ë–∞ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Ö—É—à –æ–º–∞–¥–µ–¥!",
      "add_product": "‚ûï –ò–ª–æ–≤–∞ –∫–∞—Ä–¥–∞–Ω–∏ –º–∞“≥—Å—É–ª–æ—Ç(“≥–æ)",
      "bulk_update": "üîÑ –ù–∞–≤—Å–æ–∑–∏–∏ –æ–º–º–∞–≤”£",
      "reports": "üìä “≤–∏—Å–æ–±–æ—Ç“≥–æ",
      "confirm_arrival": "‚úÖ –¢–∞—Å–¥–∏“õ –∫–∞—Ä–¥–∞–Ω–∏ –æ–º–∞–¥–∞–Ω",
      "update_status": "‚úèÔ∏è –¢–∞“ì–π–∏—Ä –¥–æ–¥–∞–Ω–∏ —Å—Ç–∞—Ç—É—Å",
      "door_delivery_manage": "üöö –†–∞—Å–æ–Ω–∏–¥–∞–Ω —Ç–æ –¥–∞—Ä",
      "week_report": "üìÖ –ë–∞—Ä–æ–∏ “≥–∞—Ñ—Ç–∞",
      "month_report": "üìÜ –ë–∞—Ä–æ–∏ –º–æ“≥",
      "year_report": "üìà –ë–∞—Ä–æ–∏ —Å–æ–ª"
    },
    "errors": {
      "invalid_input": "‚ùå –í–æ—Ä–∏–¥–æ—Ç–∏ –Ω–æ–¥—É—Ä—É—Å—Ç",
      "not_found": "‚ùå –Å—Ñ—Ç –Ω–∞—à—É–¥",
      "access_denied": "‚ùå –î–∞—Å—Ç—Ä–∞—Å–∏ –º–∞–º–Ω”Ø—ä",
      "internal_error": "‚ùå –•–∞—Ç–æ–∏ –¥–æ—Ö–∏–ª–∏–∏ —Å–µ—Ä–≤–µ—Ä",
      "try_again": "–õ—É—Ç—Ñ–∞–Ω, –±–æ—Ä–∏ –¥–∏–≥–∞—Ä –∫”Ø—à–∏—à –∫—É–Ω–µ–¥"
    },
    "success": {
      "updated": "‚úÖ –ë–æ–º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç –Ω–∞–≤—Å–æ–∑”£ —à—É–¥",
      "created": "‚úÖ –ë–æ–º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç —Å–æ—Ö—Ç–∞ —à—É–¥",
      "deleted": "‚úÖ –ë–æ–º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç –Ω–µ—Å—Ç –∫–∞—Ä–¥–∞ —à—É–¥",
      "sent": "‚úÖ –ë–æ–º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç —Ñ–∏—Ä–∏—Å—Ç–æ–¥–∞ —à—É–¥"
    }
  }
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\services\calculator.py =====
def calculate_delivery_cost(volume_cubic_meters: float, weight_kg: float, route: str) -> float:
    """
    –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è –æ–ø—Ç–æ–≤–∏–∫–æ–≤ –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º
    
    Args:
        volume_cubic_meters: –û–±—ä–µ–º –≤ –∫—É–±–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∞—Ö
        weight_kg: –í–µ—Å –≤ –∫–∏–ª–æ–≥—Ä–∞–º–º–∞—Ö
        route: –ú–∞—Ä—à—Ä—É—Ç ('Urumchi ‚Üí Khujand' –∏–ª–∏ 'Yiwu ‚Üí Khujand')
        
    Returns:
        –°—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD
    """
    # –¢–∞–±–ª–∏—Ü—ã —Ü–µ–Ω –¥–ª—è Urumchi ‚Üí Khujand
    urumchi_prices = {
        # –¶–µ–Ω–∞ –∑–∞ –∫—É–± (–¥–ª—è –ª–µ–≥–∫–∏—Ö –æ–±—ä–µ–º–Ω—ã—Ö –≥—Ä—É–∑–æ–≤)
        "price_per_cubic": {
            (0, 100): 170,    # > 100 kg
            (101, 150): 180,  # 101‚Äì150
            (151, 200): 200,  # 151‚Äì200
        },
        # –¶–µ–Ω–∞ –∑–∞ –∫–≥ (–¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –≥—Ä—É–∑–æ–≤)
        "price_per_kg": {
            (230, 250): 0.90,   # 230‚Äì250
            (251, 300): 0.80,   # 251‚Äì300
            (301, 350): 0.75,   # 301‚Äì350
            (351, 450): 0.70,   # 351‚Äì450
            (451, 500): 0.65,   # 451‚Äì500
            (551, 650): 0.60,   # 551‚Äì650
            (651, 850): 0.55,   # 651‚Äì850
            (851, 950): 0.50,   # 851‚Äì950
            (951, 1500): 0.45,  # 951‚Äì1500
        }
    }
    
    # –¢–∞–±–ª–∏—Ü—ã —Ü–µ–Ω –¥–ª—è Yiwu ‚Üí Khujand
    yiwu_prices = {
        # –¶–µ–Ω–∞ –∑–∞ –∫—É–± (–¥–ª—è –ª–µ–≥–∫–∏—Ö –æ–±—ä–µ–º–Ω—ã—Ö –≥—Ä—É–∑–æ–≤)
        "price_per_cubic": {
            (0, 100): 200,    # > 100 kg
            (101, 150): 210,  # 101‚Äì150
            (151, 200): 230,  # 151‚Äì200
        },
        # –¶–µ–Ω–∞ –∑–∞ –∫–≥ (–¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –≥—Ä—É–∑–æ–≤)
        "price_per_kg": {
            (201, 250): 1.03,   # 201‚Äì250
            (251, 300): 0.93,   # 251‚Äì300
            (301, 350): 0.88,   # 301‚Äì350
            (351, 450): 0.83,   # 351‚Äì450
            (451, 500): 0.78,   # 451‚Äì500
            (501, 650): 0.73,   # 501‚Äì650
            (651, 900): 0.68,   # 651‚Äì900
            (951, 1000): 0.63,  # 951‚Äì1000
            (1001, 1500): 0.58, # 1001‚Äì1500
        }
    }
    
    # –í—ã–±–∏—Ä–∞–µ–º –Ω—É–∂–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Ü–µ–Ω
    if route == "Urumchi ‚Üí Khujand":
        prices = urumchi_prices
    else:  # Yiwu ‚Üí Khujand
        prices = yiwu_prices
    
    # –í–´–ë–û–† –†–ê–°–ß–ï–¢–ê –ü–û –õ–û–ì–ò–ö–ï:
    # 1. –ï—Å–ª–∏ –≤–µ—Å –¥–æ 200 –∫–≥ –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –¶–ï–ù–£ –ó–ê –ö–£–ë
    # 2. –ï—Å–ª–∏ –≤–µ—Å –æ—Ç 201 –∫–≥ –∏ –≤—ã—à–µ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –¶–ï–ù–£ –ó–ê –ö–ì
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏ —Ü–µ–Ω—É –∑–∞ –∫—É–± –∏–ª–∏ –∑–∞ –∫–≥
    use_cubic_price = False
    calculation_type = ""
    price_per_unit = 0
    
    if weight_kg <= 200:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—É –∑–∞ –∫—É–± (–ª–µ–≥–∫–∏–µ –æ–±—ä–µ–º–Ω—ã–µ –≥—Ä—É–∑—ã)
        use_cubic_price = True
        calculation_type = "–ø–æ –æ–±—ä–µ–º—É (—Ü–µ–Ω–∞ –∑–∞ –º¬≥)"
        
        # –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω –≤–µ—Å–∞ –¥–ª—è —Ü–µ–Ω—ã –∑–∞ –∫—É–±
        for (min_weight, max_weight), price in prices["price_per_cubic"].items():
            if min_weight <= weight_kg <= max_weight:
                price_per_unit = price
                return volume_cubic_meters * price
        
        # –ï—Å–ª–∏ –≤–µ—Å –Ω–µ –ø–æ–ø–∞–ª –≤ –¥–∏–∞–ø–∞–∑–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0-100, 101-150, 151-200)
        # —Ç–æ –±–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
        if weight_kg > 150:
            price_per_unit = prices["price_per_cubic"][(151, 200)]
        elif weight_kg > 100:
            price_per_unit = prices["price_per_cubic"][(101, 150)]
        else:
            price_per_unit = prices["price_per_cubic"][(0, 100)]
            
        return volume_cubic_meters * price_per_unit
        
    else:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—É –∑–∞ –∫–≥ (—Ç—è–∂–µ–ª—ã–µ –≥—Ä—É–∑—ã)
        use_cubic_price = False
        calculation_type = "–ø–æ –≤–µ—Å—É (—Ü–µ–Ω–∞ –∑–∞ –∫–≥)"
        
        # –î–ª—è Urumchi –º–∞—Ä—à—Ä—É—Ç–∞ –¥–∏–∞–ø–∞–∑–æ–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 230 –∫–≥
        # –î–ª—è Yiwu –º–∞—Ä—à—Ä—É—Ç–∞ –¥–∏–∞–ø–∞–∑–æ–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 201 –∫–≥
        # –ü–æ—ç—Ç–æ–º—É –¥–ª—è –≤–µ—Å–æ–≤ 201-229 –¥–ª—è Urumchi –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
        if route == "Urumchi ‚Üí Khujand" and weight_kg < 230:
            # –î–ª—è –≤–µ—Å–∞ 201-229 –∫–≥ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—É –∫–∞–∫ –¥–ª—è 230-250
            price_per_unit = prices["price_per_kg"][(230, 250)]
            return weight_kg * price_per_unit
        
        # –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω –≤–µ—Å–∞ –¥–ª—è —Ü–µ–Ω—ã –∑–∞ –∫–≥
        for (min_weight, max_weight), price in prices["price_per_kg"].items():
            if min_weight <= weight_kg <= max_weight:
                price_per_unit = price
                return weight_kg * price
        
        # –ï—Å–ª–∏ –≤–µ—Å –±–æ–ª—å—à–µ 1500 –∫–≥ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
        if weight_kg > 1500:
            # –î–ª—è Urumchi
            if route == "Urumchi ‚Üí Khujand":
                price_per_unit = prices["price_per_kg"][(951, 1500)]
            else:  # Yiwu
                price_per_unit = prices["price_per_kg"][(1001, 1500)]
            return weight_kg * price_per_unit
        
        # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–∫—Ä—ã—Ç–æ –≤—ã—à–µ)
        # –ë–µ—Ä–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
        max_range = max(prices["price_per_kg"].keys(), key=lambda x: x[1])
        price_per_unit = prices["price_per_kg"][max_range]
        return weight_kg * price_per_unit

def calculate_volume(length_m: float, width_m: float, height_m: float) -> float:
    """
    –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–±—ä–µ–º –∫—É–±–∞
    
    Args:
        length_m: –î–ª–∏–Ω–∞ –≤ –º–µ—Ç—Ä–∞—Ö
        width_m: –®–∏—Ä–∏–Ω–∞ –≤ –º–µ—Ç—Ä–∞—Ö
        height_m: –í—ã—Å–æ—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö
        
    Returns:
        –û–±—ä–µ–º –≤ –∫—É–±–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∞—Ö
    """
    return length_m * width_m * height_m

def get_price_table_info(route: str, language: str = "ru") -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∞—Ä–∏—Ñ–∞—Ö –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞
    
    Args:
        route: –ú–∞—Ä—à—Ä—É—Ç
        language: –Ø–∑—ã–∫
        
    Returns:
        –°—Ç—Ä–æ–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–∞—Ä–∏—Ñ–∞—Ö
    """
    if route == "Urumchi ‚Üí Khujand":
        if language == "ru":
            return """üìä <b>–¢–∞—Ä–∏—Ñ—ã Urumchi ‚Üí Khujand:</b>

<b>–î–ª—è –≥—Ä—É–∑–æ–≤ –¥–æ 200 –∫–≥ (—Ü–µ–Ω–∞ –∑–∞ –º¬≥):</b>
> 100 kg: $170 –∑–∞ –º¬≥
101‚Äì150 kg: $180 –∑–∞ –º¬≥
151‚Äì200 kg: $200 –∑–∞ –º¬≥

<b>–î–ª—è –≥—Ä—É–∑–æ–≤ –æ—Ç 201 –∫–≥ (—Ü–µ–Ω–∞ –∑–∞ –∫–≥):</b>
230‚Äì250 kg: $0.90 –∑–∞ –∫–≥
251‚Äì300 kg: $0.80 –∑–∞ –∫–≥
301‚Äì350 kg: $0.75 –∑–∞ –∫–≥
351‚Äì450 kg: $0.70 –∑–∞ –∫–≥
451‚Äì500 kg: $0.65 –∑–∞ –∫–≥
551‚Äì650 kg: $0.60 –∑–∞ –∫–≥
651‚Äì850 kg: $0.55 –∑–∞ –∫–≥
851‚Äì950 kg: $0.50 –∑–∞ –∫–≥
951‚Äì1500 kg: $0.45 –∑–∞ –∫–≥
>1500 –∫–≥: $0.45 –∑–∞ –∫–≥"""
        else:  # tj
            return """üìä <b>–¢–∞—Ä–∏—Ñ“≥–æ–∏ –£—Ä—É–º—á”£ ‚Üí –•—É“∑–∞–Ω–¥:</b>

<b>–ë–∞—Ä–æ–∏ –±–æ—Ä“≥–æ–∏ —Ç–æ 200 –∫–≥ (–Ω–∞—Ä—Ö –±–∞—Ä–æ–∏ –º¬≥):</b>
> 100 kg: $170 –±–∞—Ä–æ–∏ –º¬≥
101‚Äì150 kg: $180 –±–∞—Ä–æ–∏ –º¬≥
151‚Äì200 kg: $200 –±–∞—Ä–æ–∏ –º¬≥

<b>–ë–∞—Ä–æ–∏ –±–æ—Ä“≥–æ–∏ –∞–∑ 201 –∫–≥ (–Ω–∞—Ä—Ö –±–∞—Ä–æ–∏ –∫–≥):</b>
230‚Äì250 kg: $0.90 –±–∞—Ä–æ–∏ –∫–≥
251‚Äì300 kg: $0.80 –±–∞—Ä–æ–∏ –∫–≥
301‚Äì350 kg: $0.75 –±–∞—Ä–æ–∏ –∫–≥
351‚Äì450 kg: $0.70 –±–∞—Ä–æ–∏ –∫–≥
451‚Äì500 kg: $0.65 –±–∞—Ä–æ–∏ –∫–≥
551‚Äì650 kg: $0.60 –±–∞—Ä–æ–∏ –∫–≥
651‚Äì850 kg: $0.55 –±–∞—Ä–æ–∏ –∫–≥
851‚Äì950 kg: $0.50 –±–∞—Ä–æ–∏ –∫–≥
951‚Äì1500 kg: $0.45 –±–∞—Ä–æ–∏ –∫–≥
>1500 –∫–≥: $0.45 –±–∞—Ä–æ–∏ –∫–≥"""
    else:  # Yiwu ‚Üí Khujand
        if language == "ru":
            return """üìä <b>–¢–∞—Ä–∏—Ñ—ã Yiwu ‚Üí Khujand:</b>

<b>–î–ª—è –≥—Ä—É–∑–æ–≤ –¥–æ 200 –∫–≥ (—Ü–µ–Ω–∞ –∑–∞ –º¬≥):</b>
> 100 kg: $200 –∑–∞ –º¬≥
101‚Äì150 kg: $210 –∑–∞ –º¬≥
151‚Äì200 kg: $230 –∑–∞ –º¬≥

<b>–î–ª—è –≥—Ä—É–∑–æ–≤ –æ—Ç 201 –∫–≥ (—Ü–µ–Ω–∞ –∑–∞ –∫–≥):</b>
201‚Äì250 kg: $1.03 –∑–∞ –∫–≥
251‚Äì300 kg: $0.93 –∑–∞ –∫–≥
301‚Äì350 kg: $0.88 –∑–∞ –∫–≥
351‚Äì450 kg: $0.83 –∑–∞ –∫–≥
451‚Äì500 kg: $0.78 –∑–∞ –∫–≥
501‚Äì650 kg: $0.73 –∑–∞ –∫–≥
651‚Äì900 kg: $0.68 –∑–∞ –∫–≥
951‚Äì1000 kg: $0.63 –∑–∞ –∫–≥
1001‚Äì1500 kg: $0.58 –∑–∞ –∫–≥
>1500 –∫–≥: $0.58 –∑–∞ –∫–≥"""
        else:  # tj
            return """üìä <b>–¢–∞—Ä–∏—Ñ“≥–æ–∏ –ò–≤—É ‚Üí –•—É“∑–∞–Ω–¥:</b>

<b>–ë–∞—Ä–æ–∏ –±–æ—Ä“≥–æ–∏ —Ç–æ 200 –∫–≥ (–Ω–∞—Ä—Ö –±–∞—Ä–æ–∏ –º¬≥):</b>
> 100 kg: $200 –±–∞—Ä–æ–∏ –º¬≥
101‚Äì150 kg: $210 –±–∞—Ä–æ–∏ –º¬≥
151‚Äì200 kg: $230 –±–∞—Ä–æ–∏ –º¬≥

<b>–ë–∞—Ä–æ–∏ –±–æ—Ä“≥–æ–∏ –∞–∑ 201 –∫–≥ (–Ω–∞—Ä—Ö –±–∞—Ä–æ–∏ –∫–≥):</b>
201‚Äì250 kg: $1.03 –±–∞—Ä–æ–∏ –∫–≥
251‚Äì300 kg: $0.93 –±–∞—Ä–æ–∏ –∫–≥
301‚Äì350 kg: $0.88 –±–∞—Ä–æ–∏ –∫–≥
351‚Äì450 kg: $0.83 –±–∞—Ä–æ–∏ –∫–≥
451‚Äì500 kg: $0.78 –±–∞—Ä–æ–∏ –∫–≥
501‚Äì650 kg: $0.73 –±–∞—Ä–æ–∏ –∫–≥
651‚Äì900 kg: $0.68 –±–∞—Ä–æ–∏ –∫–≥
951‚Äì1000 kg: $0.63 –±–∞—Ä–æ–∏ –∫–≥
1001‚Äì1500 kg: $0.58 –±–∞—Ä–æ–∏ –∫–≥
>1500 –∫–≥: $0.58 –±–∞—Ä–æ–∏ –∫–≥"""

def get_calculation_type(weight_kg: float, route: str, language: str = "ru") -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ç–∏–ø —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Å–∞ –∏ –º–∞—Ä—à—Ä—É—Ç–∞
    
    Args:
        weight_kg: –í–µ—Å –≤ –∫–≥
        route: –ú–∞—Ä—à—Ä—É—Ç
        language: –Ø–∑—ã–∫
        
    Returns:
        –°—Ç—Ä–æ–∫–∞ —Å —Ç–∏–ø–æ–º —Ä–∞—Å—á–µ—Ç–∞
    """
    if weight_kg <= 200:
        if language == "ru":
            return "–ø–æ –æ–±—ä–µ–º—É (—Ü–µ–Ω–∞ –∑–∞ –º¬≥)"
        else:
            return "–∞–∑ —Ä”Ø–∏ “≥–∞“∑–º (–Ω–∞—Ä—Ö –±–∞—Ä–æ–∏ –º¬≥)"
    else:
        if language == "ru":
            return "–ø–æ –≤–µ—Å—É (—Ü–µ–Ω–∞ –∑–∞ –∫–≥)"
        else:
            return "–∞–∑ —Ä”Ø–∏ –≤–∞–∑–Ω (–Ω–∞—Ä—Ö –±–∞—Ä–æ–∏ –∫–≥)"
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\services\delivery.py =====

===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\services\excel_export.py =====
import asyncio
import os
from datetime import datetime
from typing import List
from openpyxl import Workbook
from openpyxl.styles import Font, Alignment, PatternFill, Border, Side
from openpyxl.utils import get_column_letter

from database.models import Product

async def generate_excel_report(products: List[Product], period: str, language: str = "ru") -> str:
    """
    –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel –æ—Ç—á–µ—Ç–∞
    
    Args:
        products: –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
        period: –ü–µ—Ä–∏–æ–¥ –æ—Ç—á–µ—Ç–∞ ('week', 'month', 'year')
        language: –Ø–∑—ã–∫ –æ—Ç—á–µ—Ç–∞
        
    Returns:
        –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
    """
    # –°–æ–∑–¥–∞–µ–º —Ä–∞–±–æ—á—É—é –∫–Ω–∏–≥—É
    wb = Workbook()
    ws = wb.active
    
    # –ù–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —è–∑—ã–∫–∞
    headers = {
        "ru": [
            "‚Ññ",
            "–¢—Ä–µ–∫-–∫–æ–¥", 
            "–°—Ç–∞—Ç—É—Å",
            "–°—Ç—Ä–∞–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
            "–¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏",
            "–•—Ä—É–ø–∫–∏–π",
            "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏",
            "–û–∂–∏–¥–∞–µ–º–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
            "–°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ –¥–≤–µ—Ä–µ–π",
            "–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è"
        ],
        "tj": [
            "‚Ññ",
            "–†–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω", 
            "–°—Ç–∞—Ç—É—Å",
            "–ö–∏—à–≤–∞—Ä–∏ —Ñ–∏—Ä–∏—Å—Ç–æ–¥",
            "–ù–∞–≤—ä–∏ —Ä–∞—Å–æ–Ω–∏–¥–∞–Ω",
            "–ù–æ–∑—É–∫",
            "–°–∞–Ω–∞–∏ —Ñ–∏—Ä–∏—Å—Ç–æ–¥",
            "–†–∞—Å–æ–Ω–∏–∏–¥–∞–Ω–∏ –∏–Ω—Ç–∏–∑–æ—Ä—à–∞–≤–∞–Ω–¥–∞",
            "–°—Ç–∞—Ç—É—Å–∏ —Ä–∞—Å–æ–Ω–∏–¥–∞–Ω —Ç–æ –¥–∞—Ä",
            "–°–∞–Ω–∞–∏ —Å–æ—Ö—Ç"
        ]
    }
    
    # –ó–∞–≥–æ–ª–æ–≤–∫–∏
    ws.append(headers[language])
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª–µ–π –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    header_font = Font(bold=True, color="FFFFFF")
    header_fill = PatternFill(start_color="366092", end_color="366092", fill_type="solid")
    alignment = Alignment(horizontal="center", vertical="center")
    thin_border = Border(
        left=Side(style='thin'), 
        right=Side(style='thin'),
        top=Side(style='thin'), 
        bottom=Side(style='thin')
    )
    
    # –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –∫ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º
    for col in range(1, len(headers[language]) + 1):
        cell = ws.cell(row=1, column=col)
        cell.font = header_font
        cell.fill = header_fill
        cell.alignment = alignment
        cell.border = thin_border
    
    # –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
    for i, product in enumerate(products, 2):
        # –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç–∞—Ç—É—Å–æ–≤
        status_translation = {
            "ru": {
                "created": "–°–æ–∑–¥–∞–Ω",
                "china_warehouse": "–ù–∞ —Å–∫–ª–∞–¥–µ –ö–∏—Ç–∞–π",
                "in_transit": "–í –ø—É—Ç–∏",
                "tajikistan_warehouse": "–ù–∞ —Å–∫–ª–∞–¥–µ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω",
                "delivered": "–î–æ—Å—Ç–∞–≤–ª–µ–Ω",
                "completed": "–ó–∞–≤–µ—Ä—à–µ–Ω"
            },
            "tj": {
                "created": "–°–æ—Ö—Ç–∞ —à—É–¥–∞–∞—Å—Ç",
                "china_warehouse": "–î–∞—Ä –∞–Ω–±–æ—Ä–∏ –ß–∏–Ω",
                "in_transit": "–î–∞—Ä —Ä–æ“≥",
                "tajikistan_warehouse": "–î–∞—Ä –∞–Ω–±–æ—Ä–∏ –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω",
                "delivered": "–†–∞—Å–æ–Ω–∏–¥–∞ —à—É–¥",
                "completed": "–ê–Ω“∑–æ–º —ë—Ñ—Ç"
            }
        }
        
        # –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ –¥–≤–µ—Ä–µ–π
        door_delivery_translation = {
            "ru": {
                "pending": "–í –æ–∂–∏–¥–∞–Ω–∏–∏",
                "delivered": "–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ",
                "cancelled": "–û—Ç–º–µ–Ω–µ–Ω–æ"
            },
            "tj": {
                "pending": "–î–∞—Ä –∏–Ω—Ç–∏–∑–æ—Ä”£",
                "delivered": "–†–∞—Å–æ–Ω–∏–¥–∞ —à—É–¥",
                "cancelled": "–ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞ —à—É–¥"
            }
        }
        
        row = [
            i - 1,  # ‚Ññ
            product.track_code,
            status_translation[language].get(product.status.value, product.status.value),
            product.country_from or "-",
            product.delivery_type or "-",
            "–î–∞" if product.fragile else "–ù–µ—Ç" if language == "ru" else "“≤–∞" if product.fragile else "–ù–µ",
            product.send_date.strftime("%d.%m.%Y %H:%M") if product.send_date else "-",
            product.expected_delivery_date.strftime("%d.%m.%Y") if product.expected_delivery_date else "-",
            door_delivery_translation[language].get(
                product.door_delivery_status.value, 
                product.door_delivery_status.value
            ),
            product.created_at.strftime("%d.%m.%Y %H:%M")
        ]
        
        ws.append(row)
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –∫ –¥–∞–Ω–Ω—ã–º
        for col in range(1, len(row) + 1):
            cell = ws.cell(row=i, column=col)
            cell.border = thin_border
            if col in [1, 7, 8, 10]:  # –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —á–∏—Å–ª–æ–≤—ã–µ –∏ –¥–∞—Ç—ã
                cell.alignment = Alignment(horizontal="center", vertical="center")
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫
    column_widths = [5, 20, 15, 15, 15, 10, 15, 15, 15, 15]
    for i, width in enumerate(column_widths, 1):
        ws.column_dimensions[get_column_letter(i)].width = width
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
    total_row = len(products) + 2
    ws.cell(row=total_row, column=1, value="–ò—Ç–æ–≥–æ:" if language == "ru" else "“∂–∞–º—ä:")
    ws.cell(row=total_row, column=2, value=len(products))
    
    # –û–±—ä–µ–¥–∏–Ω—è–µ–º —è—á–µ–π–∫–∏ –¥–ª—è –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    ws.merge_cells(start_row=total_row, start_column=1, end_row=total_row, end_column=len(headers[language]))
    
    # –°—Ç–∏–ª—å –¥–ª—è –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    total_cell = ws.cell(row=total_row, column=1)
    total_cell.font = Font(bold=True, color="FFFFFF")
    total_cell.fill = PatternFill(start_color="FF6600", end_color="FF6600", fill_type="solid")
    total_cell.alignment = Alignment(horizontal="center", vertical="center")
    
    # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤, –µ—Å–ª–∏ –µ–µ –Ω–µ—Ç
    os.makedirs("reports", exist_ok=True)
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"reports/report_{period}_{timestamp}.xlsx"
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
    wb.save(filename)
    
    return filename

async def generate_delivery_report(deliveries: List[Product], language: str = "ru") -> str:
    """
    –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –ø–æ –¥–æ—Å—Ç–∞–≤–∫–µ –¥–æ –¥–≤–µ—Ä–µ–π
    
    Args:
        deliveries: –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –¥–æ –¥–≤–µ—Ä–µ–π
        language: –Ø–∑—ã–∫ –æ—Ç—á–µ—Ç–∞
        
    Returns:
        –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
    """
    wb = Workbook()
    ws = wb.active
    
    headers = {
        "ru": [
            "‚Ññ",
            "–¢—Ä–µ–∫-–∫–æ–¥",
            "–ö–ª–∏–µ–Ω—Ç",
            "–¢–µ–ª–µ—Ñ–æ–Ω",
            "–ê–¥—Ä–µ—Å",
            "–°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏",
            "–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞"
        ],
        "tj": [
            "‚Ññ",
            "–†–∞–º–∑–∏ —Ç–∞–º–æ—à–æ–±–∏–Ω",
            "–ú–∏–∑–æ“∑",
            "–¢–µ–ª–µ—Ñ–æ–Ω",
            "–ê–¥—Ä–µ—Å",
            "–°—Ç–∞—Ç—É—Å–∏ —Ä–∞—Å–æ–Ω–∏–¥–∞–Ω",
            "–°–∞–Ω–∏–∏ —Ñ–∞—Ä–º–æ–∏—à"
        ]
    }
    
    ws.append(headers[language])
    
    # –°—Ç–∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    for col in range(1, len(headers[language]) + 1):
        cell = ws.cell(row=1, column=col)
        cell.font = Font(bold=True, color="FFFFFF")
        cell.fill = PatternFill(start_color="4F81BD", end_color="4F81BD", fill_type="solid")
        cell.alignment = Alignment(horizontal="center", vertical="center")
    
    for i, delivery in enumerate(deliveries, 2):
        row = [
            i - 1,
            delivery.track_code,
            delivery.user.full_name if delivery.user else "-",
            delivery.user.phone if delivery.user else "-",
            delivery.delivery_address or "-",
            delivery.door_delivery_status.value,
            delivery.created_at.strftime("%d.%m.%Y %H:%M")
        ]
        ws.append(row)
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫
    column_widths = [5, 20, 20, 15, 30, 15, 15]
    for i, width in enumerate(column_widths, 1):
        ws.column_dimensions[get_column_letter(i)].width = width
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"reports/delivery_report_{timestamp}.xlsx"
    wb.save(filename)
    
    return filename
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\services\track_code.py =====
import random
import string
from datetime import datetime
from typing import Dict, List

class TrackCodeGenerator:
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ–Ω—è—Ç–Ω—ã—Ö —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤"""
    
    @staticmethod
    def generate_track_code(user_id: int, product_type: str = "GEN") -> str:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–Ω—è—Ç–Ω–æ–≥–æ —Ç—Ä–µ–∫-–∫–æ–¥–∞:
        –§–æ—Ä–º–∞—Ç: TTYYMMDDUSERID{–ø—Ä–æ–¥—É–∫—Ç}{—Å–ª—É—á–∞–π–Ω–∞—è —á–∞—Å—Ç—å}
        
        TT - —Ç–∏–ø —Ç–æ–≤–∞—Ä–∞ (CN-–ö–∏—Ç–∞–π, US-–°–®–ê, EU-–ï–≤—Ä–æ–ø–∞, GEN-–æ–±—â–∏–π)
        YYMMDD - –¥–∞—Ç–∞ (–≥–æ–¥/–º–µ—Å—è—Ü/–¥–µ–Ω—å)
        USERID - –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Ü–∏—Ñ—Ä—ã ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        –ø—Ä–æ–¥—É–∫—Ç - 2 –±—É–∫–≤—ã —Ç–∏–ø–∞ –ø—Ä–æ–¥—É–∫—Ç–∞
        —Å–ª—É—á–∞–π–Ω–∞—è —á–∞—Å—Ç—å - 4 —Å–ª—É—á–∞–π–Ω—ã–µ –±—É–∫–≤—ã
        """
        
        # –¢–∏–ø—ã —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∏—Ö –∫–æ–¥—ã
        product_codes = {
            "electronics": "EL",
            "clothing": "CL",
            "shoes": "SH",
            "home": "HM",
            "beauty": "BT",
            "toys": "TY",
            "auto": "AU",
            "sports": "SP",
            "other": "OT"
        }
        
        # –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞
        now = datetime.now()
        date_part = now.strftime("%y%m%d")
        
        # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Ü–∏—Ñ—Ä—ã)
        user_part = str(user_id)[-4:].zfill(4)
        
        # –ö–æ–¥ —Ç–∏–ø–∞ —Ç–æ–≤–∞—Ä–∞
        product_code = product_codes.get(product_type.lower(), "GN")
        
        # –°–ª—É—á–∞–π–Ω–∞—è —á–∞—Å—Ç—å (4 –±—É–∫–≤—ã)
        random_part = ''.join(random.choices(string.ascii_uppercase, k=4))
        
        return f"{product_type.upper()[:2]}{date_part}{user_part}{product_code}{random_part}"

    @staticmethod
    def decode_track_code(track_code: str) -> Dict[str, str]:
        """–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫-–∫–æ–¥–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã"""
        if len(track_code) < 18:
            return {}
        
        return {
            "product_type": track_code[:2],
            "date": f"20{track_code[2:4]}-{track_code[4:6]}-{track_code[6:8]}",
            "user_id_suffix": track_code[8:12],
            "category": track_code[12:14],
            "random": track_code[14:18]
        }
    
    @staticmethod
    def generate_bulk_codes(count: int, user_id: int) -> List[str]:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤"""
        codes = set()
        while len(codes) < count:
            code = TrackCodeGenerator.generate_track_code(user_id)
            codes.add(code)
        return list(codes)
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\services\track_code_generator.py =====
"""
–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ–Ω—è—Ç–Ω—ã—Ö —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤
"""
import random
import string
from datetime import datetime
from typing import Dict, List

class TrackCodeGenerator:
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ–Ω—è—Ç–Ω—ã—Ö —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤"""
    
    @staticmethod
    def generate_track_code(user_id: int, product_type: str = "GEN") -> str:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–Ω—è—Ç–Ω–æ–≥–æ —Ç—Ä–µ–∫-–∫–æ–¥–∞:
        –§–æ—Ä–º–∞—Ç: TTYYMMDDUSERID{–ø—Ä–æ–¥—É–∫—Ç}{—Å–ª—É—á–∞–π–Ω–∞—è —á–∞—Å—Ç—å}
        
        TT - —Ç–∏–ø —Ç–æ–≤–∞—Ä–∞ (CN-–ö–∏—Ç–∞–π, US-–°–®–ê, EU-–ï–≤—Ä–æ–ø–∞, GEN-–æ–±—â–∏–π)
        YYMMDD - –¥–∞—Ç–∞ (–≥–æ–¥/–º–µ—Å—è—Ü/–¥–µ–Ω—å)
        USERID - –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Ü–∏—Ñ—Ä—ã ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        –ø—Ä–æ–¥—É–∫—Ç - 2 –±—É–∫–≤—ã —Ç–∏–ø–∞ –ø—Ä–æ–¥—É–∫—Ç–∞
        —Å–ª—É—á–∞–π–Ω–∞—è —á–∞—Å—Ç—å - 4 —Å–ª—É—á–∞–π–Ω—ã–µ –±—É–∫–≤—ã
        """
        
        # –¢–∏–ø—ã —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∏—Ö –∫–æ–¥—ã
        product_codes = {
            "electronics": "EL",
            "clothing": "CL",
            "shoes": "SH",
            "home_appliances": "HM",
            "beauty": "BT",
            "toys": "TY",
            "automotive": "AU",
            "sports": "SP",
            "other": "OT"
        }
        
        # –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞
        now = datetime.now()
        date_part = now.strftime("%y%m%d")
        
        # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Ü–∏—Ñ—Ä—ã)
        user_part = str(user_id)[-4:].zfill(4)
        
        # –ö–æ–¥ —Ç–∏–ø–∞ —Ç–æ–≤–∞—Ä–∞
        product_code = product_codes.get(product_type.lower(), "GN")
        
        # –°–ª—É—á–∞–π–Ω–∞—è —á–∞—Å—Ç—å (4 –±—É–∫–≤—ã)
        random_part = ''.join(random.choices(string.ascii_uppercase, k=4))
        
        return f"{product_type.upper()[:2]}{date_part}{user_part}{product_code}{random_part}"

    @staticmethod
    def decode_track_code(track_code: str) -> Dict[str, str]:
        """–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫-–∫–æ–¥–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã"""
        if len(track_code) < 18:
            return {}
        
        return {
            "product_type": track_code[:2],
            "date": f"20{track_code[2:4]}-{track_code[4:6]}-{track_code[6:8]}",
            "user_id_suffix": track_code[8:12],
            "category": track_code[12:14],
            "random": track_code[14:18]
        }
    
    @staticmethod
    def generate_bulk_codes(count: int, user_id: int) -> List[str]:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤"""
        codes = set()
        while len(codes) < count:
            code = TrackCodeGenerator.generate_track_code(user_id)
            codes.add(code)
        return list(codes)
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\services\track_code_new.py =====
import random
import string
from datetime import datetime
from typing import Dict, List

class TrackCodeGenerator:
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ–Ω—è—Ç–Ω—ã—Ö —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤"""
    
    @staticmethod
    def generate_track_code(user_id: int, product_type: str = "GEN") -> str:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–Ω—è—Ç–Ω–æ–≥–æ —Ç—Ä–µ–∫-–∫–æ–¥–∞:
        –§–æ—Ä–º–∞—Ç: TTYYMMDDUSERID{–ø—Ä–æ–¥—É–∫—Ç}{—Å–ª—É—á–∞–π–Ω–∞—è —á–∞—Å—Ç—å}
        
        TT - —Ç–∏–ø —Ç–æ–≤–∞—Ä–∞ (CN-–ö–∏—Ç–∞–π, US-–°–®–ê, EU-–ï–≤—Ä–æ–ø–∞, GEN-–æ–±—â–∏–π)
        YYMMDD - –¥–∞—Ç–∞ (–≥–æ–¥/–º–µ—Å—è—Ü/–¥–µ–Ω—å)
        USERID - –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Ü–∏—Ñ—Ä—ã ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        –ø—Ä–æ–¥—É–∫—Ç - 2 –±—É–∫–≤—ã —Ç–∏–ø–∞ –ø—Ä–æ–¥—É–∫—Ç–∞
        —Å–ª—É—á–∞–π–Ω–∞—è —á–∞—Å—Ç—å - 4 —Å–ª—É—á–∞–π–Ω—ã–µ –±—É–∫–≤—ã
        """
        
        # –¢–∏–ø—ã —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∏—Ö –∫–æ–¥—ã
        product_codes = {
            "electronics": "EL",
            "clothing": "CL",
            "shoes": "SH",
            "home_appliances": "HM",
            "beauty": "BT",
            "toys": "TY",
            "automotive": "AU",
            "sports": "SP",
            "other": "OT"
        }
        
        # –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞
        now = datetime.now()
        date_part = now.strftime("%y%m%d")
        
        # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Ü–∏—Ñ—Ä—ã)
        user_part = str(user_id)[-4:].zfill(4)
        
        # –ö–æ–¥ —Ç–∏–ø–∞ —Ç–æ–≤–∞—Ä–∞
        product_code = product_codes.get(product_type.lower(), "GN")
        
        # –°–ª—É—á–∞–π–Ω–∞—è —á–∞—Å—Ç—å (4 –±—É–∫–≤—ã)
        random_part = ''.join(random.choices(string.ascii_uppercase, k=4))
        
        return f"{product_type.upper()[:2]}{date_part}{user_part}{product_code}{random_part}"

    @staticmethod
    def decode_track_code(track_code: str) -> Dict[str, str]:
        """–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫-–∫–æ–¥–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã"""
        if len(track_code) < 18:
            return {}
        
        return {
            "product_type": track_code[:2],
            "date": f"20{track_code[2:4]}-{track_code[4:6]}-{track_code[6:8]}",
            "user_id_suffix": track_code[8:12],
            "category": track_code[12:14],
            "random": track_code[14:18]
        }
    
    @staticmethod
    def generate_bulk_codes(count: int, user_id: int) -> List[str]:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤"""
        codes = set()
        while len(codes) < count:
            code = TrackCodeGenerator.generate_track_code(user_id)
            codes.add(code)
        return list(codes)
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\services\__init__.py =====

===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\utils\helpers.py =====
import re
from typing import Optional, List
from datetime import datetime, timedelta

def parse_phone_number(phone: str) -> Optional[str]:
    """
    –ü–∞—Ä—Å–∏–Ω–≥ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    
    Args:
        phone: –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –ª—é–±–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
        
    Returns:
        str: –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä –∏–ª–∏ None
    """
    if not phone:
        return None
    
    # –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã
    digits = re.sub(r'\D', '', phone)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É
    if len(digits) < 10:
        return None
    
    # –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 8 (–¥–ª—è –†–æ—Å—Å–∏–∏/–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–∞), –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ +7
    if digits.startswith('8') and len(digits) == 11:
        digits = '7' + digits[1:]
    
    # –î–æ–±–∞–≤–ª—è–µ–º + –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
    if not digits.startswith('+'):
        digits = '+' + digits
    
    return digits

def validate_email(email: str) -> bool:
    """
    –í–∞–ª–∏–¥–∞—Ü–∏—è email –∞–¥—Ä–µ—Å–∞
    
    Args:
        email: Email –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        
    Returns:
        bool: –í–∞–ª–∏–¥–Ω—ã–π –ª–∏ email
    """
    pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
    return bool(re.match(pattern, email))

def format_datetime(dt: datetime, language: str = "ru") -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
    
    Args:
        dt: –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
        language: –Ø–∑—ã–∫
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞
    """
    formats = {
        "ru": {
            "date": "%d.%m.%Y",
            "datetime": "%d.%m.%Y %H:%M",
            "time": "%H:%M"
        },
        "tj": {
            "date": "%d.%m.%Y",
            "datetime": "%d.%m.%Y %H:%M",
            "time": "%H:%M"
        }
    }
    
    fmt = formats.get(language, formats["ru"])
    return dt.strftime(fmt["datetime"])

def calculate_delivery_date(send_date: datetime, 
                           delivery_days: int = 30) -> datetime:
    """
    –†–∞—Å—á–µ—Ç –¥–∞—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏
    
    Args:
        send_date: –î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
        delivery_days: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É
        
    Returns:
        datetime: –û–∂–∏–¥–∞–µ–º–∞—è –¥–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
    """
    return send_date + timedelta(days=delivery_days)

def split_list(input_list: List, chunk_size: int) -> List[List]:
    """
    –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –Ω–∞ —á–∞—Å—Ç–∏
    
    Args:
        input_list: –ò—Å—Ö–æ–¥–Ω—ã–π —Å–ø–∏—Å–æ–∫
        chunk_size: –†–∞–∑–º–µ—Ä —á–∞—Å—Ç–∏
        
    Returns:
        List[List]: –°–ø–∏—Å–æ–∫ —Å–ø–∏—Å–∫–æ–≤
    """
    return [input_list[i:i + chunk_size] for i in range(0, len(input_list), chunk_size)]

def escape_markdown(text: str) -> str:
    """
    –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤ Markdown
    
    Args:
        text: –¢–µ–∫—Å—Ç –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        
    Returns:
        str: –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
    """
    escape_chars = r'_*[]()~`>#+-=|{}.!'
    return re.sub(f'([{re.escape(escape_chars)}])', r'\\\1', text)

def format_currency(amount: float, currency: str = "USD") -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç—ã
    
    Args:
        amount: –°—É–º–º–∞
        currency: –í–∞–ª—é—Ç–∞
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞
    """
    currency_symbols = {
        "USD": "$",
        "RUB": "‚ÇΩ",
        "EUR": "‚Ç¨",
        "CNY": "¬•",
        "TJS": "—Å–º–Ω"
    }
    
    symbol = currency_symbols.get(currency, currency)
    
    if currency == "USD":
        return f"{symbol}{amount:.2f}"
    else:
        return f"{amount:.2f} {symbol}"

def get_user_language(telegram_id: int) -> str:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
    
    Args:
        telegram_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
        
    Returns:
        str: –Ø–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ('ru' –∏–ª–∏ 'tj')
    """
    # –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
    # –í—Ä–µ–º–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä—É—Å—Å–∫–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    return "ru"
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\utils\logger.py =====
import logging
import sys
from pathlib import Path

def setup_logging(log_level: str = "INFO", log_file: str = "bot.log"):
    """
    –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    
    Args:
        log_level: –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG, INFO, WARNING, ERROR, CRITICAL)
        log_file: –ò–º—è —Ñ–∞–π–ª–∞ –¥–ª—è –ª–æ–≥–æ–≤
    """
    # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –ª–æ–≥–æ–≤, –µ—Å–ª–∏ –µ–µ –Ω–µ—Ç
    log_dir = Path("logs")
    log_dir.mkdir(exist_ok=True)
    
    log_file_path = log_dir / log_file
    
    # –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤
    log_format = '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    date_format = '%Y-%m-%d %H:%M:%S'
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ root –ª–æ–≥–≥–µ—Ä–∞
    logging.basicConfig(
        level=getattr(logging, log_level.upper()),
        format=log_format,
        datefmt=date_format,
        handlers=[
            logging.FileHandler(log_file_path, encoding='utf-8'),
            logging.StreamHandler(sys.stdout)
        ]
    )
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–µ—Ä–∞ –¥–ª—è aiogram (—É–º–µ–Ω—å—à–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —Å–ø–∞–º–∞)
    aiogram_logger = logging.getLogger('aiogram')
    aiogram_logger.setLevel(logging.WARNING)
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–µ—Ä–∞ –¥–ª—è sqlalchemy
    sqlalchemy_logger = logging.getLogger('sqlalchemy')
    sqlalchemy_logger.setLevel(logging.WARNING)
    
    return logging.getLogger(__name__)

def get_logger(name: str) -> logging.Logger:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º
    
    Args:
        name: –ò–º—è –ª–æ–≥–≥–µ—Ä–∞
        
    Returns:
        logging.Logger: –û–±—ä–µ–∫—Ç –ª–æ–≥–≥–µ—Ä–∞
    """
    return logging.getLogger(name)

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
class LoggingMiddleware:
    """Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤"""
    
    def __init__(self, logger):
        self.logger = logger
    
    async def __call__(self, handler, event, data):
        user_id = event.from_user.id if hasattr(event, 'from_user') else None
        username = event.from_user.username if hasattr(event, 'from_user') else None
        
        self.logger.info(
            f"Received {event.__class__.__name__} "
            f"from user_id={user_id}, username={username}"
        )
        
        try:
            result = await handler(event, data)
            self.logger.info(
                f"Successfully processed {event.__class__.__name__} "
                f"for user_id={user_id}"
            )
            return result
        except Exception as e:
            self.logger.error(
                f"Error processing {event.__class__.__name__} "
                f"for user_id={user_id}: {str(e)}",
                exc_info=True
            )
            raise
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\utils\states.py =====
from aiogram.fsm.state import State, StatesGroup

class AdminStates(StatesGroup):
    """–°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    WAITING_TRACK_FOR_UPDATE = State()
    WAITING_NEW_STATUS = State()
    WAITING_ARRIVAL_DATE = State()
    WAITING_DATE_FOR_BULK_UPDATE = State()
    WAITING_BULK_STATUS = State()
    WAITING_PRODUCT_DETAILS = State()
class LanguageState(StatesGroup):
    choosing_language = State()

class ClientState(StatesGroup):
    main_menu = State()

    # –¢—Ä–µ–∫-–∫–æ–¥—ã
    track_codes_menu = State()

    # –ü—Ä–æ—Ñ–∏–ª—å
    profile_menu = State()
    edit_name = State()
    edit_region = State()
    
    # –ê–¥—Ä–µ—Å
    address_menu = State()
    
    # –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
    calculator_menu = State()
    calculator_country = State()
    calculator_dimensions = State()
    calculator_weight = State()
    calculator_result = State()  # –î–æ–±–∞–≤–∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    
    # –î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–µ–π
    door_delivery_menu = State()
    door_delivery_track = State()
    door_delivery_name = State()
    door_delivery_phone = State()
    door_delivery_address = State()
    door_delivery_notes = State()
    
    # –ù–û–í–´–ï –°–û–°–¢–û–Ø–ù–ò–Ø –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –¢–û–í–ê–†–ê
    edit_product_name = State()
    edit_product_desc = State()
    edit_product_quantity = State()
    edit_product_price = State()
    edit_product_weight = State()
    edit_product_category = State()
   
    # –ö—É—Ä—Å
    course_menu = State()
   
    # –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
    edit_product_start = State()
    edit_product_menu = State()
    edit_product_name = State()
    edit_product_desc = State()
    edit_product_quantity = State()
    edit_product_price = State()
    edit_product_weight = State()
    edit_product_category = State()
    edit_product_description = State()
    # –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
    edit_product = State()

    # –î–ª—è —Ç—Ä–µ–∫-–∫–æ–¥–æ–≤
    check_track_code = State()
    add_track_code = State()
    product_name = State()
    product_category = State()
    product_description = State()
    product_quantity = State()
    product_unit_price = State()
    product_weight = State()
    product_dimensions = State()
    product_special_info = State()
    waiting_for_contact = State()
 
class AdminChinaState(StatesGroup):
    main_menu = State()
    add_product = State()
    bulk_update = State()
    reports_menu = State()

class AdminTajikistanState(StatesGroup):
    main_menu = State()
    confirm_arrival = State()
    update_status = State()
    door_delivery_management = State()
    reports_menu = State()
    
class AdminState(StatesGroup):
    main_menu = State()
    add_product = State()
    update_status_option = State()
    update_status_input = State()
    update_status_select = State()
    reports_menu = State()

class TrackCodeStates(StatesGroup):
    """–°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–µ–∫-–∫–æ–¥–∞–º–∏"""
    WAITING_TRACK_CODE = State()
    WAITING_PRODUCT_NAME = State()
    WAITING_PRODUCT_CATEGORY = State()
    WAITING_QUANTITY = State()
    WAITING_PRICE = State()
    WAITING_WEIGHT = State()
    WAITING_DIMENSIONS = State()
    WAITING_SPECIAL_INFO = State()
    EDIT_PRODUCT = State()
    EDIT_OPTION = State()
    EDIT_VALUE = State()
===== FILE: C:\Users\shoxruxjon\Desktop\—Ç–≥ –±–æ—Ç\project\cargobot7\cargobot\utils\__init__.py =====
